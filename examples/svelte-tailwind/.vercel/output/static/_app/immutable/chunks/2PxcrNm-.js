import{R as ie,V as Ps,U as Ws,q as f,aO as Bs,aI as Vs,X as Xs,a7 as ht,a5 as qe,aj as Ue,Q as he,W as Ks,av as js,Y as Ke,aG as Fs,aE as Ys,am as kt,i as Qs,as as Mt,aA as Js,M as gt,S as dt,aH as _t,_ as Zs,bg as _e,bh as Ge,a4 as Nt,bi as Ne,bj as ei,ad as ti,bk as si,al as ii,bl as ri,ag as ni,T as ai,P as oi,bm as Lt,bn as li,aJ as ci,e as ui,N as hi,v as gi,bo as di,aP as V,u as N,ax as G,aB as X,G as K,y as z,A,C as k,H as j,B as Y,D as P,K as ge,F as me,aC as re,aX as pi,I as we,J as ee,o as fi,bp as yi,b0 as mi,E as de}from"./i0-F6fyi.js";import{_ as pt,p as Ot,i as te,c as je,b as Le,r as be}from"./CJHWDyO9.js";import"./NZTpNUN0.js";import{a as Se,S as Oe,b as Z}from"./8PSIAql6.js";function Dt(t,e){return e}function wi(t,e,s){for(var i=t.items,r=[],n=e.length,a=0;a<n;a++)si(e[a].e,r,!0);var o=n>0&&r.length===0&&s!==null;if(o){var l=s.parentNode;ii(l),l.append(s),i.clear(),F(t,e[0].prev,e[n-1].next)}ri(r,()=>{for(var u=0;u<n;u++){var c=e[u];o||(i.delete(c.k),F(t,c.prev,c.next)),Nt(c.e,!o)}})}function pe(t,e,s,i,r,n=null){var a=t,o={flags:e,items:new Map,first:null},l=(e&Lt)!==0;if(l){var u=t;a=ie?qe(ni(u)):u.appendChild(Mt())}ie&&Ps();var c=null,h=!1,y=new Map,m=Bs(()=>{var p=s();return Qs(p)?p:p==null?[]:kt(p)}),g,S;function b(){vi(S,g,o,y,a,r,e,i,s),n!==null&&(g.length===0?c?_t(c):c=Ke(()=>n(a)):c!==null&&Zs(c,()=>{c=null}))}Ws(()=>{S??=ai,g=f(m);var p=g.length;if(h&&p===0)return;h=p===0;let T=!1;if(ie){var E=Vs(a)===Xs;E!==(p===0)&&(a=ht(),qe(a),Ue(!1),T=!0)}if(ie){for(var _=null,I,d=0;d<p;d++){if(he.nodeType===Ks&&he.data===js){a=he,T=!0,Ue(!1);break}var x=g[d],M=i(x,d);I=Fe(he,o,_,null,x,M,d,r,e,s),o.items.set(M,I),_=I}p>0&&qe(ht())}if(ie)p===0&&n&&(c=Ke(()=>n(a)));else if(Fs()){var U=new Set,se=Ys;for(d=0;d<p;d+=1){x=g[d],M=i(x,d);var Q=o.items.get(M)??y.get(M);Q?(e&(Ne|_e))!==0&&At(Q,x,d,e):(I=Fe(null,o,null,null,x,M,d,r,e,s,!0),y.set(M,I)),U.add(M)}for(const[H,xe]of o.items)U.has(H)||se.skipped_effects.add(xe.e);se.add_callback(b)}else b();T&&Ue(!0),f(m)}),ie&&(a=he)}function vi(t,e,s,i,r,n,a,o,l){var u=(a&li)!==0,c=(a&(Ne|_e))!==0,h=e.length,y=s.items,m=s.first,g=m,S,b=null,p,T=[],E=[],_,I,d,x;if(u)for(x=0;x<h;x+=1)_=e[x],I=o(_,x),d=y.get(I),d!==void 0&&(d.a?.measure(),(p??=new Set).add(d));for(x=0;x<h;x+=1){if(_=e[x],I=o(_,x),d=y.get(I),d===void 0){var M=i.get(I);if(M!==void 0){i.delete(I),y.set(I,M);var U=b?b.next:g;F(s,b,M),F(s,M,U),Pe(M,U,r),b=M}else{var se=g?g.e.nodes_start:r;b=Fe(se,s,b,b===null?s.first:b.next,_,I,x,n,a,l)}y.set(I,b),T=[],E=[],g=b.next;continue}if(c&&At(d,_,x,a),(d.e.f&Ge)!==0&&(_t(d.e),u&&(d.a?.unfix(),(p??=new Set).delete(d))),d!==g){if(S!==void 0&&S.has(d)){if(T.length<E.length){var Q=E[0],H;b=Q.prev;var xe=T[0],He=T[T.length-1];for(H=0;H<T.length;H+=1)Pe(T[H],Q,r);for(H=0;H<E.length;H+=1)S.delete(E[H]);F(s,xe.prev,He.next),F(s,b,xe),F(s,He,Q),g=Q,b=He,x-=1,T=[],E=[]}else S.delete(d),Pe(d,g,r),F(s,d.prev,d.next),F(s,d,b===null?s.first:b.next),F(s,b,d),b=d;continue}for(T=[],E=[];g!==null&&g.k!==I;)(g.e.f&Ge)===0&&(S??=new Set).add(g),E.push(g),g=g.next;if(g===null)continue;d=g}T.push(d),b=d,g=d.next}if(g!==null||S!==void 0){for(var ue=S===void 0?[]:kt(S);g!==null;)(g.e.f&Ge)===0&&ue.push(g),g=g.next;var $e=ue.length;if($e>0){var Us=(a&Lt)!==0&&h===0?r:null;if(u){for(x=0;x<$e;x+=1)ue[x].a?.measure();for(x=0;x<$e;x+=1)ue[x].a?.fix()}wi(s,ue,Us)}}u&&oi(()=>{if(p!==void 0)for(d of p)d.a?.apply()}),t.first=s.first&&s.first.e,t.last=b&&b.e;for(var Gs of i.values())Nt(Gs.e);i.clear()}function At(t,e,s,i){(i&Ne)!==0&&dt(t.v,e),(i&_e)!==0?dt(t.i,s):t.i=s}function Fe(t,e,s,i,r,n,a,o,l,u,c){var h=(l&Ne)!==0,y=(l&ei)===0,m=h?y?Js(r,!1,!1):gt(r):r,g=(l&_e)===0?a:gt(a),S={i:g,v:m,k:n,a:null,e:null,prev:s,next:i};try{if(t===null){var b=document.createDocumentFragment();b.append(t=Mt())}return S.e=Ke(()=>o(t,m,g,u),ie),S.e.prev=s&&s.e,S.e.next=i&&i.e,s===null?c||(e.first=S):(s.next=S,s.e.next=S.e),i!==null&&(i.prev=S,i.e.prev=S.e),S}finally{}}function Pe(t,e,s){for(var i=t.next?t.next.e.nodes_start:s,r=e?e.e.nodes_start:s,n=t.e.nodes_start;n!==null&&n!==i;){var a=ti(n);r.before(n),n=a}}function F(t,e,s){e===null?t.first=s:(e.next=s,e.e.next=s&&s.e),s!==null&&(s.prev=e,s.e.prev=e&&e.e)}function ha(t,e,s){ci(()=>{var i=ui(()=>e(t,s?.())||{});if(s&&i?.update){var r=!1,n={};hi(()=>{var a=s();gi(a),r&&di(n,a)&&(n=a,i.update(a))}),r=!0}if(i?.destroy)return()=>i.destroy()})}var tt=(t=>(t[t.Degree0=0]="Degree0",t[t.Degree90=1]="Degree90",t[t.Degree180=2]="Degree180",t[t.Degree270=3]="Degree270",t))(tt||{});function bi(t){return{x:Math.floor(t.x),y:Math.floor(t.y)}}function Si(t){return{width:Math.ceil(t.width),height:Math.ceil(t.height)}}function ga(t){return{origin:bi(t.origin),size:Si(t.size)}}function Ye(t){const{width:e,height:s}=t;return{width:s,height:e}}function zt(t,e,s){return t=e%2===0?t:Ye(t),{width:t.width*s,height:t.height*s}}function da(t){const e=[t.p1.x,t.p2.x,t.p3.x,t.p4.x],s=[t.p1.y,t.p2.y,t.p3.y,t.p4.y];return{origin:{x:Math.min(...e),y:Math.min(...s)},size:{width:Math.max(...e)-Math.min(...e),height:Math.max(...s)-Math.min(...s)}}}function pa(t){return{p1:{x:t.origin.x,y:t.origin.y},p2:{x:t.origin.x+t.size.width,y:t.origin.y},p3:{x:t.origin.x+t.size.width,y:t.origin.y+t.size.height},p4:{x:t.origin.x,y:t.origin.y+t.size.height}}}function Ht(t,e,s){let i=e.x,r=e.y;switch(s){case 0:i=e.x,r=e.y;break;case 1:i=t.height-e.y,r=e.x;break;case 2:i=t.width-e.x,r=t.height-e.y;break;case 3:i=e.y,r=t.width-e.x;break}return{x:i,y:r}}function Me(t,e){return{x:t.x*e,y:t.y*e}}function Ci(t,e,s,i){return Me(Ht(t,e,s),i)}function Ri(t,e,s,i){return Me(Ht(t,e,(4-s)%4),1/i)}function fa(t){if(t.length===0)return{origin:{x:0,y:0},size:{width:0,height:0}};const e=t.map(n=>n.x),s=t.map(n=>n.y),i=Math.min(...e),r=Math.min(...s);return{origin:{x:i,y:r},size:{width:Math.max(...e)-i,height:Math.max(...s)-r}}}function ya(t,e,s){const i=Math.cos(e),r=Math.sin(e),n=t.x*i-t.y*r,a=t.x*r+t.y*i;return{x:n+s.x,y:a+s.y}}function ma(t,e){return{origin:{x:t.origin.x-e,y:t.origin.y-e},size:{width:t.size.width+e*2,height:t.size.height+e*2}}}function $t(t,e,s){let i=e.origin.x,r=e.origin.y,n=e.size;switch(s){case 0:break;case 1:i=t.height-e.origin.y-e.size.height,r=e.origin.x,n=Ye(e.size);break;case 2:i=t.width-e.origin.x-e.size.width,r=t.height-e.origin.y-e.size.height;break;case 3:i=e.origin.y,r=t.width-e.origin.x-e.size.width,n=Ye(e.size);break}return{origin:{x:i,y:r},size:{width:n.width,height:n.height}}}function qt(t,e){return{origin:{x:t.origin.x*e,y:t.origin.y*e},size:{width:t.size.width*e,height:t.size.height*e}}}function Ti(t,e,s,i){return qt($t(t,e,s),i)}function wa(t,e,s,i){return qt($t(t,e,(4-s)%4),1/i)}function Ut(t){if(t.length===0)return null;let e=t[0].origin.x,s=t[0].origin.y,i=t[0].origin.x+t[0].size.width,r=t[0].origin.y+t[0].size.height;for(const n of t)e=Math.min(e,n.origin.x),s=Math.min(s,n.origin.y),i=Math.max(i,n.origin.x+n.size.width),r=Math.max(r,n.origin.y+n.size.height);return{origin:{x:e,y:s},size:{width:i-e,height:r-s}}}function va(t,e,s,i){const r=t.origin.x,n=t.origin.y,a=t.size.width,o=t.size.height,l=s/a,u=i/o,c=s/o,h=i/a;switch(e){case 0:return{a:l,b:0,c:0,d:u,e:-l*r,f:-u*n};case 3:return{a:0,b:-h,c,d:0,e:-c*n,f:h*(r+a)};case 2:return{a:-l,b:0,c:0,d:-u,e:l*(r+a),f:u*(n+o)};case 1:return{a:0,b:h,c:-c,d:0,e:c*(n+o),f:-h*r}}}class st{isEnabled(){return!1}debug(){}info(){}warn(){}error(){}perf(){}}class xi{isEnabled(){return!0}debug(e,s,...i){console.debug(`${e}.${s}`,...i)}info(e,s,...i){console.info(`${e}.${s}`,...i)}warn(e,s,...i){console.warn(`${e}.${s}`,...i)}error(e,s,...i){console.error(`${e}.${s}`,...i)}perf(e,s,i,r,...n){console.info(`${e}.${s}.${i}.${r}`,...n)}}class Ei{constructor(e,s){this.logger=e,this.level=s}isEnabled(e){const s={debug:0,info:1,warn:2,error:3};return this.level<=s[e]}debug(e,s,...i){this.level<=0&&this.logger.debug(e,s,...i)}info(e,s,...i){this.level<=1&&this.logger.info(e,s,...i)}warn(e,s,...i){this.level<=2&&this.logger.warn(e,s,...i)}error(e,s,...i){this.level<=3&&this.logger.error(e,s,...i)}perf(e,s,i,r,...n){this.logger.perf(e,s,i,r,...n)}}class Ii{constructor(){}isEnabled(){return!1}debug(e,s,...i){}info(e,s,...i){}warn(e,s,...i){}error(e,s,...i){}perf(e,s,i,r,n,...a){switch(r){case"Begin":globalThis.performance.mark(`${e}.${s}.${i}.${r}.${n}`,{detail:a});break;case"End":globalThis.performance.mark(`${e}.${s}.${i}.${r}.${n}`,{detail:a}),globalThis.performance.measure(`${e}.${s}.${i}.Measure.${n}`,`${e}.${s}.${i}.Begin.${n}`,`${e}.${s}.${i}.End.${n}`);break}}}class ki{constructor(e){this.loggers=e}isEnabled(e){return this.loggers.some(s=>s.isEnabled(e))}debug(e,s,...i){for(const r of this.loggers)r.debug(e,s,...i)}info(e,s,...i){for(const r of this.loggers)r.info(e,s,...i)}warn(e,s,...i){for(const r of this.loggers)r.warn(e,s,...i)}error(e,s,...i){for(const r of this.loggers)r.error(e,s,...i)}perf(e,s,i,r,...n){for(const a of this.loggers)a.perf(e,s,i,r,...n)}}class Mi extends Error{constructor(e){super(`Task aborted: ${JSON.stringify(e)}`),this.name="TaskAbortedError",this.reason=e}}class _i extends Error{constructor(e){super(`Task rejected: ${JSON.stringify(e)}`),this.name="TaskRejectedError",this.reason=e}}class B{constructor(){this.state={stage:0},this.resolvedCallbacks=[],this.rejectedCallbacks=[],this._promise=null,this.progressCbs=[]}toPromise(){return this._promise||(this._promise=new Promise((e,s)=>{this.wait(i=>e(i),i=>{i.type==="abort"?s(new Mi(i.reason)):s(new _i(i.reason))})})),this._promise}wait(e,s){switch(this.state.stage){case 0:this.resolvedCallbacks.push(e),this.rejectedCallbacks.push(s);break;case 1:e(this.state.result);break;case 2:s({type:"reject",reason:this.state.reason});break;case 3:s({type:"abort",reason:this.state.reason});break}}resolve(e){if(this.state.stage===0){this.state={stage:1,result:e};for(const s of this.resolvedCallbacks)try{s(e)}catch{}this.resolvedCallbacks=[],this.rejectedCallbacks=[]}}reject(e){if(this.state.stage===0){this.state={stage:2,reason:e};for(const s of this.rejectedCallbacks)try{s({type:"reject",reason:e})}catch{}this.resolvedCallbacks=[],this.rejectedCallbacks=[]}}abort(e){if(this.state.stage===0){this.state={stage:3,reason:e};for(const s of this.rejectedCallbacks)try{s({type:"abort",reason:e})}catch{}this.resolvedCallbacks=[],this.rejectedCallbacks=[]}}fail(e){e.type==="abort"?this.abort(e.reason):this.reject(e.reason)}onProgress(e){this.progressCbs.push(e)}progress(e){for(const s of this.progressCbs)s(e)}static all(e){const s=new B;if(e.length===0)return s.resolve([]),s;const i=new Array(e.length);let r=0,n=!1;return e.forEach((a,o)=>{a.wait(l=>{n||(i[o]=l,r++,r===e.length&&(n=!0,s.resolve(i)))},l=>{n||(n=!0,l.type==="abort"?s.abort(l.reason):s.reject(l.reason))})}),s}static allSettled(e){const s=new B;if(e.length===0)return s.resolve([]),s;const i=new Array(e.length);let r=0;return e.forEach((n,a)=>{n.wait(o=>{i[a]={status:"resolved",value:o},r++,r===e.length&&s.resolve(i)},o=>{i[a]={status:o.type==="abort"?"aborted":"rejected",reason:o.reason},r++,r===e.length&&s.resolve(i)})}),s}static race(e){const s=new B;if(e.length===0)return s.reject("No tasks provided"),s;let i=!1;return e.forEach(r=>{r.wait(n=>{i||(i=!0,s.resolve(n))},n=>{i||(i=!0,n.type==="abort"?s.abort(n.reason):s.reject(n.reason))})}),s}static withProgress(e,s){const i=B.all(e);if(s){let r=0;e.forEach(n=>{n.wait(()=>{r++,s(r,e.length)},()=>{r++,s(r,e.length)})})}return i}}const Ni="­",Li="​",Oi="⁠",Di="\uFEFF",Ai="￾",zi="￿",Hi=Object.freeze([Ni,Li,Oi,Di,Ai,zi]),$i=new RegExp(`[${Hi.join("")}]`,"g");function ba(t){return t.replace($i,"")}var qi=(t=>(t[t.Unknown=0]="Unknown",t[t.XYZ=1]="XYZ",t[t.FitPage=2]="FitPage",t[t.FitHorizontal=3]="FitHorizontal",t[t.FitVertical=4]="FitVertical",t[t.FitRectangle=5]="FitRectangle",t[t.FitBoundingBox=6]="FitBoundingBox",t[t.FitBoundingBoxHorizontal=7]="FitBoundingBoxHorizontal",t[t.FitBoundingBoxVertical=8]="FitBoundingBoxVertical",t))(qi||{}),Ui=(t=>(t[t.NotSet=0]="NotSet",t[t.True=1]="True",t[t.False=2]="False",t[t.Unknown=3]="Unknown",t))(Ui||{}),O=(t=>(t[t.Unknown=-1]="Unknown",t[t.Courier=0]="Courier",t[t.Courier_Bold=1]="Courier_Bold",t[t.Courier_BoldOblique=2]="Courier_BoldOblique",t[t.Courier_Oblique=3]="Courier_Oblique",t[t.Helvetica=4]="Helvetica",t[t.Helvetica_Bold=5]="Helvetica_Bold",t[t.Helvetica_BoldOblique=6]="Helvetica_BoldOblique",t[t.Helvetica_Oblique=7]="Helvetica_Oblique",t[t.Times_Roman=8]="Times_Roman",t[t.Times_Bold=9]="Times_Bold",t[t.Times_BoldItalic=10]="Times_BoldItalic",t[t.Times_Italic=11]="Times_Italic",t[t.Symbol=12]="Symbol",t[t.ZapfDingbats=13]="ZapfDingbats",t))(O||{}),fe=(t=>(t[t.Left=0]="Left",t[t.Center=1]="Center",t[t.Right=2]="Right",t))(fe||{}),Gi=(t=>(t[t.Top=0]="Top",t[t.Middle=1]="Middle",t[t.Bottom=2]="Bottom",t))(Gi||{}),L=(t=>(t[t.Normal=0]="Normal",t[t.Multiply=1]="Multiply",t[t.Screen=2]="Screen",t[t.Overlay=3]="Overlay",t[t.Darken=4]="Darken",t[t.Lighten=5]="Lighten",t[t.ColorDodge=6]="ColorDodge",t[t.ColorBurn=7]="ColorBurn",t[t.HardLight=8]="HardLight",t[t.SoftLight=9]="SoftLight",t[t.Difference=10]="Difference",t[t.Exclusion=11]="Exclusion",t[t.Hue=12]="Hue",t[t.Saturation=13]="Saturation",t[t.Color=14]="Color",t[t.Luminosity=15]="Luminosity",t))(L||{}),Pi=(t=>(t[t.Contain=0]="Contain",t[t.Cover=1]="Cover",t[t.Stretch=2]="Stretch",t))(Pi||{}),Wi=(t=>(t[t.Unsupported=0]="Unsupported",t[t.Goto=1]="Goto",t[t.RemoteGoto=2]="RemoteGoto",t[t.URI=3]="URI",t[t.LaunchAppOrOpenFile=4]="LaunchAppOrOpenFile",t))(Wi||{}),Bi=(t=>(t[t.UNKNOWN=0]="UNKNOWN",t[t.TEXT=1]="TEXT",t[t.LINK=2]="LINK",t[t.FREETEXT=3]="FREETEXT",t[t.LINE=4]="LINE",t[t.SQUARE=5]="SQUARE",t[t.CIRCLE=6]="CIRCLE",t[t.POLYGON=7]="POLYGON",t[t.POLYLINE=8]="POLYLINE",t[t.HIGHLIGHT=9]="HIGHLIGHT",t[t.UNDERLINE=10]="UNDERLINE",t[t.SQUIGGLY=11]="SQUIGGLY",t[t.STRIKEOUT=12]="STRIKEOUT",t[t.STAMP=13]="STAMP",t[t.CARET=14]="CARET",t[t.INK=15]="INK",t[t.POPUP=16]="POPUP",t[t.FILEATTACHMENT=17]="FILEATTACHMENT",t[t.SOUND=18]="SOUND",t[t.MOVIE=19]="MOVIE",t[t.WIDGET=20]="WIDGET",t[t.SCREEN=21]="SCREEN",t[t.PRINTERMARK=22]="PRINTERMARK",t[t.TRAPNET=23]="TRAPNET",t[t.WATERMARK=24]="WATERMARK",t[t.THREED=25]="THREED",t[t.RICHMEDIA=26]="RICHMEDIA",t[t.XFAWIDGET=27]="XFAWIDGET",t[t.REDACT=28]="REDACT",t))(Bi||{}),Vi=(t=>(t[t.Normal=0]="Normal",t[t.Rollover=1]="Rollover",t[t.Down=2]="Down",t))(Vi||{}),Xi=(t=>(t[t.Unknown=-1]="Unknown",t[t.Comment=0]="Comment",t[t.Key=1]="Key",t[t.Note=2]="Note",t[t.Help=3]="Help",t[t.NewParagraph=4]="NewParagraph",t[t.Paragraph=5]="Paragraph",t[t.Insert=6]="Insert",t[t.Graph=7]="Graph",t[t.PushPin=8]="PushPin",t[t.Paperclip=9]="Paperclip",t[t.Tag=10]="Tag",t[t.Speaker=11]="Speaker",t[t.Mic=12]="Mic",t[t.Approved=13]="Approved",t[t.Experimental=14]="Experimental",t[t.NotApproved=15]="NotApproved",t[t.AsIs=16]="AsIs",t[t.Expired=17]="Expired",t[t.NotForPublicRelease=18]="NotForPublicRelease",t[t.Confidential=19]="Confidential",t[t.Final=20]="Final",t[t.Sold=21]="Sold",t[t.Departmental=22]="Departmental",t[t.ForComment=23]="ForComment",t[t.TopSecret=24]="TopSecret",t[t.Draft=25]="Draft",t[t.ForPublicRelease=26]="ForPublicRelease",t))(Xi||{}),Ki=(t=>(t[t.None=0]="None",t[t.Square=1]="Square",t[t.Circle=2]="Circle",t[t.Diamond=3]="Diamond",t[t.OpenArrow=4]="OpenArrow",t[t.ClosedArrow=5]="ClosedArrow",t[t.Butt=6]="Butt",t[t.ROpenArrow=7]="ROpenArrow",t[t.RClosedArrow=8]="RClosedArrow",t[t.Slash=9]="Slash",t[t.Unknown=10]="Unknown",t))(Ki||{}),ji=(t=>(t[t.UNKNOWN=0]="UNKNOWN",t[t.PUSHBUTTON=1]="PUSHBUTTON",t[t.CHECKBOX=2]="CHECKBOX",t[t.RADIOBUTTON=3]="RADIOBUTTON",t[t.COMBOBOX=4]="COMBOBOX",t[t.LISTBOX=5]="LISTBOX",t[t.TEXTFIELD=6]="TEXTFIELD",t[t.SIGNATURE=7]="SIGNATURE",t[t.XFA=8]="XFA",t[t.XFA_CHECKBOX=9]="XFA_CHECKBOX",t[t.XFA_COMBOBOX=10]="XFA_COMBOBOX",t[t.XFA_IMAGEFIELD=11]="XFA_IMAGEFIELD",t[t.XFA_LISTBOX=12]="XFA_LISTBOX",t[t.XFA_PUSHBUTTON=13]="XFA_PUSHBUTTON",t[t.XFA_SIGNATURE=14]="XFA_SIGNATURE",t[t.XFA_TEXTFIELD=15]="XFA_TEXTFIELD",t))(ji||{}),Fi=(t=>(t[t.Color=0]="Color",t[t.InteriorColor=1]="InteriorColor",t))(Fi||{}),Yi=(t=>(t[t.UNKNOWN=0]="UNKNOWN",t[t.SOLID=1]="SOLID",t[t.DASHED=2]="DASHED",t[t.BEVELED=3]="BEVELED",t[t.INSET=4]="INSET",t[t.UNDERLINE=5]="UNDERLINE",t[t.CLOUDY=6]="CLOUDY",t))(Yi||{}),Qi=(t=>(t[t.UNKNOWN=0]="UNKNOWN",t[t.TEXT=1]="TEXT",t[t.PATH=2]="PATH",t[t.IMAGE=3]="IMAGE",t[t.SHADING=4]="SHADING",t[t.FORM=5]="FORM",t))(Qi||{});const Qe=Object.freeze({1:"invisible",2:"hidden",4:"print",8:"noZoom",16:"noRotate",32:"noView",64:"readOnly",128:"locked",256:"toggleNoView"}),Ji=Object.entries(Qe).reduce((t,[e,s])=>(t[s]=Number(e),t),{});function Sa(t){return Object.keys(Qe).filter(e=>(t&e)!==0).map(e=>Qe[e])}function Ca(t){return t.reduce((e,s)=>e|Ji[s],0)}var Zi=(t=>(t[t.None=0]="None",t[t.MatchCase=1]="MatchCase",t[t.MatchWholeWord=2]="MatchWholeWord",t[t.MatchConsecutive=4]="MatchConsecutive",t))(Zi||{}),er=(t=>(t[t.Display=0]="Display",t[t.Print=1]="Print",t))(er||{}),oe=(t=>(t[t.Ok=0]="Ok",t[t.Unknown=1]="Unknown",t[t.NotFound=2]="NotFound",t[t.WrongFormat=3]="WrongFormat",t[t.Password=4]="Password",t[t.Security=5]="Security",t[t.PageError=6]="PageError",t[t.XFALoad=7]="XFALoad",t[t.XFALayout=8]="XFALayout",t[t.Cancelled=9]="Cancelled",t[t.Initialization=10]="Initialization",t[t.NotReady=11]="NotReady",t[t.NotSupport=12]="NotSupport",t[t.LoadDoc=13]="LoadDoc",t[t.DocNotOpen=14]="DocNotOpen",t[t.CantCloseDoc=15]="CantCloseDoc",t[t.CantCreateNewDoc=16]="CantCreateNewDoc",t[t.CantImportPages=17]="CantImportPages",t[t.CantCreateAnnot=18]="CantCreateAnnot",t[t.CantSetAnnotRect=19]="CantSetAnnotRect",t[t.CantSetAnnotContent=20]="CantSetAnnotContent",t[t.CantRemoveInkList=21]="CantRemoveInkList",t[t.CantAddInkStoke=22]="CantAddInkStoke",t[t.CantReadAttachmentSize=23]="CantReadAttachmentSize",t[t.CantReadAttachmentContent=24]="CantReadAttachmentContent",t[t.CantFocusAnnot=25]="CantFocusAnnot",t[t.CantSelectText=26]="CantSelectText",t[t.CantSelectOption=27]="CantSelectOption",t[t.CantCheckField=28]="CantCheckField",t[t.CantSetAnnotString=29]="CantSetAnnotString",t))(oe||{});class Ee{static create(){return new B}static resolve(e){const s=new B;return s.resolve(e),s}static reject(e){const s=new B;return s.reject(e),s}static abort(e){const s=new B;return s.reject(e),s}}function Ra(t){const e=i=>Math.max(0,Math.min(255,i)),s=i=>e(i).toString(16).padStart(2,"0");return`#${s(t.red)}${s(t.green)}${s(t.blue)}`}function Ta(t){/^#?[0-9a-f]{3}$/i.test(t)&&(t=t.replace(/^#?([0-9a-f])([0-9a-f])([0-9a-f])$/i,"#$1$1$2$2$3$3").toLowerCase());const[,e,s,i]=/^#?([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i.exec(t)??(()=>{throw new Error(`Invalid hex colour: "${t}"`)})();return{red:parseInt(e,16),green:parseInt(s,16),blue:parseInt(i,16)}}function xa(t){return(s=>Math.max(0,Math.min(255,s)))(t)/255}function Ea(t){return((s,i=255)=>Math.max(0,Math.min(i,s)))(Math.round(t*255))}function Ia(t){if(!t?.startsWith("D:")||t.length<16)return;const e=+t.slice(2,6),s=+t.slice(6,8)-1,i=+t.slice(8,10),r=+t.slice(10,12),n=+t.slice(12,14),a=+t.slice(14,16);return new Date(Date.UTC(e,s,i,r,n,a))}function ka(t=new Date){const e=(l,u=2)=>l.toString().padStart(u,"0"),s=t.getUTCFullYear(),i=e(t.getUTCMonth()+1),r=e(t.getUTCDate()),n=e(t.getUTCHours()),a=e(t.getUTCMinutes()),o=e(t.getUTCSeconds());return`D:${s}${i}${r}${n}${a}${o}`}const it=Object.freeze([{id:fe.Left,label:"Left",css:"left"},{id:fe.Center,label:"Center",css:"center"},{id:fe.Right,label:"Right",css:"right"}]),ft=it.reduce((t,e)=>(t[e.id]=e,t),{});it.reduce((t,e)=>(t[e.css]=e.id,t),{});function tr(t){return ft[t]??ft[fe.Left]}function Ma(t){return tr(t).css}it.map(t=>({value:t.id,label:t.label}));var Gt=(t=>(t.Courier="Courier",t.Helvetica="Helvetica",t.Times="Times",t.Symbol="Symbol",t.ZapfDingbats="ZapfDingbats",t.Unknown="Unknown",t))(Gt||{});O.Helvetica;const Pt={id:O.Helvetica,family:"Helvetica",bold:!1,italic:!1,label:"Helvetica",css:"Helvetica, Arial, sans-serif"},rt=Object.freeze([{id:O.Courier,family:"Courier",bold:!1,italic:!1,label:"Courier",css:"Courier, monospace"},{id:O.Courier_Bold,family:"Courier",bold:!0,italic:!1,label:"Courier Bold",css:'"Courier-Bold", Courier, monospace'},{id:O.Courier_BoldOblique,family:"Courier",bold:!0,italic:!0,label:"Courier Bold Oblique",css:'"Courier-BoldOblique", Courier, monospace'},{id:O.Courier_Oblique,family:"Courier",bold:!1,italic:!0,label:"Courier Oblique",css:'"Courier-Oblique", Courier, monospace'},Pt,{id:O.Helvetica_Bold,family:"Helvetica",bold:!0,italic:!1,label:"Helvetica Bold",css:'"Helvetica-Bold", Arial, sans-serif'},{id:O.Helvetica_BoldOblique,family:"Helvetica",bold:!0,italic:!0,label:"Helvetica Bold Oblique",css:'"Helvetica-BoldOblique", Arial, sans-serif'},{id:O.Helvetica_Oblique,family:"Helvetica",bold:!1,italic:!0,label:"Helvetica Oblique",css:'"Helvetica-Oblique", Arial, sans-serif'},{id:O.Times_Roman,family:"Times",bold:!1,italic:!1,label:"Times Roman",css:'"Times New Roman", Times, serif'},{id:O.Times_Bold,family:"Times",bold:!0,italic:!1,label:"Times Bold",css:'"Times New Roman Bold", Times, serif'},{id:O.Times_BoldItalic,family:"Times",bold:!0,italic:!0,label:"Times Bold Italic",css:'"Times New Roman Bold Italic", Times, serif'},{id:O.Times_Italic,family:"Times",bold:!1,italic:!0,label:"Times Italic",css:'"Times New Roman Italic", Times, serif'},{id:O.Symbol,family:"Symbol",bold:!1,italic:!1,label:"Symbol",css:"Symbol"},{id:O.ZapfDingbats,family:"ZapfDingbats",bold:!1,italic:!1,label:"Zapf Dingbats",css:"ZapfDingbats"}]),sr=rt.reduce((t,e)=>(t[e.id]=e,t),{}),ir=new Map;for(const t of rt)ir.set(`${t.family}_${t.bold}_${t.italic}`,t.id);function rr(){return Pt}function nr(t){return sr[t]??rr()}function _a(t){return nr(t).css}Object.values(Gt).filter(t=>t!=="Unknown").map(t=>({value:t,label:t}));[...new Set(rt.map(t=>t.family))];const nt=Object.freeze([{id:L.Normal,label:"Normal",css:"normal"},{id:L.Multiply,label:"Multiply",css:"multiply"},{id:L.Screen,label:"Screen",css:"screen"},{id:L.Overlay,label:"Overlay",css:"overlay"},{id:L.Darken,label:"Darken",css:"darken"},{id:L.Lighten,label:"Lighten",css:"lighten"},{id:L.ColorDodge,label:"Color Dodge",css:"color-dodge"},{id:L.ColorBurn,label:"Color Burn",css:"color-burn"},{id:L.HardLight,label:"Hard Light",css:"hard-light"},{id:L.SoftLight,label:"Soft Light",css:"soft-light"},{id:L.Difference,label:"Difference",css:"difference"},{id:L.Exclusion,label:"Exclusion",css:"exclusion"},{id:L.Hue,label:"Hue",css:"hue"},{id:L.Saturation,label:"Saturation",css:"saturation"},{id:L.Color,label:"Color",css:"color"},{id:L.Luminosity,label:"Luminosity",css:"luminosity"}]),yt=nt.reduce((t,e)=>(t[e.id]=e,t),{});nt.reduce((t,e)=>(t[e.css]=e.id,t),{});function ar(t){return yt[t]??yt[L.Normal]}function Na(t){return ar(t).css}nt.map(t=>({value:t.id,label:t.label}));function mt(t){if(t instanceof st)return{type:"noop"};if(t instanceof xi)return{type:"console"};if(t instanceof Ii)return{type:"perf"};if(t instanceof Ei){const e=t;return{type:"level",config:{level:e.level,logger:mt(e.logger)}}}return t instanceof ki?{type:"all",config:{loggers:t.loggers.map(mt)}}:{type:"noop"}}const or=/^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;function La(t){return or.test(t)}function lr(t){var e;if(typeof((e=globalThis.crypto)==null?void 0:e.getRandomValues)=="function")return globalThis.crypto.getRandomValues(new Uint8Array(t));if(typeof require=="function")try{const{randomBytes:i}=require("crypto");return i(t)}catch{}const s=new Uint8Array(t);for(let i=0;i<t;i++)s[i]=Math.floor(Math.random()*256);return s}function Oa(){var t;if(typeof((t=globalThis.crypto)==null?void 0:t.randomUUID)=="function")return globalThis.crypto.randomUUID();const e=lr(16);e[6]=e[6]&15|64,e[8]=e[8]&63|128;const s=Array.from(e,i=>i.toString(16).padStart(2,"0")).join("");return`${s.slice(0,8)}-${s.slice(8,12)}-${s.slice(12,16)}-${s.slice(16,20)}-${s.slice(20)}`}function ae(){}const cr="https://cdn.jsdelivr.net/npm/@embedpdf/pdfium@1.4.1/dist/pdfium.wasm",w="WebWorkerEngine",v="Engine";function R(t,e,s){return{id:t,type:"ExecuteRequest",data:{name:e,args:s}}}class C extends B{constructor(e,s){super(),this.worker=e,this.messageId=s}abort(e){super.abort(e),this.worker.postMessage({id:this.messageId,type:"AbortRequest"})}progress(e){super.progress(e)}}const Wt=class Je{constructor(e,s=new st){this.worker=e,this.logger=s,this.tasks=new Map,this.handle=i=>{this.logger.debug(w,v,"webworker engine start handling message: ",i.data);try{const r=i.data,n=this.tasks.get(r.id);if(!n)return;switch(r.type){case"ReadyResponse":this.readyTask.resolve(!0);break;case"ExecuteProgress":n.progress(r.data);break;case"ExecuteResponse":{switch(r.data.type){case"result":n.resolve(r.data.value);break;case"error":n.reject(r.data.value.reason);break}this.tasks.delete(r.id)}break}}catch(r){this.logger.error(w,v,"webworker met error when handling message: ",r)}},this.worker.addEventListener("message",this.handle),this.readyTask=new C(this.worker,Je.readyTaskId),this.tasks.set(Je.readyTaskId,this.readyTask)}generateRequestId(e){return`${e}.${Date.now()}.${Math.random()}`}initialize(){this.logger.debug(w,v,"initialize");const e=this.generateRequestId("General"),s=new C(this.worker,e),i=R(e,"initialize",[]);return this.proxy(s,i),s}destroy(){this.logger.debug(w,v,"destroy");const e=this.generateRequestId("General"),s=new C(this.worker,e),i=()=>{this.worker.removeEventListener("message",this.handle),this.worker.terminate()};s.wait(i,i);const r=R(e,"destroy",[]);return this.proxy(s,r),s}openDocumentUrl(e,s){this.logger.debug(w,v,"openDocumentUrl",e.url,s);const i=this.generateRequestId(e.id),r=new C(this.worker,i),n=R(i,"openDocumentUrl",[e,s]);return this.proxy(r,n),r}openDocumentBuffer(e,s){this.logger.debug(w,v,"openDocumentBuffer",e,s);const i=this.generateRequestId(e.id),r=new C(this.worker,i),n=R(i,"openDocumentBuffer",[e,s]);return this.proxy(r,n),r}getMetadata(e){this.logger.debug(w,v,"getMetadata",e);const s=this.generateRequestId(e.id),i=new C(this.worker,s),r=R(s,"getMetadata",[e]);return this.proxy(i,r),i}setMetadata(e,s){this.logger.debug(w,v,"setMetadata",e,s);const i=this.generateRequestId(e.id),r=new C(this.worker,i),n=R(i,"setMetadata",[e,s]);return this.proxy(r,n),r}getDocPermissions(e){this.logger.debug(w,v,"getDocPermissions",e);const s=this.generateRequestId(e.id),i=new C(this.worker,s),r=R(s,"getDocPermissions",[e]);return this.proxy(i,r),i}getDocUserPermissions(e){this.logger.debug(w,v,"getDocUserPermissions",e);const s=this.generateRequestId(e.id),i=new C(this.worker,s),r=R(s,"getDocUserPermissions",[e]);return this.proxy(i,r),i}getBookmarks(e){this.logger.debug(w,v,"getBookmarks",e);const s=this.generateRequestId(e.id),i=new C(this.worker,s),r=R(s,"getBookmarks",[e]);return this.proxy(i,r),i}setBookmarks(e,s){this.logger.debug(w,v,"setBookmarks",e,s);const i=this.generateRequestId(e.id),r=new C(this.worker,i),n=R(i,"setBookmarks",[e,s]);return this.proxy(r,n),r}deleteBookmarks(e){this.logger.debug(w,v,"deleteBookmarks",e);const s=this.generateRequestId(e.id),i=new C(this.worker,s),r=R(s,"deleteBookmarks",[e]);return this.proxy(i,r),i}getSignatures(e){this.logger.debug(w,v,"getSignatures",e);const s=this.generateRequestId(e.id),i=new C(this.worker,s),r=R(s,"getSignatures",[e]);return this.proxy(i,r),i}renderPage(e,s,i){this.logger.debug(w,v,"renderPage",e,s,i);const r=this.generateRequestId(e.id),n=new C(this.worker,r),a=R(r,"renderPage",[e,s,i]);return this.proxy(n,a),n}renderPageRect(e,s,i,r){this.logger.debug(w,v,"renderPageRect",e,s,i,r);const n=this.generateRequestId(e.id),a=new C(this.worker,n),o=R(n,"renderPageRect",[e,s,i,r]);return this.proxy(a,o),a}renderPageAnnotation(e,s,i,r){this.logger.debug(w,v,"renderAnnotation",e,s,i,r);const n=this.generateRequestId(e.id),a=new C(this.worker,n),o=R(n,"renderPageAnnotation",[e,s,i,r]);return this.proxy(a,o),a}getAllAnnotations(e){this.logger.debug(w,v,"getAllAnnotations",e);const s=this.generateRequestId(e.id),i=new C(this.worker,s),r=R(s,"getAllAnnotations",[e]);return this.proxy(i,r),i}getPageAnnotations(e,s){this.logger.debug(w,v,"getPageAnnotations",e,s);const i=this.generateRequestId(e.id),r=new C(this.worker,i),n=R(i,"getPageAnnotations",[e,s]);return this.proxy(r,n),r}createPageAnnotation(e,s,i,r){this.logger.debug(w,v,"createPageAnnotations",e,s,i,r);const n=this.generateRequestId(e.id),a=new C(this.worker,n),o=R(n,"createPageAnnotation",[e,s,i,r]);return this.proxy(a,o),a}updatePageAnnotation(e,s,i){this.logger.debug(w,v,"updatePageAnnotation",e,s,i);const r=this.generateRequestId(e.id),n=new C(this.worker,r),a=R(r,"updatePageAnnotation",[e,s,i]);return this.proxy(n,a),n}removePageAnnotation(e,s,i){this.logger.debug(w,v,"removePageAnnotations",e,s,i);const r=this.generateRequestId(e.id),n=new C(this.worker,r),a=R(r,"removePageAnnotation",[e,s,i]);return this.proxy(n,a),n}getPageTextRects(e,s){this.logger.debug(w,v,"getPageTextRects",e,s);const i=this.generateRequestId(e.id),r=new C(this.worker,i),n=R(i,"getPageTextRects",[e,s]);return this.proxy(r,n),r}renderThumbnail(e,s,i){this.logger.debug(w,v,"renderThumbnail",e,s,i);const r=this.generateRequestId(e.id),n=new C(this.worker,r),a=R(r,"renderThumbnail",[e,s,i]);return this.proxy(n,a),n}searchAllPages(e,s,i){this.logger.debug(w,v,"searchAllPages",e,s,i);const r=this.generateRequestId(e.id),n=new C(this.worker,r),a=R(r,"searchAllPages",[e,s,i]);return this.proxy(n,a),n}saveAsCopy(e){this.logger.debug(w,v,"saveAsCopy",e);const s=this.generateRequestId(e.id),i=new C(this.worker,s),r=R(s,"saveAsCopy",[e]);return this.proxy(i,r),i}getAttachments(e){this.logger.debug(w,v,"getAttachments",e);const s=this.generateRequestId(e.id),i=new C(this.worker,s),r=R(s,"getAttachments",[e]);return this.proxy(i,r),i}addAttachment(e,s){this.logger.debug(w,v,"addAttachment",e,s);const i=this.generateRequestId(e.id),r=new C(this.worker,i),n=R(i,"addAttachment",[e,s]);return this.proxy(r,n),r}removeAttachment(e,s){this.logger.debug(w,v,"removeAttachment",e,s);const i=this.generateRequestId(e.id),r=new C(this.worker,i),n=R(i,"removeAttachment",[e,s]);return this.proxy(r,n),r}readAttachmentContent(e,s){this.logger.debug(w,v,"readAttachmentContent",e,s);const i=this.generateRequestId(e.id),r=new C(this.worker,i),n=R(i,"readAttachmentContent",[e,s]);return this.proxy(r,n),r}setFormFieldValue(e,s,i,r){this.logger.debug(w,v,"setFormFieldValue",e,i,r);const n=this.generateRequestId(e.id),a=new C(this.worker,n),o=R(n,"setFormFieldValue",[e,s,i,r]);return this.proxy(a,o),a}flattenPage(e,s,i){this.logger.debug(w,v,"flattenPage",e,s,i);const r=this.generateRequestId(e.id),n=new C(this.worker,r),a=R(r,"flattenPage",[e,s,i]);return this.proxy(n,a),n}extractPages(e,s){this.logger.debug(w,v,"extractPages",e);const i=this.generateRequestId(e.id),r=new C(this.worker,i),n=R(i,"extractPages",[e,s]);return this.proxy(r,n),r}redactTextInRects(e,s,i,r){this.logger.debug(w,v,"redactTextInRects",e,s,i,r);const n=this.generateRequestId(e.id),a=new C(this.worker,n),o=R(n,"redactTextInRects",[e,s,i,r]);return this.proxy(a,o),a}extractText(e,s){this.logger.debug(w,v,"extractText",e);const i=this.generateRequestId(e.id),r=new C(this.worker,i),n=R(i,"extractText",[e,s]);return this.proxy(r,n),r}getTextSlices(e,s){this.logger.debug(w,v,"getTextSlices",e,s);const i=this.generateRequestId(e.id),r=new C(this.worker,i),n=R(i,"getTextSlices",[e,s]);return this.proxy(r,n),r}getPageGlyphs(e,s){this.logger.debug(w,v,"getPageGlyphs",e,s);const i=this.generateRequestId(e.id),r=new C(this.worker,i),n=R(i,"getPageGlyphs",[e,s]);return this.proxy(r,n),r}getPageGeometry(e,s){this.logger.debug(w,v,"getPageGeometry",e,s);const i=this.generateRequestId(e.id),r=new C(this.worker,i),n=R(i,"getPageGeometry",[e,s]);return this.proxy(r,n),r}merge(e){this.logger.debug(w,v,"merge",e);const s=e.map(a=>a.id).join("."),i=this.generateRequestId(s),r=new C(this.worker,i),n=R(i,"merge",[e]);return this.proxy(r,n),r}mergePages(e){this.logger.debug(w,v,"mergePages",e);const s=this.generateRequestId(e.map(n=>n.docId).join(".")),i=new C(this.worker,s),r=R(s,"mergePages",[e]);return this.proxy(i,r),i}preparePrintDocument(e,s){this.logger.debug(w,v,"preparePrintDocument",e,s);const i=this.generateRequestId(e.id),r=new C(this.worker,i),n=R(i,"preparePrintDocument",[e,s]);return this.proxy(r,n),r}closeDocument(e){this.logger.debug(w,v,"closeDocument",e);const s=this.generateRequestId(e.id),i=new C(this.worker,s),r=R(s,"closeDocument",[e]);return this.proxy(i,r),i}closeAllDocuments(){this.logger.debug(w,v,"closeAllDocuments");const e=this.generateRequestId("closeAllDocuments"),s=new C(this.worker,e),i=R(e,"closeAllDocuments",[]);return this.proxy(s,i),s}proxy(e,s,i=[]){this.logger.debug(w,v,"send request to worker",e,s,i),this.logger.perf(w,v,`${s.data.name}`,"Begin",s.id),this.readyTask.wait(()=>{this.worker.postMessage(s,i),e.wait(()=>{this.logger.perf(w,v,`${s.data.name}`,"End",s.id)},()=>{this.logger.perf(w,v,`${s.data.name}`,"End",s.id)}),this.tasks.set(s.id,e)},()=>{this.logger.perf(w,v,`${s.data.name}`,"End",s.id),e.reject({code:oe.Initialization,message:"worker initialization failed"})})}};Wt.readyTaskId="0";let Da=Wt;function Aa(t){const{wasmUrl:e=cr,worker:s=!0,logger:i}={},r=V({engine:null,isLoading:!0,error:null});let n=X(null);return typeof window<"u"&&N(()=>{let o=!1;return(async()=>{try{const{createPdfiumEngine:l}=s?await pt(()=>import("./BrN39QHD.js"),[],import.meta.url):await pt(()=>import("./CV9xpgFD.js"),[],import.meta.url),u=await l(e,i);G(n,u,!0),u.initialize().wait(()=>{r.engine=u,r.isLoading=!1},c=>{r.error=new Error(c.reason.message),r.isLoading=!1})}catch(l){o||(r.error=l,r.isLoading=!1)}})(),()=>{o=!0,f(n)?.closeAllDocuments?.().wait(()=>{f(n)?.destroy?.(),G(n,null)},ae)}}),r}class wt{constructor(){this.dependencyGraph=new Map}addNode(e,s=[]){this.dependencyGraph.set(e,new Set(s))}hasCircularDependencies(){const e=new Set,s=new Set,i=r=>{e.add(r),s.add(r);const n=this.dependencyGraph.get(r)||new Set;for(const a of n)if(e.has(a)){if(s.has(a))return!0}else if(i(a))return!0;return s.delete(r),!1};for(const r of this.dependencyGraph.keys())if(!e.has(r)&&i(r))return!0;return!1}resolveLoadOrder(){if(this.hasCircularDependencies())throw new Error("Circular dependencies detected");const e=[],s=new Set,i=new Set,r=n=>{if(i.has(n))throw new Error("Circular dependency");if(s.has(n))return;i.add(n);const a=this.dependencyGraph.get(n)||new Set;for(const o of a)r(o);i.delete(n),s.add(n),e.push(n)};for(const n of this.dependencyGraph.keys())s.has(n)||r(n);return e}}class $ extends Error{constructor(e){super(e),this.name="PluginRegistrationError"}}class ne extends Error{constructor(e){super(e),this.name="PluginNotFoundError"}}class ur extends Error{constructor(e){super(e),this.name="CircularDependencyError"}}class hr extends Error{constructor(e){super(e),this.name="PluginConfigurationError"}}class gr{constructor(e,s){this.store=e,this.pluginId=s}getState(){return this.store.getState().plugins[this.pluginId]}dispatch(e){return this.store.dispatchToPlugin(this.pluginId,e)}subscribeToState(e){return this.store.subscribeToPlugin(this.pluginId,(s,i,r)=>{e(s,i,r)})}onAction(e,s){return this.store.onAction(e,(i,r,n)=>{s(i,r.plugins[this.pluginId],n.plugins[this.pluginId])})}}const at="LOAD_DOCUMENT",Bt="REFRESH_DOCUMENT",Vt="REFRESH_PAGES",Ce="SET_DOCUMENT",Xt="SET_DOCUMENT_ERROR",De="SET_SCALE",Ae="SET_ROTATION",ze="SET_PAGES",dr=[at,Bt,Ce,Xt,De,Ae,ze],pr=()=>({type:at}),fr=t=>({type:Ce,payload:t}),za=t=>({type:De,payload:t}),Ha=t=>({type:Ae,payload:t}),$a=t=>({type:ze,payload:t});class yr{constructor(e,s){this.initialCoreState=s,this.pluginReducers={},this.listeners=[],this.pluginListeners={},this.isDispatching=!1,this.state={core:s,plugins:{}},this.coreReducer=e}addPluginReducer(e,s,i){this.state.plugins[e]=i,this.pluginReducers[e]=s}dispatchToCore(e){if(!this.coreReducer)return this.getState();if(this.isDispatching)throw new Error("Reducers may not dispatch actions. To trigger cascading actions, dispatch from a listener callback instead.");const s=this.getState();try{this.isDispatching=!0,this.state.core=this.coreReducer(this.state.core,e)}finally{this.isDispatching=!1}return this.listeners.forEach(i=>{const r=this.getState();i(e,r,s)}),this.getState()}dispatchToPlugin(e,s,i=!0){if(this.isDispatching)throw new Error("Reducers may not dispatch actions. To trigger cascading actions, dispatch from a listener callback instead.");const r=this.getState(),n=this.pluginReducers[e];if(!n)return r.plugins[e];const a=r.plugins[e];try{this.isDispatching=!0;const o=n(a,s);this.state.plugins[e]=o}finally{this.isDispatching=!1}return i&&this.listeners.forEach(o=>{const l=this.getState();o(s,l,r)}),this.pluginListeners[e]&&this.pluginListeners[e].forEach(o=>{const l=this.getState().plugins[e];o(s,l,a)}),this.getState().plugins[e]}dispatch(e){if(this.isDispatching)throw new Error("Reducers may not dispatch actions. To trigger cascading actions, dispatch from a listener callback instead.");const s=this.getState();try{this.isDispatching=!0,this.isCoreAction(e)&&(this.state.core=this.coreReducer(this.state.core,e));for(const i in this.pluginReducers){const r=this.pluginReducers[i],n=s.plugins[i];r&&(this.state.plugins[i]=r(n,e))}}finally{this.isDispatching=!1}return this.listeners.forEach(i=>{const r=this.getState();i(e,r,s)}),this.getState()}getState(){if(this.isDispatching)throw new Error("You may not call store.getState() while the reducer is executing. The reducer has already received the state as an argument. Pass it down from the top reducer instead of reading it from the store.");return{core:{...this.state.core},plugins:{...this.state.plugins}}}subscribe(e){if(this.isDispatching)throw new Error("You may not call store.subscribe() while the reducer is executing. If you would like to be notified after the store has been updated, subscribe from a component and invoke store.getState() in the callback to access the latest state.");return this.listeners.push(e),()=>{if(this.isDispatching)throw new Error("You may not unsubscribe from a store listener while the reducer is executing.");this.listeners=this.listeners.filter(s=>s!==e)}}subscribeToPlugin(e,s){if(!(e in this.state.plugins))throw new Error(`Plugin state not found for plugin "${e}". Did you forget to call addPluginReducer?`);if(this.isDispatching)throw new Error("You may not call store.subscribeToPlugin() while the reducer is executing.");return this.pluginListeners[e]||(this.pluginListeners[e]=[]),this.pluginListeners[e].push(s),()=>{if(this.isDispatching)throw new Error("You may not unsubscribe from a store listener while the reducer is executing.");this.pluginListeners[e]=this.pluginListeners[e].filter(i=>i!==s),this.pluginListeners[e].length===0&&delete this.pluginListeners[e]}}onAction(e,s){return this.subscribe((i,r,n)=>{i.type===e&&s(i,r,n)})}getPluginStore(e){if(!(e in this.state.plugins))throw new Error(`Plugin state not found for plugin "${e}". Did you forget to call addPluginReducer?`);return new gr(this,e)}isCoreAction(e){return dr.includes(e.type)}destroy(){this.listeners.length=0;for(const e in this.pluginListeners)this.pluginListeners[e]?.splice?.(0);this.pluginListeners={},this.pluginReducers={},this.state.plugins={},this.state.core={...this.initialCoreState}}}const mr=t=>({scale:t?.scale??1,rotation:t?.rotation??tt.Degree0,document:null,pages:[],loading:!1,error:null}),Ie=t=>t.pages.map(e=>e.map(s=>({...s,rotatedSize:zt(s.size,t.rotation,1)}))),wr=(t,e)=>{switch(e.type){case at:return{...t,loading:!0,error:null};case Ce:return{...t,document:e.payload,pages:e.payload.pages.map(s=>[s]),loading:!1,error:null};case Bt:return{...t,document:e.payload,pages:e.payload.pages.map(s=>[s]),loading:!1,error:null};case Ae:return{...t,rotation:e.payload};case ze:return{...t,pages:e.payload};case Xt:return{...t,loading:!1,error:e.payload};case De:return{...t,scale:e.payload};default:return t}};class vr{constructor(e,s){this.plugins=new Map,this.manifests=new Map,this.capabilities=new Map,this.status=new Map,this.configurations=new Map,this.engineInitialized=!1,this.initPromise=null,this.pendingRegistrations=[],this.processingRegistrations=[],this.initialized=!1,this.isInitializing=!1,this.pluginsReadyPromise=null,this.destroyed=!1,this.resolver=new wt,this.engine=e,this.initialCoreState=mr(s),this.store=new yr(wr,this.initialCoreState),this.logger=s?.logger??new st}getLogger(){return this.logger}async ensureEngineInitialized(){this.engineInitialized||(this.engine.initialize?(await this.engine.initialize().toPromise(),this.engineInitialized=!0):this.engineInitialized=!0)}registerPlugin(e,s){if(this.initialized&&!this.isInitializing)throw new $("Cannot register plugins after initialization");this.validateManifest(e.manifest),this.store.addPluginReducer(e.manifest.id,e.reducer,typeof e.initialState=="function"?e.initialState(this.initialCoreState,{...e.manifest.defaultConfig,...s}):e.initialState),this.pendingRegistrations.push({package:e,config:s})}getStore(){return this.store}getEngine(){return this.engine}pluginsReady(){return this.pluginsReadyPromise?this.pluginsReadyPromise:(this.pluginsReadyPromise=(async()=>{this.initialized||await this.initialize();const e=Array.from(this.plugins.values()).map(s=>typeof s.ready=="function"?s.ready():Promise.resolve());await Promise.all(e)})(),this.pluginsReadyPromise)}async initialize(){if(this.destroyed)throw new $("Registry has been destroyed");return this.initPromise?this.initPromise:(this.initPromise=(async()=>{if(this.initialized)throw new $("Registry is already initialized");this.isInitializing=!0;try{if(await this.ensureEngineInitialized(),this.destroyed)return;for(;this.pendingRegistrations.length>0;){if(this.destroyed)return;this.processingRegistrations=[...this.pendingRegistrations],this.pendingRegistrations=[];for(const s of this.processingRegistrations){const i=new Set,r=[...s.package.manifest.requires,...s.package.manifest.optional];for(const n of r){const a=this.processingRegistrations.find(o=>o.package.manifest.provides.includes(n));a&&i.add(a.package.manifest.id)}this.resolver.addNode(s.package.manifest.id,[...i])}const e=this.resolver.resolveLoadOrder();for(const s of e){const i=this.processingRegistrations.find(r=>r.package.manifest.id===s);await this.initializePlugin(i.package.manifest,i.package.create,i.config)}this.processingRegistrations=[],this.resolver=new wt}for(const e of this.plugins.values())await e.postInitialize?.().catch(s=>{console.error(`Error in postInitialize for plugin ${e.id}`,s),this.status.set(e.id,"error")});this.initialized=!0}catch(e){throw e instanceof Error?new ur(`Failed to resolve plugin dependencies: ${e.message}`):e}finally{this.isInitializing=!1}})(),this.initPromise)}async initializePlugin(e,s,i){const r={...e.defaultConfig,...i};this.validateConfig(e.id,r,e.defaultConfig);const n=s(this,r);this.validatePlugin(n);for(const a of e.requires)if(!this.capabilities.has(a))throw new $(`Missing required capability: ${a} for plugin ${e.id}`);for(const a of e.optional)this.capabilities.has(a)&&this.logger.debug("PluginRegistry","OptionalCapability",`Optional capability ${a} is available for plugin ${e.id}`);this.logger.debug("PluginRegistry","InitializePlugin",`Initializing plugin ${e.id}`,{provides:e.provides});for(const a of e.provides){if(this.capabilities.has(a))throw new $(`Capability ${a} is already provided by plugin ${this.capabilities.get(a)}`);this.capabilities.set(a,e.id)}this.plugins.set(e.id,n),this.manifests.set(e.id,e),this.status.set(e.id,"registered"),this.configurations.set(e.id,r);try{n.initialize&&await n.initialize(r),this.status.set(e.id,"active"),this.logger.info("PluginRegistry","PluginInitialized",`Plugin ${e.id} initialized successfully`)}catch(a){throw this.plugins.delete(e.id),this.manifests.delete(e.id),this.logger.error("PluginRegistry","InitializationFailed",`Plugin ${e.id} initialization failed`,{provides:e.provides,error:a}),e.provides.forEach(o=>this.capabilities.delete(o)),a}}getPluginConfig(e){const s=this.configurations.get(e);if(!s)throw new ne(`Configuration for plugin ${e} not found`);return s}validateConfig(e,s,i){const n=Object.keys(i).filter(a=>!s.hasOwnProperty(a));if(n.length>0)throw new hr(`Missing required configuration keys for plugin ${e}: ${n.join(", ")}`)}async updatePluginConfig(e,s){const i=this.getPlugin(e);if(!i)throw new ne(`Plugin ${e} not found`);const r=this.manifests.get(e),n=this.configurations.get(e);if(!r||!n)throw new ne(`Plugin ${e} not found`);const a={...n,...s};this.validateConfig(e,a,r.defaultConfig),this.configurations.set(e,a),i.initialize&&await i.initialize(a)}registerPluginBatch(e){for(const s of e)this.registerPlugin(s.package,s.config)}async unregisterPlugin(e){const s=this.plugins.get(e);if(!s)throw new ne(`Plugin ${e} is not registered`);const i=this.manifests.get(e);if(!i)throw new ne(`Manifest for plugin ${e} not found`);for(const[r,n]of this.manifests.entries()){if(r===e)continue;if([...n.requires,...n.optional].some(o=>i.provides.includes(o)))throw new $(`Cannot unregister plugin ${e}: plugin ${r} depends on it`)}try{s.destroy&&await s.destroy();for(const r of i.provides)this.capabilities.delete(r);this.plugins.delete(e),this.manifests.delete(e),this.status.delete(e)}catch(r){throw r instanceof Error?new Error(`Failed to unregister plugin ${e}: ${r.message}`):r}}getPlugin(e){const s=this.plugins.get(e);return s||null}getCapabilityProvider(e){const s=this.capabilities.get(e);return s?this.getPlugin(s):null}hasCapability(e){return this.capabilities.has(e)}getAllPlugins(){return Array.from(this.plugins.values())}getPluginStatus(e){const s=this.status.get(e);if(!s)throw new ne(`Plugin ${e} not found`);return s}validatePlugin(e){if(!e.id)throw new $("Plugin must have an id")}validateManifest(e){if(!e.id)throw new $("Manifest must have an id");if(!e.name)throw new $("Manifest must have a name");if(!e.version)throw new $("Manifest must have a version");if(!Array.isArray(e.provides))throw new $("Manifest must have a provides array");if(!Array.isArray(e.requires))throw new $("Manifest must have a requires array");if(!Array.isArray(e.optional))throw new $("Manifest must have an optional array")}isDestroyed(){return this.destroyed}async destroy(){if(this.destroyed)throw new $("Registry has already been destroyed");this.destroyed=!0;try{await this.initPromise}catch{}for(const e of Array.from(this.plugins.values()).reverse())await e.destroy?.();this.store.destroy(),this.plugins.clear(),this.manifests.clear(),this.capabilities.clear(),this.status.clear(),this.pendingRegistrations.length=0,this.processingRegistrations.length=0}}function qa(t,e){return{package:t,config:e}}function br(t){return"autoMountElements"in t&&typeof t.autoMountElements=="function"}class le{constructor(e,s){if(this.id=e,this.registry=s,this.cooldownActions={},this.debouncedTimeouts={},this.unsubscribeFromState=null,this.unsubscribeFromCoreStore=null,e!==this.constructor.id)throw new Error(`Plugin ID mismatch: ${e} !== ${this.constructor.id}`);this.engine=this.registry.getEngine(),this.logger=this.registry.getLogger(),this.coreStore=this.registry.getStore(),this.pluginStore=this.coreStore.getPluginStore(this.id),this.unsubscribeFromState=this.pluginStore.subscribeToState((i,r,n)=>{this.onStoreUpdated(n,r)}),this.unsubscribeFromCoreStore=this.coreStore.subscribe((i,r,n)=>{this.onCoreStoreUpdated(n,r)}),this.readyPromise=new Promise(i=>{this.readyResolve=i}),this.readyResolve()}provides(){if(!this._capability){const e=this.buildCapability();this._capability=Object.freeze(e)}return this._capability}get state(){return this.pluginStore.getState()}get coreState(){return this.coreStore.getState()}getState(){return this.pluginStore.getState()}getCoreState(){return this.coreStore.getState()}dispatchCoreAction(e){return this.coreStore.dispatchToCore(e)}dispatchToAllPlugins(e){return this.coreStore.dispatch(e)}dispatch(e){return this.pluginStore.dispatch(e)}cooldownDispatch(e,s=100){const i=Date.now(),r=this.cooldownActions[e.type]||0;return i-r>=s?(this.cooldownActions[e.type]=i,this.dispatch(e),!0):!1}debouncedDispatch(e,s=100){const i=e.type;this.debouncedTimeouts[i]&&clearTimeout(this.debouncedTimeouts[i]),this.debouncedTimeouts[i]=setTimeout(()=>{this.dispatch(e),delete this.debouncedTimeouts[i]},s)}cancelDebouncedDispatch(e){this.debouncedTimeouts[e]&&(clearTimeout(this.debouncedTimeouts[e]),delete this.debouncedTimeouts[e])}subscribe(e){return this.pluginStore.subscribeToState(e)}subscribeToCoreStore(e){return this.coreStore.subscribe(e)}onStoreUpdated(e,s){}onCoreStoreUpdated(e,s){}destroy(){Object.values(this.debouncedTimeouts).forEach(e=>{clearTimeout(e)}),this.debouncedTimeouts={},this.unsubscribeFromState&&(this.unsubscribeFromState(),this.unsubscribeFromState=null),this.unsubscribeFromCoreStore&&(this.unsubscribeFromCoreStore(),this.unsubscribeFromCoreStore=null)}ready(){return this.readyPromise}markReady(){this.readyResolve()}resetReady(){this.readyPromise=new Promise(e=>{this.readyResolve=e})}}class Sr{constructor(e,s){this.handler=e,this.options=s,this.lastRun=0,this.handle=i=>{this.options.mode==="debounce"?this.debounce(i):this.throttle(i)}}debounce(e){this.timeoutId&&window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{this.handler(e),this.timeoutId=void 0},this.options.wait)}throttle(e){if(this.options.mode==="debounce")return;const s=Date.now(),i=this.options.throttleMode||"leading-trailing";s-this.lastRun>=this.options.wait&&(i==="leading-trailing"&&this.handler(e),this.lastRun=s),this.timeoutId&&window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{this.handler(e),this.lastRun=Date.now(),this.timeoutId=void 0},this.options.wait-(s-this.lastRun))}destroy(){this.timeoutId&&window.clearTimeout(this.timeoutId)}}function Ua(t,e,s){return t<e?e:t>s?s:t}function ve(t,e,s){if(t===e)return!0;if(t==null||e==null)return t===e;const i=typeof t;if(i!==typeof e)return!1;if(i==="object"){s||(s=new Set);const n=Cr(t,e);if(s.has(n))return!0;s.add(n);const a=Array.isArray(t),o=Array.isArray(e);return a&&o?Tr(t,e,s):!a&&!o?xr(t,e,s):!1}return!1}function Cr(t,e){return`${vt(t)}__${vt(e)}`}let Rr=0;const We=new WeakMap;function vt(t){return We.has(t)||We.set(t,++Rr),We.get(t)}function Tr(t,e,s){if(t.length!==e.length)return!1;const i=new Array(e.length).fill(!1);e:for(let r=0;r<t.length;r++){const n=t[r];for(let a=0;a<e.length;a++)if(!i[a]&&ve(n,e[a],s)){i[a]=!0;continue e}return!1}return!0}function xr(t,e,s){const i=Object.keys(t).sort(),r=Object.keys(e).sort();if(i.length!==r.length)return!1;for(let n=0;n<i.length;n++)if(i[n]!==r[n])return!1;for(const n of i){const a=t[n],o=e[n];if(!ve(a,o,s))return!1}return!0}function J(){const t=new Set;return{emit:(s=void 0)=>t.forEach(i=>i(s)),on:s=>(t.add(s),()=>t.delete(s)),off:s=>t.delete(s),clear:()=>t.clear()}}function D(t,e=ve){const s=new Set,i=new Map;let r=t;const n=o=>s.forEach(l=>l(o)),a=(o,l)=>{let u=o,c=()=>{};if(l){const h=new Sr(o,l);u=h.handle,c=()=>h.destroy(),i.set(o,{wrapped:u,destroy:c})}return r!==void 0&&u(r),s.add(u),()=>{s.delete(u),c(),i.delete(o)}};return{get value(){return r},emit(o=void 0){(r===void 0||!e(r,o))&&(r=o,n(o))},on:a,off(o){const l=i.get(o);l?(s.delete(l.wrapped),l.destroy(),i.delete(o)):s.delete(o)},clear(){s.clear(),i.forEach(o=>o.destroy()),i.clear()},select(o,l=ve){return(u,c)=>{let h;if(r!==void 0){const y=o(r);h=y,u(y)}return a(y=>{const m=o(y);(h===void 0||!l(h,m))&&(h=m,u(m))},c)}}}}class Er{constructor(e){this.autoMountElements=[],this.package=e}addUtility(e){return this.autoMountElements.push({component:e,type:"utility"}),this}addWrapper(e){return this.autoMountElements.push({component:e,type:"wrapper"}),this}build(){return{...this.package,autoMountElements:()=>this.autoMountElements}}}function Kt(t){return new Er(t)}const W=V({registry:null,isInitializing:!0,pluginsReady:!1}),Ir=()=>W;function Re(t){const{registry:e}=W,s=V({plugin:null,isLoading:!0,ready:new Promise(()=>{})});if(e===null)return s;const i=e.getPlugin(t);if(!i)throw new Error(`Plugin ${t} not found`);return s.plugin=i,s.isLoading=!1,s.ready=i.ready(),s}function ce(t){const e=Re(t),s=V({provides:null,isLoading:!0,ready:new Promise(()=>{})});return N(()=>{if(!e.plugin){s.provides=null,s.isLoading=e.isLoading,s.ready=e.ready;return}if(!e.plugin.provides)throw new Error(`Plugin ${t} does not provide a capability`);s.provides=e.plugin.provides(),s.isLoading=e.isLoading,s.ready=e.ready}),s}function kr(){const{registry:t}=Ir(),e=V({coreState:null});return N(()=>{if(!t)return;const s=t.getStore();return e.coreState=s.getState().core,s.subscribe((i,r,n)=>{s.isCoreAction(i)&&!ve(r.core,n.core)&&(e.coreState=r.core)})}),e}function jt(t,e){K(e,!0);var s=z(),i=A(s);{var r=a=>{const o=re(()=>e.wrappers[0]);var l=z(),u=A(l);je(u,()=>f(o),(c,h)=>{h(c,{children:(y,m)=>{{let g=re(()=>e.wrappers.slice(1));jt(y,{get wrappers(){return f(g)},children:(S,b)=>{var p=z(),T=A(p);Y(T,()=>e.children??me),k(S,p)},$$slots:{default:!0}})}},$$slots:{default:!0}})}),k(a,l)},n=a=>{const o=re(()=>e.wrappers[0]);var l=z(),u=A(l);je(u,()=>f(o),(c,h)=>{h(c,{children:(y,m)=>{var g=z(),S=A(g);Y(S,()=>e.children??me),k(y,g)},$$slots:{default:!0}})}),k(a,l)};te(i,a=>{e.wrappers.length>1?a(r):a(n,!1)})}k(t,s),j()}var Mr=P("<!> <!>",1);function _r(t,e){K(e,!0);let s=X(V([])),i=X(V([]));N(()=>{const u=[],c=[];for(const h of e.plugins){const y=h.package;if(br(y)){const m=y.autoMountElements?.()??[];for(const g of m)g.type==="utility"?u.push(g.component):g.type==="wrapper"&&c.push(g.component)}}G(s,u,!0),G(i,c,!0)});var r=Mr(),n=A(r);{var a=u=>{jt(u,{get wrappers(){return f(i)},get children(){return e.children}})},o=u=>{var c=z(),h=A(c);Y(h,()=>e.children??me),k(u,c)};te(n,u=>{f(i).length>0?u(a):u(o,!1)})}var l=ge(n,2);pe(l,19,()=>f(s),(u,c)=>`utility-${c}`,(u,c)=>{var h=z(),y=A(h);je(y,()=>f(c),(m,g)=>{g(m,{})}),k(u,h)}),k(t,r),j()}function Ga(t,e){K(e,!0);let s=Ot(e,"autoMountDomElements",3,!0),i=e.onInitialized;N(()=>{e.onInitialized&&(i=e.onInitialized)}),N(()=>{if(e.engine||e.engine&&e.plugins){const l=new vr(e.engine,{logger:e.logger});return l.registerPluginBatch(e.plugins),(async()=>{await l.initialize(),!l.isDestroyed()&&(await i?.(l),!l.isDestroyed()&&(l.pluginsReady().then(()=>{l.isDestroyed()||(W.pluginsReady=!0)}),W.registry=l,W.isInitializing=!1))})().catch(console.error),()=>{l.destroy(),W.registry=null,W.isInitializing=!1,W.pluginsReady=!1}}});var r=z(),n=A(r);{var a=l=>{_r(l,{get plugins(){return e.plugins},children:(u,c)=>{var h=z(),y=A(h);Y(y,()=>e.children,()=>W),k(u,h)},$$slots:{default:!0}})},o=l=>{var u=z(),c=A(u);Y(c,()=>e.children,()=>W),k(l,u)};te(n,l=>{W.pluginsReady&&s()?l(a):l(o,!1)})}k(t,r),j()}class Nr{async load(e){const{pdfFile:s,options:i,engine:r}=e,n=r.openDocumentUrl(s,i);return new Promise((a,o)=>{n.wait(l=>a(l),l=>{l.type==="abort"?o(new Error(`PDF loading aborted: ${l.reason}`)):o(new Error(`PDF loading failed: ${l.reason}`))})})}}class Lr{async load(e){const{pdfFile:s,options:i,engine:r}=e,n=r.openDocumentBuffer(s,i);return new Promise((a,o)=>{n.wait(l=>a(l),l=>{l.type==="abort"?o(new Error(`PDF loading aborted: ${l.reason}`)):o(new Error(`PDF loading failed: ${l.reason}`))})})}}class Or{constructor(){this.strategies=new Map,this.strategyResolvers=[];const e=new Lr;this.registerStrategy("url",new Nr),this.registerStrategy("buffer",e),this.addStrategyResolver(s=>Dr(s)?this.strategies.get("url"):this.strategies.get("buffer"))}registerStrategy(e,s){this.strategies.set(e,s)}getStrategy(e){return this.strategies.get(e)}addStrategyResolver(e){this.strategyResolvers.push(e)}async loadDocument(e){try{const s=this.resolveStrategy(e);if(!s)throw new Error("No suitable strategy found for the given options");return await s.load(e)}catch(s){throw console.error("Error loading document:",s),s}}resolveStrategy(e){for(const s of this.strategyResolvers){const i=s(e);if(i)return i}}}function Dr(t){return t.type==="url"}const Ft=class extends le{constructor(e,s){super(e,s),this.id=e,this.loaderHandlers$=D(),this.documentLoadedHandlers$=D(),this.openFileRequest$=J(),this.documentLoader=new Or}buildCapability(){return{onLoaderEvent:this.loaderHandlers$.on,onDocumentLoaded:this.documentLoadedHandlers$.on,onOpenFileRequest:this.openFileRequest$.on,openFileDialog:()=>this.openFileRequest$.emit("open"),loadDocument:e=>this.loadDocument(e),registerStrategy:(e,s)=>this.documentLoader.registerStrategy(e,s),getDocument:()=>this.loadedDocument,addStrategyResolver:e=>this.documentLoader.addStrategyResolver(e)}}async initialize(e){e.defaultStrategies&&Object.entries(e.defaultStrategies).forEach(([s,i])=>{this.documentLoader.registerStrategy(s,i)}),e.loadingOptions&&(this.loadingOptions=e.loadingOptions)}async postInitialize(){this.loadingOptions&&await this.loadDocument(this.loadingOptions)}async loadDocument(e){try{this.loadedDocument&&this.engine.closeDocument(this.loadedDocument),this.loaderHandlers$.emit({type:"start",documentId:e.pdfFile.id}),this.dispatchCoreAction(pr());const s=await this.documentLoader.loadDocument({...e,engine:this.engine});return this.dispatchCoreAction(fr(s)),this.loadedDocument=s,this.loaderHandlers$.emit({type:"complete",documentId:e.pdfFile.id}),this.documentLoadedHandlers$.emit(s),s}catch(s){const i={type:"error",documentId:e.pdfFile.id,error:s instanceof Error?s:new Error(String(s))};throw this.loaderHandlers$.emit(i),s}}async destroy(){this.loaderHandlers$.clear(),this.documentLoadedHandlers$.clear(),this.openFileRequest$.clear(),super.destroy()}};Ft.id="loader";let Yt=Ft;const Qt="loader",Ar={id:Qt,name:"Loader Plugin",version:"1.0.0",provides:["loader"],requires:[],optional:[],metadata:{name:"Loader Plugin",description:"A plugin for loading PDF documents",version:"1.0.0",author:"EmbedPDF",license:"MIT"},defaultConfig:{enabled:!0}},zr={manifest:Ar,create:t=>new Yt(Qt,t),reducer:()=>{},initialState:{}},Hr=()=>ce(Yt.id);async function $r(t,e){const i=t.target.files?.[0],r=e.provides;if(i&&r){const n=await i.arrayBuffer();await r.loadDocument({type:"buffer",pdfFile:{id:Math.random().toString(36).substring(2,15),name:i.name,content:n}})}}var qr=P('<input type="file" accept="application/pdf" style="display: none"/>');function Ur(t,e){K(e,!0);const s=Hr();let i=null;N(()=>{if(!s.provides)return;const n=s.provides.onOpenFileRequest(a=>{a==="open"&&i&&i.click()});return()=>{n()}});var r=qr();r.__change=[$r,s],Le(r,n=>i=n,()=>i),k(t,r),j()}pi(["change"]);const Wa=Kt(zr).addUtility(Ur).build(),Jt="viewport",Gr={id:Jt,name:"Viewport Plugin",version:"1.0.0",provides:["viewport"],requires:[],optional:[],defaultConfig:{enabled:!0,viewportGap:10,scrollEndDelay:300}},Zt="SET_VIEWPORT_METRICS",es="SET_VIEWPORT_SCROLL_METRICS",ts="SET_VIEWPORT_GAP",ss="SET_SCROLL_ACTIVITY",is="SET_SMOOTH_SCROLL_ACTIVITY";function Pr(t){return{type:ts,payload:t}}function Wr(t){return{type:Zt,payload:t}}function Br(t){return{type:es,payload:t}}function Vr(t){return{type:ss,payload:t}}function bt(t){return{type:is,payload:t}}const rs={viewportGap:0,viewportMetrics:{width:0,height:0,scrollTop:0,scrollLeft:0,clientWidth:0,clientHeight:0,scrollWidth:0,scrollHeight:0,relativePosition:{x:0,y:0}},isScrolling:!1,isSmoothScrolling:!1},Xr=(t=rs,e)=>{switch(e.type){case ts:return{...t,viewportGap:e.payload};case Zt:return{...t,viewportMetrics:{width:e.payload.width,height:e.payload.height,scrollTop:e.payload.scrollTop,scrollLeft:e.payload.scrollLeft,clientWidth:e.payload.clientWidth,clientHeight:e.payload.clientHeight,scrollWidth:e.payload.scrollWidth,scrollHeight:e.payload.scrollHeight,relativePosition:{x:e.payload.scrollWidth<=e.payload.clientWidth?0:e.payload.scrollLeft/(e.payload.scrollWidth-e.payload.clientWidth),y:e.payload.scrollHeight<=e.payload.clientHeight?0:e.payload.scrollTop/(e.payload.scrollHeight-e.payload.clientHeight)}}};case es:return{...t,viewportMetrics:{...t.viewportMetrics,scrollTop:e.payload.scrollTop,scrollLeft:e.payload.scrollLeft},isScrolling:!0};case ss:return{...t,isScrolling:e.payload};case is:return{...t,isSmoothScrolling:e.payload};default:return t}},ns=class extends le{constructor(e,s,i){super(e,s),this.id=e,this.viewportResize$=D(),this.viewportMetrics$=D(),this.scrollMetrics$=D(),this.scrollReq$=J(),this.scrollActivity$=D(),this.rectProvider=null,i.viewportGap&&this.dispatch(Pr(i.viewportGap)),this.scrollEndDelay=i.scrollEndDelay||100}buildCapability(){return{getViewportGap:()=>this.state.viewportGap,getMetrics:()=>this.state.viewportMetrics,getBoundingRect:()=>this.rectProvider?.()??{origin:{x:0,y:0},size:{width:0,height:0}},scrollTo:e=>this.scrollTo(e),isScrolling:()=>this.state.isScrolling,isSmoothScrolling:()=>this.state.isSmoothScrolling,onScrollChange:this.scrollMetrics$.on,onViewportChange:this.viewportMetrics$.on,onViewportResize:this.viewportResize$.on,onScrollActivity:this.scrollActivity$.on}}setViewportResizeMetrics(e){this.registry.isDestroyed()||(this.dispatch(Wr(e)),this.viewportResize$.emit(this.state.viewportMetrics))}setViewportScrollMetrics(e){this.registry.isDestroyed()||(e.scrollTop!==this.state.viewportMetrics.scrollTop||e.scrollLeft!==this.state.viewportMetrics.scrollLeft)&&(this.dispatch(Br(e)),this.bumpScrollActivity(),this.scrollMetrics$.emit({scrollTop:e.scrollTop,scrollLeft:e.scrollLeft}))}onScrollRequest(e){return this.scrollReq$.on(e)}registerBoundingRectProvider(e){this.rectProvider=e}bumpScrollActivity(){this.debouncedDispatch(Vr(!1),this.scrollEndDelay),this.debouncedDispatch(bt(!1),this.scrollEndDelay)}scrollTo(e){const{x:s,y:i,center:r,behavior:n="auto"}=e;if(n==="smooth"&&this.dispatch(bt(!0)),r){const a=this.state.viewportMetrics,o=s-a.clientWidth/2,l=i-a.clientHeight/2;this.scrollReq$.emit({x:o,y:l,behavior:n})}else this.scrollReq$.emit({x:s,y:i,behavior:n})}emitScrollActivity(){const e={isSmoothScrolling:this.state.isSmoothScrolling,isScrolling:this.state.isScrolling};this.scrollActivity$.emit(e)}onStoreUpdated(e,s){e!==s&&(this.viewportMetrics$.emit(s.viewportMetrics),(e.isScrolling!==s.isScrolling||e.isSmoothScrolling!==s.isSmoothScrolling)&&this.emitScrollActivity())}async initialize(e){}async destroy(){super.destroy(),this.viewportMetrics$.clear(),this.viewportResize$.clear(),this.scrollMetrics$.clear(),this.scrollReq$.clear(),this.scrollActivity$.clear(),this.rectProvider=null}};ns.id="viewport";let ot=ns;const Va={manifest:Gr,create:(t,e)=>new ot(Jt,t,e),reducer:Xr,initialState:rs},Kr=()=>Re(ot.id),jr=()=>ce(ot.id);function Fr(){const{plugin:t}=Kr();let e=X(null);return fi(()=>{if(!t)return;const s=f(e);if(!s)return;const i=()=>{const o=s.getBoundingClientRect();return{origin:{x:o.left,y:o.top},size:{width:o.width,height:o.height}}};t.registerBoundingRectProvider(i);const r=()=>{t?.setViewportScrollMetrics({scrollTop:s.scrollTop,scrollLeft:s.scrollLeft})};s.addEventListener("scroll",r);const n=new ResizeObserver(()=>{t?.setViewportResizeMetrics({width:s.offsetWidth,height:s.offsetHeight,clientWidth:s.clientWidth,clientHeight:s.clientHeight,scrollTop:s.scrollTop,scrollLeft:s.scrollLeft,scrollWidth:s.scrollWidth,scrollHeight:s.scrollHeight})});n.observe(s);const a=t.onScrollRequest(({x:o,y:l,behavior:u="auto"})=>{requestAnimationFrame(()=>{s.scrollTo({left:o,top:l,behavior:u})})});return()=>{t?.registerBoundingRectProvider(null),s.removeEventListener("scroll",r),n.disconnect(),a()}}),{get containerRef(){return f(e)},set containerRef(s){G(e,s,!0)}}}var Yr=P("<div><!></div>");function Xa(t,e){K(e,!0);let s=be(e,["$$slots","$$events","$$legacy","children","class"]),i=X(0),r=Fr();const n=jr();N(()=>{n.provides&&G(i,n.provides.getViewportGap(),!0)});var a=Yr();Se(a,l=>({...s,class:e.class,[Oe]:l}),[()=>({width:"100%",height:"100%",overflow:"auto",padding:`${f(i)}px`})]);var o=we(a);Y(o,()=>e.children),ee(a),Le(a,l=>r.containerRef=l,()=>r?.containerRef),k(t,a),j()}const as=class extends le{constructor(e,s){super(e,s),this.refreshPages$=J(),this.coreStore.onAction(Vt,i=>{this.refreshPages$.emit(i.payload)})}async initialize(e){}buildCapability(){return{renderPage:this.renderPage.bind(this),renderPageRect:this.renderPageRect.bind(this)}}onRefreshPages(e){return this.refreshPages$.on(e)}renderPage({pageIndex:e,options:s}){const i=this.coreState.core;if(!i.document)throw new Error("document does not open");const r=i.document.pages.find(n=>n.index===e);if(!r)throw new Error("page does not exist");return this.engine.renderPage(i.document,r,s)}renderPageRect({pageIndex:e,rect:s,options:i}){const r=this.coreState.core;if(!r.document)throw new Error("document does not open");const n=r.document.pages.find(a=>a.index===e);if(!n)throw new Error("page does not exist");return this.engine.renderPageRect(r.document,n,s,i)}};as.id="render";let lt=as;const os="render",Qr={id:os,name:"Render Plugin",version:"1.0.0",provides:["render"],requires:[],optional:[],defaultConfig:{enabled:!0}},ja={manifest:Qr,create:t=>new lt(os,t),reducer:()=>{},initialState:{}},Jr=()=>Re(lt.id),Zr=()=>ce(lt.id);var en=P("<img/>");function Fa(t,e){K(e,!0);let s=be(e,["$$slots","$$events","$$legacy","pageIndex","scale","dpr","class"]);const i=Zr(),r=Jr(),n=re(()=>e.scale??1);let a=X(null),o=null,l=X(0);N(()=>{if(r.plugin)return r.plugin.onRefreshPages(m=>{m.includes(e.pageIndex)&&yi(l)})}),N(()=>{f(l);const m=i.provides;if(!m)return;const g=m.renderPage({pageIndex:e.pageIndex,options:{scaleFactor:f(n),dpr:e.dpr||window.devicePixelRatio}});return g.wait(S=>{const b=URL.createObjectURL(S);o&&URL.revokeObjectURL(o),G(a,b,!0),o=b},ae),()=>{o?(URL.revokeObjectURL(o),o=null):g.abort({code:oe.Cancelled,message:"canceled render task"})}});function u(){o&&(URL.revokeObjectURL(o),o=null)}var c=z(),h=A(c);{var y=m=>{var g=en();Se(g,()=>({src:f(a),onload:u,...s,style:"width: 100%; height: 100%;",class:e.class,alt:""})),mi(g),k(m,g)};te(h,m=>{f(a)&&m(y)})}k(t,c),j()}var q=(t=>(t.Vertical="vertical",t.Horizontal="horizontal",t))(q||{});class ls{constructor(e){this.pageGap=e.pageGap??20,this.viewportGap=e.viewportGap??20,this.bufferSize=e.bufferSize??2}getVisibleRange(e,s,i){const r=this.getScrollOffset(e),n=this.getClientSize(e),a=r,o=r+n;let l=0;for(;l<s.length&&(s[l].offset+s[l].height)*i<=a;)l++;let u=l;for(;u<s.length&&s[u].offset*i<=o;)u++;return{start:Math.max(0,l-this.bufferSize),end:Math.min(s.length-1,u+this.bufferSize-1)}}handleScroll(e,s,i){const r=this.getVisibleRange(e,s,i),n=s.slice(r.start,r.end+1),a=this.calculatePageVisibility(n,e,i),o=a.map(g=>g.pageNumber),l=s.slice(r.start,r.end+1).flatMap(g=>g.index),u=this.determineCurrentPage(a),c=s[r.start],h=s[r.end],y=c?c.offset*i:0,m=h?(s[s.length-1].offset+s[s.length-1].height)*i-(h.offset+h.height)*i:0;return{currentPage:u,visiblePages:o,pageVisibilityMetrics:a,renderedPageIndexes:l,scrollOffset:{x:e.scrollLeft,y:e.scrollTop},startSpacing:y,endSpacing:m}}calculatePageVisibility(e,s,i){const r=[];return e.forEach(n=>{n.pageLayouts.forEach(a=>{const o=n.x*i,l=n.y*i,u=o+a.x*i,c=l+a.y*i,h=a.rotatedWidth*i,y=a.rotatedHeight*i,m=s.scrollLeft,g=s.scrollTop,S=m+s.clientWidth,b=g+s.clientHeight,p=Math.max(u,m),T=Math.max(c,g),E=Math.min(u+h,S),_=Math.min(c+y,b);if(p<E&&T<_){const I=E-p,d=_-T,x=h*y,M=I*d;r.push({pageNumber:a.pageNumber,viewportX:p-m,viewportY:T-g,visiblePercentage:M/x*100,original:{pageX:(p-u)/i,pageY:(T-c)/i,visibleWidth:I/i,visibleHeight:d/i,scale:1},scaled:{pageX:p-u,pageY:T-c,visibleWidth:I,visibleHeight:d,scale:i}})}})}),r}determineCurrentPage(e){if(e.length===0)return 1;const s=Math.max(...e.map(r=>r.visiblePercentage)),i=e.filter(r=>r.visiblePercentage===s);return i.length===1?i[0].pageNumber:i.sort((r,n)=>r.pageNumber-n.pageNumber)[0].pageNumber}getRectLocationForPage(e,s,i){const r=s.find(o=>o.pageNumbers.includes(e));if(!r)return null;const n=r.pageLayouts.find(o=>o.pageNumber===e);if(!n)return null;let a=0;if(i){const o=i.width;r.width<o&&(a=(o-r.width)/2)}return{origin:{x:r.x+n.x+a,y:r.y+n.y},size:{width:n.width,height:n.height}}}getScrollPositionForPage(e,s,i,r,n){const a=this.getTotalContentSize(s),o=this.getRectLocationForPage(e,s,a);if(!o)return null;const l=Me(o.origin,i);if(n){const u=Ci({width:o.size.width,height:o.size.height},{x:n.x,y:n.y},r,i);return{x:l.x+u.x+this.viewportGap,y:l.y+u.y+this.viewportGap}}return{x:l.x+this.viewportGap,y:l.y+this.viewportGap}}getRectPositionForPage(e,s,i,r,n){const a=this.getTotalContentSize(s),o=this.getRectLocationForPage(e,s,a);if(!o)return null;const l=Me(o.origin,i),u=Ti({width:o.size.width,height:o.size.height},n,r,i);return{origin:{x:l.x+u.origin.x,y:l.y+u.origin.y},size:u.size}}}class Be extends ls{constructor(e){super(e)}createVirtualItems(e){let s=0;return e.map((i,r)=>{let n=0;const a=i.map(c=>{const h={pageNumber:c.index+1,pageIndex:c.index,x:n,y:0,width:c.size.width,height:c.size.height,rotatedWidth:c.rotatedSize.width,rotatedHeight:c.rotatedSize.height};return n+=c.rotatedSize.width+this.pageGap,h}),o=i.reduce((c,h,y)=>c+h.rotatedSize.width+(y<i.length-1?this.pageGap:0),0),l=Math.max(...i.map(c=>c.rotatedSize.height)),u={id:`item-${r}`,x:0,y:s,offset:s,width:o,height:l,pageLayouts:a,pageNumbers:i.map(c=>c.index+1),index:r};return s+=l+this.pageGap,u})}getTotalContentSize(e){if(e.length===0)return{width:0,height:0};const s=Math.max(...e.map(r=>r.width)),i=e[e.length-1].y+e[e.length-1].height;return{width:s,height:i}}getScrollOffset(e){return e.scrollTop}getClientSize(e){return e.clientHeight}}class Ve extends ls{constructor(e){super(e)}createVirtualItems(e){let s=0;return e.map((i,r)=>{let n=0;const a=i.map(c=>{const h={pageNumber:c.index+1,pageIndex:c.index,x:n,y:0,width:c.size.width,height:c.size.height,rotatedWidth:c.rotatedSize.width,rotatedHeight:c.rotatedSize.height};return n+=c.rotatedSize.width+this.pageGap,h}),o=i.reduce((c,h,y)=>c+h.rotatedSize.width+(y<i.length-1?this.pageGap:0),0),l=Math.max(...i.map(c=>c.rotatedSize.height)),u={id:`item-${r}`,x:s,y:0,offset:s,width:o,height:l,pageLayouts:a,pageNumbers:i.map(c=>c.index+1),index:r};return s+=o+this.pageGap,u})}getTotalContentSize(e){if(e.length===0)return{width:0,height:0};const s=e[e.length-1].x+e[e.length-1].width,i=Math.max(...e.map(r=>r.height));return{width:s,height:i}}getScrollOffset(e){return e.scrollLeft}getClientSize(e){return e.clientWidth}}const cs="UPDATE_SCROLL_STATE",tn="SET_DESIRED_SCROLL_POSITION",us="UPDATE_TOTAL_PAGES",hs="SET_PAGE_CHANGE_STATE";function St(t){return{type:cs,payload:t}}function sn(t){return{type:us,payload:t}}function Ct(t){return{type:hs,payload:t}}const rn=(t,e)=>({startSpacing:t.startSpacing,endSpacing:t.endSpacing,totalWidth:t.totalContentSize.width*e,totalHeight:t.totalContentSize.height*e,pageGap:t.pageGap*e,strategy:t.strategy,items:t.renderedPageIndexes.map(s=>({...t.virtualItems[s],pageLayouts:t.virtualItems[s].pageLayouts.map(i=>({...i,rotatedWidth:i.rotatedWidth*e,rotatedHeight:i.rotatedHeight*e,width:i.width*e,height:i.height*e}))}))}),gs=class extends le{constructor(e,s,i){super(e,s),this.id=e,this.config=i,this.currentScale=1,this.currentRotation=tt.Degree0,this.currentPage=1,this.layoutReady=!1,this.pageChangeState$=D(),this.layout$=D(),this.scroll$=D(),this.state$=D(),this.scrollerLayout$=D(),this.pageChange$=D(),this.layoutReady$=D(),this.viewport=this.registry.getPlugin("viewport").provides(),this.strategyConfig={pageGap:this.config?.pageGap??10,viewportGap:this.viewport.getViewportGap(),bufferSize:this.config?.bufferSize??2},this.strategy=this.config?.strategy===q.Horizontal?new Ve(this.strategyConfig):new Be(this.strategyConfig),this.initialPage=this.config?.initialPage,this.currentScale=this.coreState.core.scale,this.currentRotation=this.coreState.core.rotation,this.viewport.onScrollActivity(r=>{this.state.pageChangeState.isChanging&&!r.isSmoothScrolling&&this.completePageChange()}),this.viewport.onViewportChange(r=>this.commitMetrics(this.computeMetrics(r)),{mode:"throttle",wait:100}),this.coreStore.onAction(Ce,(r,n)=>{const a=n.core.pages.length;this.dispatch(sn(a)),this.pageChange$.emit({pageNumber:this.currentPage,totalPages:a}),this.refreshAll(Ie(n.core),this.viewport.getMetrics())}),this.coreStore.onAction(Ae,(r,n)=>this.refreshAll(Ie(n.core),this.viewport.getMetrics())),this.coreStore.onAction(ze,(r,n)=>this.refreshAll(Ie(n.core),this.viewport.getMetrics()))}startPageChange(e,s="smooth"){const i={isChanging:!0,targetPage:e,fromPage:this.currentPage,startTime:Date.now()};this.dispatch(Ct(i)),s==="instant"&&this.completePageChange()}completePageChange(){if(!this.state.pageChangeState.isChanging)return;const e={isChanging:!1,targetPage:this.state.pageChangeState.targetPage,fromPage:this.state.pageChangeState.fromPage,startTime:this.state.pageChangeState.startTime};this.dispatch(Ct(e))}computeLayout(e){const s=this.strategy.createVirtualItems(e),i=this.strategy.getTotalContentSize(s);return{virtualItems:s,totalContentSize:i}}computeMetrics(e,s=this.state.virtualItems){return this.strategy.handleScroll(e,s,this.currentScale)}commit(e,s){this.dispatch(St(e)),s?.layout&&this.layout$.emit(s.layout),s?.metrics&&(this.scroll$.emit(s.metrics),s.metrics.currentPage!==this.currentPage&&(this.currentPage=s.metrics.currentPage,this.pageChange$.emit({pageNumber:this.currentPage,totalPages:this.state.totalPages}))),this.scrollerLayout$.emit(this.getScrollerLayout())}commitMetrics(e){this.commit(e,{metrics:e})}refreshAll(e,s){const i=this.computeLayout(e),r=this.computeMetrics(s,i.virtualItems);this.commit({...i,...r},{layout:i,metrics:r})}getVirtualItemsFromState(){return this.state.virtualItems||[]}onScrollerData(e){return this.scrollerLayout$.on(e)}getScrollerLayout(){const e=this.coreState.core.scale;return rn(this.state,e)}pushScrollLayout(){this.scrollerLayout$.emit(this.getScrollerLayout())}onStoreUpdated(e,s){this.pushScrollLayout(),e.pageChangeState!==s.pageChangeState&&this.pageChangeState$.emit(s.pageChangeState)}onCoreStoreUpdated(e,s){e.core.scale!==s.core.scale&&(this.currentScale=s.core.scale,this.commitMetrics(this.computeMetrics(this.viewport.getMetrics()))),e.core.rotation!==s.core.rotation&&(this.currentRotation=s.core.rotation)}setScrollStrategy(e){if(e===q.Horizontal&&this.strategy instanceof Ve||e===q.Vertical&&this.strategy instanceof Be)return;this.strategy=e===q.Horizontal?new Ve(this.strategyConfig):new Be(this.strategyConfig),this.dispatch(St({strategy:e}));const s=Ie(this.coreState.core);this.refreshAll(s,this.viewport.getMetrics())}setLayoutReady(){this.layoutReady||(this.layoutReady=!0,this.layoutReady$.emit(!0),this.initialPage&&this.scrollToPage({pageNumber:this.initialPage,behavior:"instant"}))}buildCapability(){return{onStateChange:this.state$.on,onLayoutChange:this.layout$.on,onScroll:this.scroll$.on,onPageChange:this.pageChange$.on,onLayoutReady:this.layoutReady$.on,onPageChangeState:this.pageChangeState$.on,getCurrentPage:()=>this.currentPage,getTotalPages:()=>this.state.totalPages,getPageChangeState:()=>this.state.pageChangeState,scrollToPage:this.scrollToPage.bind(this),scrollToNextPage:this.scrollToNextPage.bind(this),scrollToPreviousPage:this.scrollToPreviousPage.bind(this),getMetrics:this.getMetrics.bind(this),getLayout:this.getLayout.bind(this),getRectPositionForPage:this.getRectPositionForPage.bind(this),getPageGap:()=>this.state.pageGap,setScrollStrategy:e=>this.setScrollStrategy(e)}}scrollToPage(e){const{pageNumber:s,behavior:i="smooth",pageCoordinates:r,center:n=!1}=e;this.startPageChange(s,i);const a=this.getVirtualItemsFromState(),o=this.strategy.getScrollPositionForPage(s,a,this.currentScale,this.currentRotation,r);o?this.viewport.scrollTo({...o,behavior:i,center:n}):this.completePageChange()}scrollToNextPage(e="smooth"){const s=this.getVirtualItemsFromState(),i=s.findIndex(r=>r.pageNumbers.includes(this.currentPage));if(i>=0&&i<s.length-1){const r=s[i+1],n=r.pageNumbers[0];this.startPageChange(n,e);const a=this.strategy.getScrollPositionForPage(r.pageNumbers[0],s,this.currentScale,this.currentRotation);a?this.viewport.scrollTo({...a,behavior:e}):this.completePageChange()}}scrollToPreviousPage(e="smooth"){const s=this.getVirtualItemsFromState(),i=s.findIndex(r=>r.pageNumbers.includes(this.currentPage));if(i>0){const r=s[i-1],n=r.pageNumbers[0];this.startPageChange(n,e);const a=this.strategy.getScrollPositionForPage(r.pageNumbers[0],s,this.currentScale,this.currentRotation);a?this.viewport.scrollTo({...a,behavior:e}):this.completePageChange()}}getMetrics(e){const s=e||this.viewport.getMetrics(),i=this.getVirtualItemsFromState();return this.strategy.handleScroll(s,i,this.currentScale)}getLayout(){return{virtualItems:this.state.virtualItems,totalContentSize:this.state.totalContentSize}}getRectPositionForPage(e,s,i,r){return this.strategy.getRectPositionForPage(e+1,this.state.virtualItems,i??this.currentScale,r??this.currentRotation,s)}async initialize(){}async destroy(){this.layout$.clear(),this.scroll$.clear(),this.pageChange$.clear(),this.state$.clear(),this.scrollerLayout$.clear(),this.layoutReady$.clear(),this.pageChangeState$.clear(),super.destroy()}};gs.id="scroll";let ct=gs;const ds="scroll",nn={id:ds,name:"Scroll Plugin",version:"1.0.0",provides:["scroll"],requires:["viewport"],optional:[],defaultConfig:{enabled:!0,pageGap:10}},an={currentPage:1,visiblePages:[],pageVisibilityMetrics:[],renderedPageIndexes:[],scrollOffset:{x:0,y:0},startSpacing:0,endSpacing:0},on={isChanging:!1,targetPage:1,fromPage:1,startTime:0},ln=(t,e)=>({virtualItems:[],totalPages:t.pages.length,totalContentSize:{width:0,height:0},desiredScrollPosition:{x:0,y:0},strategy:e.strategy??q.Vertical,pageGap:e.pageGap??10,scale:t.scale,pageChangeState:on,...an}),cn=(t,e)=>{switch(e.type){case us:return{...t,totalPages:e.payload};case De:return{...t,scale:e.payload};case cs:return{...t,...e.payload};case tn:return{...t,desiredScrollPosition:e.payload};case hs:return{...t,pageChangeState:e.payload};default:return t}},Qa={manifest:nn,create:(t,e)=>new ct(ds,t,e),reducer:cn,initialState:(t,e)=>ln(t,e)},un=()=>Re(ct.id),hn=()=>ce(ct.id),Ja=()=>{const t=hn(),e=V({get provides(){return t.provides},state:{currentPage:1,totalPages:1}});return N(()=>{if(t.provides)return t.provides.onPageChange(({pageNumber:s,totalPages:i})=>{e.state.currentPage=s,e.state.totalPages=i})}),e};var gn=P("<div><!></div>"),dn=P("<div></div>"),pn=P("<div><div></div> <div></div> <div></div> <!></div>");function Za(t,e){K(e,!0);const s=un(),i=kr();let r=re(()=>s.plugin?.getScrollerLayout()??null),n=be(e,["$$slots","$$events","$$legacy","RenderPageSnippet","overlayElements"]);N(()=>{if(s.plugin)return s.plugin.onScrollerData(u=>G(r,u))}),N(()=>{s.plugin&&s.plugin.setLayoutReady()});var a=z(),o=A(a);{var l=u=>{var c=pn();Se(c,E=>({...n,[Oe]:E}),[()=>({width:`${f(r).totalWidth}px`,height:`${f(r).totalHeight}px`,position:"relative","box-sizing":"border-box",margin:"0 auto",display:f(r).strategy===q.Horizontal?"flex":null,"flex-direction":f(r).strategy===q.Horizontal?"row":null})]);var h=we(c);let y;var m=ge(h,2);let g;pe(m,21,()=>f(r).items,E=>E.pageNumbers[0],(E,_)=>{var I=dn();let d;pe(I,21,()=>f(_).pageLayouts,x=>x.pageNumber,(x,M)=>{var U=gn();let se;var Q=we(U);{let H=re(()=>({...f(M),rotation:i.coreState.rotation,scale:i.coreState.scale,document:i.coreState.document}));Y(Q,()=>e.RenderPageSnippet??me,()=>f(H))}ee(U),de(H=>se=Z(U,"",se,H),[()=>({width:`${f(M).rotatedWidth}px`,height:`${f(M).rotatedHeight}px`})]),k(x,U)}),ee(I),de(x=>d=Z(I,"",d,x),[()=>({display:"flex","justify-content":"center",gap:`${f(r).pageGap}px`})]),k(E,I)}),ee(m);var S=ge(m,2);let b;var p=ge(S,2);{var T=E=>{var _=z(),I=A(_);pe(I,17,()=>e.overlayElements,Dt,(d,x)=>{var M=z(),U=A(M);Y(U,()=>f(x)??me),k(d,M)}),k(E,_)};te(p,E=>{e.overlayElements&&e.overlayElements.length>0&&E(T)})}ee(c),de((E,_,I)=>{y=Z(h,"",y,E),g=Z(m,"",g,_),b=Z(S,"",b,I)},[()=>({width:f(r).strategy===q.Horizontal?`${f(r).startSpacing}px`:"100%",height:f(r).strategy===q.Horizontal?"100%":`${f(r).startSpacing}px`,"flex-shrink":"0"}),()=>({gap:`${f(r).pageGap}px`,display:"flex","align-items":"center",position:"relative","box-sizing":"border-box","flex-direction":f(r).strategy===q.Horizontal?"row":"column","min-width":f(r).strategy===q.Horizontal?"100%":"fit-content"}),()=>({width:f(r).strategy===q.Horizontal?`${f(r).endSpacing}px`:"100%",height:f(r).strategy===q.Horizontal?"100%":`${f(r).endSpacing}px`,"flex-shrink":"0"})]),k(u,c)};te(o,u=>{f(r)&&i.coreState&&u(l)})}k(t,a),j()}const ps="INTERACTION/ACTIVATE_MODE",fs="INTERACTION/PAUSE",ys="INTERACTION/RESUME",ms="INTERACTION/SET_CURSOR",ws="INTERACTION/SET_DEFAULT_MODE",vs="INTERACTION/SET_EXCLUSION_RULES",bs="INTERACTION/ADD_EXCLUSION_CLASS",Ss="INTERACTION/REMOVE_EXCLUSION_CLASS",Cs="INTERACTION/ADD_EXCLUSION_ATTRIBUTE",Rs="INTERACTION/REMOVE_EXCLUSION_ATTRIBUTE",Rt=t=>({type:vs,payload:{rules:t}}),fn=t=>({type:bs,payload:{className:t}}),yn=t=>({type:Ss,payload:{className:t}}),mn=t=>({type:Cs,payload:{attribute:t}}),wn=t=>({type:Rs,payload:{attribute:t}}),vn=t=>({type:ps,payload:{mode:t}}),bn=t=>({type:ms,payload:{cursor:t}}),Sn=t=>({type:ws,payload:{mode:t}}),Cn=()=>({type:fs}),Rn=()=>({type:ys});function Tn(t){const e=["onPointerDown","onPointerUp","onPointerMove","onPointerEnter","onPointerLeave","onPointerCancel","onMouseDown","onMouseUp","onMouseMove","onMouseEnter","onMouseLeave","onMouseCancel","onClick","onDoubleClick"],s={};for(const i of e)s[i]=(r,n,a)=>{for(const o of t)o[i]?.(r,n,a)};return s}const Xe="pointerMode",Ts=class extends le{constructor(e,s,i){super(e,s),this.modes=new Map,this.cursorClaims=new Map,this.buckets=new Map,this.alwaysGlobal=new Set,this.alwaysPage=new Map,this.onModeChange$=J(),this.onHandlerChange$=J(),this.onCursorChange$=J(),this.onStateChange$=D(),this.registerMode({id:Xe,scope:"page",exclusive:!1,cursor:"auto"}),this.setDefaultMode(Xe),this.activate(Xe),i.exclusionRules&&this.dispatch(Rt(i.exclusionRules))}async initialize(e){}buildCapability(){return{activate:e=>this.activate(e),onModeChange:this.onModeChange$.on,onCursorChange:this.onCursorChange$.on,onHandlerChange:this.onHandlerChange$.on,onStateChange:this.onStateChange$.on,getActiveMode:()=>this.state.activeMode,getActiveInteractionMode:()=>this.getActiveInteractionMode(),activateDefaultMode:()=>this.activate(this.state.defaultMode),registerMode:e=>this.registerMode(e),registerHandlers:e=>this.registerHandlers(e),registerAlways:e=>this.registerAlways(e),setCursor:(e,s,i=0)=>this.setCursor(e,s,i),removeCursor:e=>this.removeCursor(e),getCurrentCursor:()=>this.state.cursor,getHandlersForScope:e=>this.getHandlersForScope(e),activeModeIsExclusive:()=>this.activeModeIsExclusive(),pause:()=>this.dispatch(Cn()),resume:()=>this.dispatch(Rn()),isPaused:()=>this.registry.isDestroyed()||this.state.paused,setDefaultMode:e=>this.setDefaultMode(e),getDefaultMode:()=>this.state.defaultMode,getExclusionRules:()=>this.state.exclusionRules,setExclusionRules:e=>this.dispatch(Rt(e)),addExclusionClass:e=>this.dispatch(fn(e)),removeExclusionClass:e=>this.dispatch(yn(e)),addExclusionAttribute:e=>this.dispatch(mn(e)),removeExclusionAttribute:e=>this.dispatch(wn(e))}}activate(e){if(!this.modes.has(e))throw new Error(`[interaction] unknown mode '${e}'`);if(e===this.state.activeMode)return;const s=this.state.activeMode;this.cursorClaims.clear(),this.notifyHandlersInactive(s),this.dispatch(vn(e)),this.emitCursor(),this.notifyHandlersActive(e),this.onModeChange$.emit({...this.state,activeMode:e})}setDefaultMode(e){if(!this.modes.has(e))throw new Error(`[interaction] cannot set unknown mode '${e}' as default`);this.dispatch(Sn(e))}notifyHandlersActive(e){this.alwaysGlobal.forEach(r=>{r.onHandlerActiveStart?.(e)}),this.alwaysPage.forEach(r=>{r.forEach(n=>{n.onHandlerActiveStart?.(e)})});const s=this.modes.get(e);if(!s)return;const i=this.buckets.get(e);i&&(s.scope==="global"&&i.global.forEach(r=>{r.onHandlerActiveStart?.(e)}),s.scope==="page"&&i.page.forEach((r,n)=>{r.forEach(a=>{a.onHandlerActiveStart?.(e)})}))}notifyHandlersInactive(e){this.alwaysGlobal.forEach(r=>{r.onHandlerActiveEnd?.(e)}),this.alwaysPage.forEach(r=>{r.forEach(n=>{n.onHandlerActiveEnd?.(e)})});const s=this.modes.get(e);if(!s)return;const i=this.buckets.get(e);i&&(s.scope==="global"&&i.global.forEach(r=>{r.onHandlerActiveEnd?.(e)}),s.scope==="page"&&i.page.forEach((r,n)=>{r.forEach(a=>{a.onHandlerActiveEnd?.(e)})}))}registerMode(e){this.modes.set(e.id,e),this.buckets.has(e.id)||this.buckets.set(e.id,{global:new Set,page:new Map})}registerHandlers({modeId:e,handlers:s,pageIndex:i}){const r=Array.isArray(e)?e:[e],n=[];for(const a of r){const o=this.buckets.get(a);if(!o)throw new Error(`unknown mode '${a}'`);if(i==null)o.global.add(s);else{const l=o.page.get(i)??new Set;l.add(s),o.page.set(i,l)}n.push(()=>{if(i==null)o.global.delete(s);else{const l=o.page.get(i);l&&(l.delete(s),l.size===0&&o.page.delete(i))}})}return this.onHandlerChange$.emit({...this.state}),()=>{n.forEach(a=>a()),this.onHandlerChange$.emit({...this.state})}}registerAlways({scope:e,handlers:s}){if(e.type==="global")return this.alwaysGlobal.add(s),this.onHandlerChange$.emit({...this.state}),()=>this.alwaysGlobal.delete(s);const i=this.alwaysPage.get(e.pageIndex)??new Set;return i.add(s),this.alwaysPage.set(e.pageIndex,i),this.onHandlerChange$.emit({...this.state}),()=>{i.delete(s),this.onHandlerChange$.emit({...this.state})}}getHandlersForScope(e){if(!this.state)return null;const s=this.modes.get(this.state.activeMode);if(!s)return null;const i=this.buckets.get(s.id);if(!i)return null;const r=(o,l)=>o.size||l.size?Tn([...o,...l]):null;if(e.type==="global"){const o=s.scope==="global"?i.global:new Set;return r(this.alwaysGlobal,o)}const n=this.alwaysPage.get(e.pageIndex)??new Set,a=s.scope==="page"?i.page.get(e.pageIndex)??new Set:new Set;return r(n,a)}setCursor(e,s,i=0){this.cursorClaims.set(e,{cursor:s,priority:i}),this.emitCursor()}removeCursor(e){this.cursorClaims.delete(e),this.emitCursor()}emitCursor(){const e=[...this.cursorClaims.values()].sort((s,i)=>i.priority-s.priority)[0]??{cursor:this.modes.get(this.state.activeMode)?.cursor??"auto"};e.cursor!==this.state.cursor&&(this.dispatch(bn(e.cursor)),this.onCursorChange$.emit(e.cursor))}onStoreUpdated(e,s){this.onStateChange$.emit(s)}activeModeIsExclusive(){return!!this.modes.get(this.state.activeMode)?.exclusive}getActiveInteractionMode(){return this.modes.get(this.state.activeMode)??null}async destroy(){this.onModeChange$.clear(),this.onCursorChange$.clear(),await super.destroy()}};Ts.id="interaction-manager";let xs=Ts;const Es="interaction-manager",xn={id:Es,name:"Interaction Manager Plugin",version:"1.0.0",provides:["interaction-manager"],requires:[],optional:[],defaultConfig:{enabled:!0,exclusionRules:{classes:[],dataAttributes:["data-no-interaction"]}}},Is={activeMode:"pointerMode",defaultMode:"pointerMode",cursor:"auto",paused:!1,exclusionRules:{classes:[],dataAttributes:[]}},En=(t,e)=>{switch(e.type){case ps:return{...t,activeMode:e.payload.mode};case ms:return{...t,cursor:e.payload.cursor};case fs:return{...t,paused:!0};case ys:return{...t,paused:!1};case ws:return{...t,defaultMode:e.payload.mode};case vs:return{...t,exclusionRules:e.payload.rules};case bs:return{...t,exclusionRules:{...t.exclusionRules,classes:[...t.exclusionRules.classes||[],e.payload.className].filter((s,i,r)=>r.indexOf(s)===i)}};case Ss:return{...t,exclusionRules:{...t.exclusionRules,classes:(t.exclusionRules.classes||[]).filter(s=>s!==e.payload.className)}};case Cs:return{...t,exclusionRules:{...t.exclusionRules,dataAttributes:[...t.exclusionRules.dataAttributes||[],e.payload.attribute].filter((s,i,r)=>r.indexOf(s)===i)}};case Rs:return{...t,exclusionRules:{...t.exclusionRules,dataAttributes:(t.exclusionRules.dataAttributes||[]).filter(s=>s!==e.payload.attribute)}};default:return t}},to={manifest:xn,create:(t,e)=>new xs(Es,t,e),reducer:En,initialState:Is},Te=()=>ce(xs.id);function so(){const t=Te(),e=V({get provides(){return t.provides},state:Is});return N(()=>{if(t.provides)return t.provides.onStateChange(s=>{e.state=s})}),e}function io({modeId:t,pageIndex:e}={}){const s=Te();return{register:(i,r)=>{const n=r?.modeId??t,a=r?.pageIndex??e;return n?s.provides?.registerHandlers({modeId:n,handlers:i,pageIndex:a}):s.provides?.registerAlways({scope:a!==void 0?{type:"page",pageIndex:a}:{type:"global"},handlers:i})}}}function In(){const t=Te(),e=V({isPageExclusive:!1});return N(()=>{if(!t.provides)return;const s=t.provides.getActiveInteractionMode();return e.isPageExclusive=s?.scope==="page"&&!!s.exclusive,t.provides.onModeChange(()=>{const i=t.provides?.getActiveInteractionMode();e.isPageExclusive=i?.scope==="page"&&!!i?.exclusive})}),e}const kn={pointerdown:"onPointerDown",pointerup:"onPointerUp",pointermove:"onPointerMove",pointerenter:"onPointerEnter",pointerleave:"onPointerLeave",pointercancel:"onPointerCancel",mousedown:"onMouseDown",mouseup:"onMouseUp",mousemove:"onMouseMove",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mousecancel:"onMouseCancel",click:"onClick",dblclick:"onDoubleClick",touchstart:"onPointerDown",touchend:"onPointerUp",touchmove:"onPointerMove",touchcancel:"onPointerCancel"},Tt=["pointerdown","pointerup","pointermove","pointerenter","pointerleave","pointercancel","mousedown","mouseup","mousemove","mouseenter","mouseleave","mousecancel","click","dblclick"],Mn=["touchstart","touchend","touchmove","touchcancel"],_n=typeof PointerEvent<"u",xt=_n?Tt:[...Tt,...Mn];function Nn(t,e){return t.startsWith("touch")?{passive:!e}:{passive:!1}}function Et(t){return typeof TouchEvent<"u"&&t instanceof TouchEvent}function Ln(t,e){if(!t)return!1;let s=t;for(;s;){if(e.classes?.length){for(const i of e.classes)if(s.classList?.contains(i))return!0}if(e.dataAttributes?.length){for(const i of e.dataAttributes)if(s.hasAttribute(i))return!0}s=s.parentElement}return!1}function ks(t,e,s,i){let r=t.getHandlersForScope(e);const n=()=>t.getActiveInteractionMode()?.wantsRawTouch!==!1,a={};let o=n();const l=p=>{xt.forEach(T=>{const E=a[T]??=b;s.addEventListener(T,E,Nn(T,p))})},u=()=>{xt.forEach(p=>{const T=a[p];T&&s.removeEventListener(p,T)})};l(o),s.style.touchAction=o?"none":"";const c=t.onModeChange(()=>{if(e.type==="global"){const T=t.getActiveInteractionMode();s.style.cursor=T?.scope==="global"?T.cursor??"auto":"auto"}r=t.getHandlersForScope(e);const p=n();p!==o&&(u(),l(p),o=p,s.style.touchAction=o?"none":"")}),h=t.onHandlerChange(()=>{r=t.getHandlersForScope(e)}),y=t.getActiveInteractionMode(),m=t.getCurrentCursor();s.style.cursor=e.type==="global"&&y?.scope!=="global"?"auto":m;const g=t.onCursorChange(p=>{e.type==="global"&&t.getActiveInteractionMode()?.scope!=="global"||(s.style.cursor=p)}),S=(p,T)=>{if(i)return i(p,T);const E=T.getBoundingClientRect();return{x:p.clientX-E.left,y:p.clientY-E.top}};function b(p){if(t.isPaused())return;const T=t.getExclusionRules();if(p.target&&Ln(p.target,T))return;const E=kn[p.type];if(!E||!r?.[E])return;Et(p)&&o&&(p.type==="touchmove"||p.type==="touchcancel")&&p.preventDefault();let _,I;if(Et(p)){const d=p.type==="touchend"||p.type==="touchcancel"?p.changedTouches[0]:p.touches[0];if(!d)return;_=S(d,s),I={clientX:d.clientX,clientY:d.clientY,ctrlKey:p.ctrlKey,shiftKey:p.shiftKey,altKey:p.altKey,metaKey:p.metaKey,target:p.target,currentTarget:p.currentTarget,setPointerCapture:()=>{},releasePointerCapture:()=>{}}}else{const d=p;_=S(d,s),I={clientX:d.clientX,clientY:d.clientY,ctrlKey:d.ctrlKey,shiftKey:d.shiftKey,altKey:d.altKey,metaKey:d.metaKey,target:d.target,currentTarget:d.currentTarget,setPointerCapture:()=>{d.target?.setPointerCapture?.(d.pointerId)},releasePointerCapture:()=>{d.target?.releasePointerCapture?.(d.pointerId)}}}r[E]?.(_,I,t.getActiveMode())}return()=>{u(),c(),g(),h()}}var On=P("<div><!></div>");function ro(t,e){K(e,!0);let s=be(e,["$$slots","$$events","$$legacy","children","class"]),i=X(null);const r=Te();N(()=>{if(!(!r.provides||!f(i)))return ks(r.provides,{type:"global"},f(i))});var n=On();Se(n,()=>({class:e.class,...s,[Oe]:{width:"100%",height:"100%"}}));var a=we(n);Y(a,()=>e.children),ee(n),Le(n,o=>G(i,o),()=>f(i)),k(t,n),j()}var Dn=P("<div></div>"),An=P("<div><!> <!></div>");function no(t,e){K(e,!0);let s=be(e,["$$slots","$$events","$$legacy","pageIndex","children","pageWidth","pageHeight","rotation","scale","convertEventToPoint","class"]),i=X(null);const r=Te(),n=In(),a=re(()=>(h,y)=>{const m=y.getBoundingClientRect(),g={x:h.clientX-m.left,y:h.clientY-m.top},S=zt({width:e.pageWidth,height:e.pageHeight},e.rotation,1);return Ri(S,g,e.rotation,e.scale)});N(()=>{if(!(!r.provides||!f(i)))return ks(r.provides,{type:"page",pageIndex:e.pageIndex},f(i),e.convertEventToPoint||f(a))});var o=An();Se(o,h=>({class:e.class,...s,[Oe]:h}),[()=>({position:"relative",width:`${e.pageWidth}px`,height:`${e.pageHeight}px`})]);var l=we(o);Y(l,()=>e.children);var u=ge(l,2);{var c=h=>{var y=Dn();Z(y,"",{},{position:"absolute",top:"0",left:"0",right:"0",bottom:"0","z-index":"10"}),k(h,y)};te(u,h=>{n&&h(c)})}ee(o),Le(o,h=>G(i,h),()=>f(i)),k(t,o),j()}const Ms="selection",zn={id:Ms,name:"Selection Plugin",version:"1.0.0",provides:["selection"],requires:["interaction-manager"],optional:[],defaultConfig:{enabled:!0}},_s="CACHE_PAGE_GEOMETRY",Ns="SET_SELECTION",Ls="START_SELECTION",Os="END_SELECTION",Ds="CLEAR_SELECTION",As="SET_RECTS",zs="SET_SLICES",Hs="RESET",Hn=(t,e)=>({type:_s,payload:{page:t,geo:e}}),$n=t=>({type:Ns,payload:t}),qn=()=>({type:Ls}),Un=()=>({type:Os}),Gn=()=>({type:Ds}),Pn=t=>({type:As,payload:t}),Wn=t=>({type:zs,payload:t}),Bn=()=>({type:Hs});function ke(t,e){return t.rects[e]??[]}function ye(t,e){return Ut(ke(t,e))}function Vn(t){const e=[],s=t.rects;for(const i in s){const r=Number(i),n=Ut(s[r]);n&&e.push({page:r,rect:n})}return e}function Xn(t,e){const s=t.rects[e]||[];if(s.length===0)return null;const i=ye(t,e);return i?{pageIndex:e,rect:i,segmentRects:s}:null}function Kn(t){const e=[],s=Object.keys(t.rects).map(Number);for(const i of s){const r=t.rects[i]||[];if(r.length===0)continue;const n=ye(t,i);n&&e.push({pageIndex:i,rect:n,segmentRects:r})}return e}function It(t,e){for(const s of t.runs){if(!(e.y>=s.rect.y&&e.y<=s.rect.y+s.rect.height&&e.x>=s.rect.x&&e.x<=s.rect.x+s.rect.width))continue;const r=s.glyphs.findIndex(n=>e.x>=n.x&&e.x<=n.x+n.width&&e.y>=n.y&&e.y<=n.y+n.height);if(r!==-1)return s.charStart+r}return-1}function jn(t,e,s){if(!t||!e||s<t.start.page||s>t.end.page)return null;const i=s===t.start.page?t.start.index:0,r=e.runs[e.runs.length-1],n=r.charStart+r.glyphs.length-1,a=s===t.end.page?t.end.index:n;return{from:i,to:a}}function Fn(t,e,s,i=!0){const r=[];for(const n of t.runs){const a=n.charStart,o=a+n.glyphs.length-1;if(o<e||a>s)continue;const l=Math.max(e,a)-a,u=Math.min(s,o)-a;let c=1/0,h=-1/0,y=1/0,m=-1/0,g=0;for(let S=l;S<=u;S++){const b=n.glyphs[S];b.flags!==2&&(c=Math.min(c,b.x),h=Math.max(h,b.x+b.width),y=Math.min(y,b.y),m=Math.max(m,b.y+b.height),g++)}c!==1/0&&g>0&&r.push({rect:{origin:{x:c,y},size:{width:h-c,height:m-y}},charCount:g})}return i?Zn(r):r.map(n=>n.rect)}function $s(t,e){const s=Math.min(t.origin.x,e.origin.x),i=Math.min(t.origin.y,e.origin.y),r=Math.max(t.origin.x+t.size.width,e.origin.x+e.size.width),n=Math.max(t.origin.y+t.size.height,e.origin.y+e.size.height);return{origin:{x:s,y:i},size:{width:r-s,height:n-i}}}function Yn(t,e){const s=Math.max(t.origin.x,e.origin.x),i=Math.max(t.origin.y,e.origin.y),r=Math.min(t.origin.x+t.size.width,e.origin.x+e.size.width),n=Math.min(t.origin.y+t.size.height,e.origin.y+e.size.height),a=Math.max(0,r-s),o=Math.max(0,n-i);return{origin:{x:s,y:i},size:{width:a,height:o}}}function Ze(t){return t.size.width<=0||t.size.height<=0}function Qn(t,e){if(Ze(t)||Ze(e))return 0;const s=$s(t,e);return s.size.height===t.size.height||s.size.height===e.size.height?1:Yn(t,e).size.height/s.size.height}function Jn(t,e){const i=t.rect,r=e.rect;if(Qn(i,r)<.8)return!1;const n=1,a=n*i.size.width/t.charCount,o=n*r.size.width/e.charCount,l=i.origin.x-a,u=i.origin.x+i.size.width+a,c=r.origin.x-o,h=r.origin.x+r.size.width+o;return l<h&&u>c}function Zn(t){const e=[];let s=null,i=null;for(const r of t)s&&i?Jn(s,r)?i=$s(i,r.rect):(e.push(i),i=r.rect):i=r.rect,s=r;return i&&!Ze(i)&&e.push(i),e}const qs=class extends le{constructor(e,s){super(e,s),this.enabledModes=new Set(["pointerMode"]),this.selecting=!1,this.pageCallbacks=new Map,this.selChange$=D(),this.textRetrieved$=D(),this.copyToClipboard$=J(),this.beginSelection$=J(),this.endSelection$=J(),this.interactionManagerCapability=this.registry.getPlugin("interaction-manager")?.provides(),this.coreStore.onAction(Ce,i=>{this.dispatch(Bn()),this.notifyAllPages()}),this.coreStore.onAction(Vt,i=>{const r=i.payload.map(n=>this.getNewPageGeometryAndCache(n));B.all(r).wait(()=>{i.payload.forEach(n=>{this.notifyPage(n)})},ae)})}async initialize(){}async destroy(){this.selChange$.clear()}buildCapability(){return{getFormattedSelection:()=>Kn(this.state),getFormattedSelectionForPage:e=>Xn(this.state,e),getHighlightRectsForPage:e=>ke(this.state,e),getHighlightRects:()=>this.state.rects,getBoundingRectForPage:e=>ye(this.state,e),getBoundingRects:()=>Vn(this.state),onCopyToClipboard:this.copyToClipboard$.on,onSelectionChange:this.selChange$.on,onTextRetrieved:this.textRetrieved$.on,onBeginSelection:this.beginSelection$.on,onEndSelection:this.endSelection$.on,clear:()=>this.clearSelection(),getSelectedText:()=>this.getSelectedText(),copyToClipboard:()=>this.copyToClipboard(),enableForMode:e=>this.enabledModes.add(e),isEnabledForMode:e=>this.enabledModes.has(e),getState:()=>this.state}}registerSelectionOnPage(e){if(!this.interactionManagerCapability)return this.logger.warn("SelectionPlugin","MissingDependency","Interaction manager plugin not loaded, text selection disabled"),()=>{};const{pageIndex:s,onRectsChange:i}=e;this.pageCallbacks.set(s,i);const r=this.getOrLoadGeometry(s);i({rects:ke(this.state,s),boundingRect:ye(this.state,s)});const n={onPointerDown:(o,l,u)=>{if(!this.enabledModes.has(u))return;this.clearSelection();const c=this.state.geometry[s];if(c){const h=It(c,o);h!==-1&&this.beginSelection(s,h)}},onPointerMove:(o,l,u)=>{if(!this.enabledModes.has(u))return;const c=this.state.geometry[s];if(c){const h=It(c,o);h!==-1?this.interactionManagerCapability?.setCursor("selection-text","text",10):this.interactionManagerCapability?.removeCursor("selection-text"),this.selecting&&h!==-1&&this.updateSelection(s,h)}},onPointerUp:(o,l,u)=>{this.enabledModes.has(u)&&this.endSelection()},onHandlerActiveEnd:o=>{this.enabledModes.has(o)&&this.clearSelection()}},a=this.interactionManagerCapability.registerAlways({scope:{type:"page",pageIndex:s},handlers:n});return()=>{a(),this.pageCallbacks.delete(s),r.abort({code:oe.Cancelled,message:"Cleanup"})}}notifyPage(e){const s=this.pageCallbacks.get(e);if(s){const i=this.interactionManagerCapability?.getActiveMode();s(i==="pointerMode"?{rects:ke(this.state,e),boundingRect:ye(this.state,e)}:{rects:[],boundingRect:null})}}notifyAllPages(){this.pageCallbacks.forEach((e,s)=>{this.notifyPage(s)})}getNewPageGeometryAndCache(e){if(!this.coreState.core.document)return Ee.reject({code:oe.NotFound,message:"Doc Not Found"});const s=this.coreState.core.document.pages.find(r=>r.index===e),i=this.engine.getPageGeometry(this.coreState.core.document,s);return i.wait(r=>{this.dispatch(Hn(e,r))},ae),i}getOrLoadGeometry(e){const s=this.state.geometry[e];return s?Ee.resolve(s):this.getNewPageGeometryAndCache(e)}beginSelection(e,s){this.selecting=!0,this.anchor={page:e,index:s},this.dispatch(qn()),this.beginSelection$.emit({page:e,index:s})}endSelection(){this.selecting=!1,this.anchor=void 0,this.dispatch(Un()),this.endSelection$.emit()}clearSelection(){this.selecting=!1,this.anchor=void 0,this.dispatch(Gn()),this.selChange$.emit(null),this.notifyAllPages()}updateSelection(e,s){if(!this.selecting||!this.anchor)return;const i=this.anchor,r=e>i.page||e===i.page&&s>=i.index,o={start:r?i:{page:e,index:s},end:r?{page:e,index:s}:i};this.dispatch($n(o)),this.updateRectsAndSlices(o),this.selChange$.emit(o);for(let l=o.start.page;l<=o.end.page;l++)this.notifyPage(l)}updateRectsAndSlices(e){const s={},i={};for(let r=e.start.page;r<=e.end.page;r++){const n=this.state.geometry[r],a=jn(e,n,r);a&&(s[r]=Fn(n,a.from,a.to),i[r]={start:a.from,count:a.to-a.from+1})}this.dispatch(Pn(s)),this.dispatch(Wn(i))}getSelectedText(){if(!this.coreState.core.document||!this.state.selection)return Ee.reject({code:oe.NotFound,message:"Doc Not Found or No Selection"});const e=this.state.selection,s=[];for(let r=e.start.page;r<=e.end.page;r++){const n=this.state.slices[r];n&&s.push({pageIndex:r,charIndex:n.start,charCount:n.count})}if(s.length===0)return Ee.resolve([]);const i=this.engine.getTextSlices(this.coreState.core.document,s);return i.wait(r=>{this.textRetrieved$.emit(r)},ae),i}copyToClipboard(){this.getSelectedText().wait(s=>{this.copyToClipboard$.emit(s.join(`
`))},ae)}};qs.id="selection";let ut=qs;const et={geometry:{},rects:{},slices:{},selection:null,active:!1,selecting:!1},ea=(t=et,e)=>{switch(e.type){case _s:{const{page:s,geo:i}=e.payload;return{...t,geometry:{...t.geometry,[s]:i}}}case Ns:return{...t,selection:e.payload,active:!0};case Ls:return{...t,selecting:!0,selection:null,rects:{}};case Os:return{...t,selecting:!1};case Ds:return{...t,selecting:!1,selection:null,rects:{},active:!1};case As:return{...t,rects:e.payload};case zs:return{...t,slices:e.payload};case Hs:return et;default:return t}},ta={manifest:zn,create:t=>new ut(Ms,t),reducer:ea,initialState:et},sa=()=>ce(ut.id),ia=()=>Re(ut.id);var ra=P("<div></div>"),na=P("<div></div>");function oo(t,e){K(e,!0);let s=Ot(e,"background",3,"rgba(33, 150, 243, 0.4)");const i=ia();let r=X(V([])),n=X(null);N(()=>{const u=e.pageIndex;if(i.plugin)return i.plugin.registerSelectionOnPage({pageIndex:u,onRectsChange:({rects:c,boundingRect:h})=>{G(r,c,!0),G(n,h,!0)}})});var a=z(),o=A(a);{var l=u=>{var c=na();let h;pe(c,21,()=>f(r),Dt,(y,m)=>{var g=ra();let S;de(b=>S=Z(g,"",S,b),[()=>({position:"absolute",left:`${(f(m).origin.x-f(n).origin.x)*e.scale}px`,top:`${(f(m).origin.y-f(n).origin.y)*e.scale}px`,width:`${f(m).size.width*e.scale}px`,height:`${f(m).size.height*e.scale}px`,background:s(),"pointer-events":"none"})]),k(y,g)}),ee(c),de(y=>h=Z(c,"",h,y),[()=>({position:"absolute",left:`${f(n).origin.x*e.scale}px`,top:`${f(n).origin.y*e.scale}px`,width:`${f(n).size.width*e.scale}px`,height:`${f(n).size.height*e.scale}px`,"mix-blend-mode":"multiply",isolation:"isolate","pointer-events":"none"})]),k(u,c)};te(o,u=>{f(n)&&u(l)})}k(t,a),j()}function aa(t,e){K(e,!0);const s=sa();N(()=>{if(s.provides)return s.provides.onCopyToClipboard(i=>{navigator.clipboard.writeText(i).catch(r=>{console.error("Failed to copy text to clipboard:",r)})})}),j()}const lo=Kt(ta).addUtility(aa).build();export{Re as $,Vi as A,ga as B,Ti as C,va as D,qi as E,Wi as F,Ea as G,L as H,Gi as I,fe as J,le as K,D as L,Zi as M,st as N,Ua as O,Ee as P,ma as Q,tt as R,Ce as S,B as T,fa as U,ya as V,Da as W,ce as X,sa as Y,io as Z,pe as _,oe as a,ha as a0,Dt as a1,Na as a2,Ma as a3,_a as a4,J as a5,Xa as a6,Za as a7,no as a8,Fa as a9,jr as aA,Ja as aB,hn as aC,ro as aD,oo as aa,Aa as ab,Ga as ac,qa as ad,Wa as ae,Va as af,Qa as ag,ja as ah,to as ai,lo as aj,Ae as ak,ze as al,za as am,Ie as an,$t as ao,Vt as ap,zt as aq,wa as ar,kr as as,$a as at,Ha as au,Kt as av,xs as aw,ot as ax,so as ay,Hr as az,La as b,Bi as c,er as d,ba as e,Xi as f,Yi as g,Fi as h,ae as i,Ki as j,Pi as k,Ui as l,Ra as m,xa as n,ka as o,Ia as p,da as q,pa as r,mt as s,O as t,Oa as u,Qi as v,Ta as w,Sa as x,Ca as y,ji as z};
