import"../chunks/NZTpNUN0.js";import{i as In}from"../chunks/DlEPbKaS.js";import{G as J,u as be,q as t,aB as oe,y as R,A as z,B as ht,aC as b,C as A,H as $,ax as te,aX as Ae,D as G,I as B,K as se,J as W,aP as ft,F as he,aY as Nt,E as j,aZ as fe,a_ as _n,o as Tn,a$ as zn,b0 as En}from"../chunks/i0-F6fyi.js";import{r as vt,i as M,s as F,b as Dt,p as L,c as Ht}from"../chunks/CJHWDyO9.js";import{c as P,j as ce,H as Ye,g as le,I as ut,J as Yt,t as Gt,K as Xt,L as Tt,S as Rn,u as ge,i as lt,P as Ge,a as Xe,T as zt,O as Z,Q as Ue,U as je,f as Dn,V as Mn,X as On,Y as Qt,Z as Ln,_ as pe,$ as Nn,a0 as Hn,a1 as dt,a2 as Qe,a3 as Un,a4 as jn,a5 as Fn,a6 as Wn,a7 as Vn,a8 as Bn,a9 as Yn,aa as Gn,ab as Xn,ac as Qn,ad as Ne,ae as qn,af as Kn,ag as Zn,ah as Jn,ai as $n,aj as ei}from"../chunks/2PxcrNm-.js";import{s as qt}from"../chunks/DvitKH49.js";import{a as Pe,b as O,S as He,s as _,c as ti}from"../chunks/8PSIAql6.js";const Kt="annotation",ni={id:Kt,name:"Annotation Plugin",version:"1.0.0",provides:["annotation"],requires:["interaction-manager","selection"],optional:["history"],defaultConfig:{enabled:!0,autoCommit:!0,annotationAuthor:"Guest",deactivateToolAfterCreate:!1,selectAfterCreate:!0}},Zt="ANNOTATION/SET_ANNOTATIONS",Jt="ANNOTATION/SELECT_ANNOTATION",$t="ANNOTATION/DESELECT_ANNOTATION",en="ANNOTATION/ADD_COLOR_PRESET",tn="ANNOTATION/CREATE_ANNOTATION",nn="ANNOTATION/PATCH_ANNOTATION",on="ANNOTATION/DELETE_ANNOTATION",sn="ANNOTATION/COMMIT",rn="ANNOTATION/PURGE_ANNOTATION",an="ANNOTATION/SET_ACTIVE_TOOL_ID",cn="ANNOTATION/SET_TOOL_DEFAULTS",ln="ANNOTATION/ADD_TOOL",ii=o=>({type:Zt,payload:o}),oi=(o,e)=>({type:Jt,payload:{pageIndex:o,id:e}}),Et=()=>({type:$t}),si=o=>({type:en,payload:o}),Rt=(o,e)=>({type:tn,payload:{pageIndex:o,annotation:e}}),Ut=(o,e,n)=>({type:nn,payload:{pageIndex:o,id:e,patch:n}}),jt=(o,e)=>({type:on,payload:{pageIndex:o,id:e}}),ri=()=>({type:sn}),Ft=o=>({type:rn,payload:{uid:o}}),ai=o=>({type:an,payload:o}),ci=(o,e)=>({type:cn,payload:{toolId:o,patch:e}}),li=o=>({type:ln,payload:o});function di(o){return o.object.type===P.INK}function hi(o){return o.object.type===P.CIRCLE}function ui(o){return o.object.type===P.POLYGON}function gi(o){return o.object.type===P.SQUARE}function fi(o){return o.object.type===P.LINE}function vi(o){return o.object.type===P.POLYLINE}function mi(o){return o.object.type===P.HIGHLIGHT}function yi(o){return o.object.type===P.UNDERLINE}function xi(o){return o.object.type===P.STRIKEOUT}function bi(o){return o.object.type===P.SQUIGGLY}function ki(o){return o.object.type===P.FREETEXT}function pi(o){return o.object.type===P.STAMP}const wi=(o,e)=>(o.pages[e]??[]).map(n=>o.byUid[n]),Pi=o=>o.selectedUid?o.byUid[o.selectedUid]:null,Ai=(o,e)=>o.selectedUid&&(o.pages[e]??[]).includes(o.selectedUid)?o.byUid[o.selectedUid]:null;function xe(o){let e=o;return[()=>e,s=>{e=s}]}const Si={annotationType:P.INK,create(o){const{onCommit:e,onPreview:n,getTool:i,pageSize:s}=o,[r,a]=xe([]),[v,d]=xe(!1),h={current:null},m=c=>({x:Z(c.x,0,s.width),y:Z(c.y,0,s.height)}),u=()=>{const c=i();return c?{...c.defaults,strokeWidth:c.defaults.strokeWidth??1,color:c.defaults.color??"#000000",opacity:c.defaults.opacity??1,flags:c.defaults.flags??["print"]}:null},l=()=>{const c=r();if(c.length===0||c[0].points.length===0)return null;const y=u();if(!y)return null;const g=c.flatMap(f=>f.points),x=Ue(je(g),y.strokeWidth/2);return{type:P.INK,bounds:x,data:{...y,rect:x,inkList:c}}};return{onPointerDown:(c,y)=>{const g=m(c);d(!0),h.current&&clearTimeout(h.current);const x=[...r(),{points:[g]}];a(x),n(l()),y.setPointerCapture?.()},onPointerMove:c=>{if(!v())return;const y=r();if(y.length===0)return;const g=m(c);y[y.length-1].points.push(g),a(y),n(l())},onPointerUp:(c,y)=>{d(!1),y.releasePointerCapture?.(),h.current&&clearTimeout(h.current),h.current=setTimeout(()=>{const g=r();if(g.length>0&&g[0].points.length>1){const x=u();if(!x)return;const f=g.flatMap(w=>w.points),k=Ue(je(f),x.strokeWidth/2);e({...x,inkList:g,rect:k,type:P.INK,pageIndex:o.pageIndex,id:ge(),created:new Date})}a([]),n(null)},800)},onPointerCancel:(c,y)=>{a([]),d(!1),n(null),h.current&&clearTimeout(h.current),y.releasePointerCapture?.()}}}};function mt({threshold:o=5,getTool:e,onClickDetected:n}){const[i,s]=xe(null),[r,a]=xe(!1);return{onStart:v=>{s(v),a(!1)},onMove:v=>{const d=i();if(!d||r())return;Math.sqrt(Math.pow(v.x-d.x,2)+Math.pow(v.y-d.y,2))>o&&a(!0)},onEnd:v=>{if(i()&&!r()){const h=e();h&&"clickBehavior"in h&&h.clickBehavior?.enabled&&n(v,h)}s(null),a(!1)},hasMoved:r,reset:()=>{s(null),a(!1)}}}const Ci={annotationType:P.FREETEXT,create(o){const{onCommit:e,onPreview:n,getTool:i,pageSize:s,pageIndex:r}=o,[a,v]=xe(null),d=l=>({x:Z(l.x,0,s.width),y:Z(l.y,0,s.height)}),h=()=>{const l=i();return l?{...l.defaults,fontColor:l.defaults.fontColor??"#000000",opacity:l.defaults.opacity??1,fontSize:l.defaults.fontSize??12,fontFamily:l.defaults.fontFamily??Gt.Helvetica,backgroundColor:l.defaults.backgroundColor??"transparent",textAlign:l.defaults.textAlign??Yt.Left,verticalAlign:l.defaults.verticalAlign??ut.Top,contents:l.defaults.contents??"Insert text here",flags:l.defaults.flags??["print"]}:null},m=mt({threshold:5,getTool:i,onClickDetected:(l,c)=>{const y=h();if(!y)return;const g=c.clickBehavior;if(!g?.enabled)return;const{width:x,height:f}=g.defaultSize,k=x/2,w=f/2,p=Z(l.x-k,0,s.width-x),C=Z(l.y-w,0,s.height-f),S={origin:{x:p,y:C},size:{width:x,height:f}},I=g.defaultContent??y.contents,E={...y,contents:I,type:P.FREETEXT,rect:S,pageIndex:r,id:ge(),created:new Date};e(E)}}),u=l=>{const c=a();if(!c)return null;const y=h();if(!y)return null;const g=Math.min(c.x,l.x),x=Math.min(c.y,l.y),f=Math.abs(c.x-l.x),k=Math.abs(c.y-l.y),w={origin:{x:g,y:x},size:{width:f,height:k}};return{type:P.FREETEXT,bounds:w,data:{...y,rect:w}}};return{onPointerDown:(l,c)=>{const y=d(l);v(y),m.onStart(y),n(u(y)),c.setPointerCapture?.()},onPointerMove:l=>{const c=d(l);m.onMove(c),a()&&m.hasMoved()&&n(u(c))},onPointerUp:(l,c)=>{const y=a();if(!y)return;const g=h();if(!g)return;const x=d(l);if(!m.hasMoved())m.onEnd(x);else{const f=Math.min(y.x,x.x),k=Math.min(y.y,x.y),w=Math.abs(y.x-x.x),p=Math.abs(y.y-x.y),C={origin:{x:f,y:k},size:{width:w,height:p}},S={...g,type:P.FREETEXT,rect:C,pageIndex:o.pageIndex,id:ge(),created:new Date};e(S)}v(null),n(null),m.reset(),c.releasePointerCapture?.()},onPointerLeave:(l,c)=>{v(null),n(null),m.reset(),c.releasePointerCapture?.()},onPointerCancel:(l,c)=>{v(null),n(null),m.reset(),c.releasePointerCapture?.()}}}};function dn(o){const e=n=>{const i=n*9,s=Math.PI/6;return{x:-i*Math.cos(s),y:i*Math.sin(s)}};return{getSvgPath:n=>{const{x:i,y:s}=e(n);return o?`M 0 0 L ${i} ${s} L ${i} ${-s} Z`:`M ${i} ${s} L 0 0 L ${i} ${-s}`},getLocalPoints:n=>{const{x:i,y:s}=e(n);return[{x:0,y:0},{x:i,y:s},{x:i,y:-s}]},getRotation:n=>n,filled:o}}function Wt(o,e){const n=i=>i*o/2;return{getSvgPath:i=>{const s=n(i);return`M ${-s} 0 L ${s} 0`},getLocalPoints:i=>{const s=n(i);return[{x:-s,y:0},{x:s,y:0}]},getRotation:e,filled:!1}}const Vt=dn(!1),Bt=dn(!0),Mt={[ce.OpenArrow]:Vt,[ce.ClosedArrow]:Bt,[ce.ROpenArrow]:{...Vt,getRotation:o=>o+Math.PI},[ce.RClosedArrow]:{...Bt,getRotation:o=>o+Math.PI},[ce.Circle]:{getSvgPath:o=>{const e=o*5/2;return`M ${e} 0 A ${e} ${e} 0 1 1 ${-e} 0 A ${e} ${e} 0 1 1 ${e} 0`},getLocalPoints:o=>{const e=o*5/2;return[{x:-e,y:-e},{x:e,y:e}]},getRotation:()=>0,filled:!0},[ce.Square]:{getSvgPath:o=>{const e=o*6/2;return`M ${-e} ${-e} L ${e} ${-e} L ${e} ${e} L ${-e} ${e} Z`},getLocalPoints:o=>{const e=o*6/2;return[{x:-e,y:-e},{x:e,y:-e},{x:e,y:e},{x:-e,y:e}]},getRotation:o=>o,filled:!0},[ce.Diamond]:{getSvgPath:o=>{const e=o*6/2;return`M 0 ${-e} L ${e} 0 L 0 ${e} L ${-e} 0 Z`},getLocalPoints:o=>{const e=o*6/2;return[{x:0,y:-e},{x:e,y:0},{x:0,y:e},{x:-e,y:0}]},getRotation:o=>o,filled:!0},[ce.Butt]:Wt(6,o=>o+Math.PI/2),[ce.Slash]:Wt(18,o=>o+Math.PI/1.5)},Ii=1.2;function ke(o,e,n){if(!o||o.length===0)return{origin:{x:0,y:0},size:{width:0,height:0}};const i=[...o],s=(d,h)=>Math.atan2(h.y-d.y,h.x-d.x),r=(d,h,m)=>{if(!d)return;const u=Mt[d];if(!u)return;const l=u.getLocalPoints(e),c=u.getRotation(m),y=l.map(g=>Mn(g,c,h));i.push(...y)};if(o.length>=2){const d=s(o[1],o[0]);r(n?.start,o[0],d);const h=o.length-1,m=s(o[h-1],o[h]);r(n?.end,o[h],m)}if(i.length<=1){const d=o[0]||{x:0,y:0},h=e;return{origin:{x:d.x-h,y:d.y-h},size:{width:h*2,height:h*2}}}const a=je(i),v=e/2+Ii*e;return Ue(a,v)}function _i(o,e,n,i,s){if(!o)return null;const r=Mt[o];if(!r)return null;const a=d=>d*180/Math.PI,v=r.getRotation(n);return{d:r.getSvgPath(e),transform:`translate(${i} ${s}) rotate(${a(v)})`,filled:r.filled}}class Ot{constructor(){this.patches=new Map}register(e,n){this.patches.set(e,n)}transform(e,n){const i=this.patches.get(e.type);return i?i(e,n):n.changes}}const Ti=new Ot,gt=Object.freeze(Object.defineProperty({__proto__:null,LINE_ENDING_HANDLERS:Mt,PatchRegistry:Ot,createEnding:_i,lineRectWithEndings:ke,patchRegistry:Ti},Symbol.toStringTag,{value:"Module"})),zi={annotationType:P.LINE,create(o){const{pageIndex:e,onCommit:n,onPreview:i,getTool:s,pageSize:r}=o,[a,v]=xe(null),d=l=>({x:Z(l.x,0,r.width),y:Z(l.y,0,r.height)}),h=()=>{const l=s();return l?{...l.defaults,strokeWidth:l.defaults.strokeWidth??1,lineEndings:l.defaults.lineEndings??{start:ce.None,end:ce.None},color:l.defaults.color??"#000000",opacity:l.defaults.opacity??1,strokeStyle:l.defaults.strokeStyle??le.SOLID,strokeDashArray:l.defaults.strokeDashArray??[],strokeColor:l.defaults.strokeColor??"#000000",flags:l.defaults.flags??["print"]}:null},m=mt({threshold:5,getTool:s,onClickDetected:(l,c)=>{const y=h();if(!y)return;const g=c.clickBehavior;if(!g?.enabled)return;const x=g.defaultAngle??0,k=g.defaultLength/2,w=l.x-k*Math.cos(x),p=l.y-k*Math.sin(x),C=l.x+k*Math.cos(x),S=l.y+k*Math.sin(x),I=d({x:w,y:p}),E=d({x:C,y:S}),D=ke([I,E],y.strokeWidth,y.lineEndings);n({...y,rect:D,linePoints:{start:I,end:E},pageIndex:e,id:ge(),created:new Date,type:P.LINE})}}),u=l=>{const c=a();if(!c)return null;const y=h();if(!y)return null;const g=ke([c,l],y.strokeWidth,y.lineEndings);return{type:P.LINE,bounds:g,data:{...y,rect:g,linePoints:{start:c,end:l}}}};return{onPointerDown:(l,c)=>{const y=d(l);v(y),m.onStart(y),i(u(y)),c.setPointerCapture?.()},onPointerMove:l=>{const c=d(l);m.onMove(c),a()&&m.hasMoved()&&i(u(c))},onPointerUp:(l,c)=>{const y=a();if(!y)return;const g=d(l);if(!m.hasMoved())m.onEnd(g);else{const x=h();if(!x)return;if(Math.abs(g.x-y.x)>2||Math.abs(g.y-y.y)>2){const f=ke([y,g],x.strokeWidth,x.lineEndings);n({...x,rect:f,linePoints:{start:y,end:g},pageIndex:e,id:ge(),flags:["print"],created:new Date,type:P.LINE})}}v(null),i(null),m.reset(),c.releasePointerCapture?.()},onPointerLeave:(l,c)=>{v(null),i(null),m.reset(),c.releasePointerCapture?.()},onPointerCancel:(l,c)=>{v(null),i(null),m.reset(),c.releasePointerCapture?.()}}}},Ei={annotationType:P.POLYLINE,create(o){const{onCommit:e,onPreview:n,getTool:i,pageSize:s}=o,[r,a]=xe([]),[v,d]=xe(null),h=c=>({x:Z(c.x,0,s.width),y:Z(c.y,0,s.height)}),m=()=>{const c=i();return c?{...c.defaults,strokeWidth:c.defaults.strokeWidth??1,lineEndings:c.defaults.lineEndings??{start:ce.None,end:ce.None},color:c.defaults.color??"#000000",opacity:c.defaults.opacity??1,strokeColor:c.defaults.strokeColor??"#000000",strokeStyle:c.defaults.strokeStyle??le.SOLID,strokeDashArray:c.defaults.strokeDashArray??[],flags:c.defaults.flags??["print"]}:null},u=()=>{const c=r();if(c.length<2)return;const y=m();if(!y)return;const g=ke(c,y.strokeWidth,y.lineEndings),x={...y,vertices:c,rect:g,type:P.POLYLINE,pageIndex:o.pageIndex,id:ge(),created:new Date};e(x),a([]),d(null),n(null)},l=()=>{const c=r(),y=v();if(c.length===0||!y)return null;const g=m();if(!g)return null;const x=[...c,y],f=ke(x,g.strokeWidth,g.lineEndings);return{type:P.POLYLINE,bounds:f,data:{...g,rect:f,vertices:x,currentVertex:y}}};return{onClick:c=>{const y=h(c),g=r(),x=g[g.length-1];x&&Math.abs(x.x-y.x)<1&&Math.abs(x.y-y.y)<1||(a([...g,y]),d(y),n(l()))},onDoubleClick:()=>{u()},onPointerMove:c=>{if(r().length>0){const y=h(c);d(y),n(l())}},onPointerCancel:()=>{a([]),d(null),n(null)}}}},Ri=14,Di={annotationType:P.POLYGON,create(o){const{onCommit:e,onPreview:n,getTool:i,scale:s,pageSize:r}=o,[a,v]=xe([]),[d,h]=xe(null),m=g=>({x:Z(g.x,0,r.width),y:Z(g.y,0,r.height)}),u=g=>{const x=a();if(x.length<2)return!1;const k=Ri/s/2,w=x[0];return g.x>=w.x-k&&g.x<=w.x+k&&g.y>=w.y-k&&g.y<=w.y+k},l=()=>{const g=i();return g?{...g.defaults,color:g.defaults.color??"#000000",opacity:g.defaults.opacity??1,strokeWidth:g.defaults.strokeWidth??1,strokeColor:g.defaults.strokeColor??"#000000",strokeStyle:g.defaults.strokeStyle??le.SOLID,strokeDashArray:g.defaults.strokeDashArray??[],flags:g.defaults.flags??["print"]}:null},c=()=>{const g=a();if(g.length<3)return;const x=l();if(!x)return;const f=Ue(je(g),x.strokeWidth/2),k={...x,vertices:g,rect:f,type:P.POLYGON,pageIndex:o.pageIndex,id:ge(),created:new Date};e(k),v([]),h(null),n(null)},y=()=>{const g=a(),x=d();if(g.length===0||!x)return null;const f=l();if(!f)return null;const k=[...g,x],w=Ue(je(k),f.strokeWidth/2);return{type:P.POLYGON,bounds:w,data:{...f,rect:w,vertices:g,currentVertex:x}}};return{onClick:g=>{const x=m(g);if(u(x)&&a().length>=3){c();return}const f=a(),k=f[f.length-1];k&&Math.abs(k.x-x.x)<1&&Math.abs(k.y-x.y)<1||(v([...f,x]),h(x),n(y()))},onDoubleClick:g=>{c()},onPointerMove:g=>{if(a().length>0){const x=m(g);h(x),n(y())}},onPointerCancel:g=>{v([]),h(null),n(null)}}}},Mi={annotationType:P.SQUARE,create(o){const{pageIndex:e,onCommit:n,onPreview:i,getTool:s,pageSize:r}=o,[a,v]=xe(null),d=l=>({x:Z(l.x,0,r.width),y:Z(l.y,0,r.height)}),h=()=>{const l=s();return l?{...l.defaults,flags:l.defaults.flags??["print"],strokeWidth:l.defaults.strokeWidth??2,strokeColor:l.defaults.strokeColor??"#000000",strokeStyle:l.defaults.strokeStyle??le.SOLID,strokeDashArray:l.defaults.strokeDashArray??[],color:l.defaults.color??"#000000",opacity:l.defaults.opacity??1}:null},m=mt({threshold:5,getTool:s,onClickDetected:(l,c)=>{const y=h();if(!y)return;const g=c.clickBehavior;if(!g?.enabled)return;const{width:x,height:f}=g.defaultSize,k=x/2,w=f/2,p=Z(l.x-k,0,r.width-x),C=Z(l.y-w,0,r.height-f),S=y.strokeWidth,I=S/2,E={origin:{x:p-I,y:C-I},size:{width:x+S,height:f+S}},D={...y,type:P.SQUARE,created:new Date,id:ge(),pageIndex:e,rect:E};n(D)}}),u=l=>{const c=a();if(!c)return null;const y=Math.min(c.x,l.x),g=Math.min(c.y,l.y),x=Math.abs(c.x-l.x),f=Math.abs(c.y-l.y),k=h();if(!k)return null;const w=k.strokeWidth,p=w/2,C={origin:{x:y-p,y:g-p},size:{width:x+w,height:f+w}};return{type:P.SQUARE,bounds:C,data:{rect:C,...k}}};return{onPointerDown:(l,c)=>{const y=d(l);v(y),m.onStart(y),i(u(y)),c.setPointerCapture?.()},onPointerMove:l=>{const c=d(l);m.onMove(c),a()&&m.hasMoved()&&i(u(c))},onPointerUp:(l,c)=>{if(!a()||!h())return;const x=d(l);if(!m.hasMoved())m.onEnd(x);else{const f=h();if(!f)return;const k=u(x);if(k){const w={...f,type:P.SQUARE,created:new Date,id:ge(),pageIndex:e,rect:k.data.rect};n(w)}}v(null),i(null),m.reset(),c.releasePointerCapture?.()},onPointerLeave:(l,c)=>{v(null),i(null),m.reset(),c.releasePointerCapture?.()},onPointerCancel:(l,c)=>{v(null),i(null),m.reset(),c.releasePointerCapture?.()}}}},Oi={annotationType:P.STAMP,create(o){const{services:e,onCommit:n,getTool:i,pageSize:s}=o;return{onPointerDown:r=>{const a=i();if(!a)return;const{imageSrc:v,imageSize:d}=a.defaults,h=(m,u,l)=>{const c=r.x-u/2,y=r.y-l/2,g=Z(c,0,s.width-u),x=Z(y,0,s.height-l),f={origin:{x:g,y:x},size:{width:u,height:l}},k={...a.defaults,rect:f,type:P.STAMP,icon:a.defaults.icon??Dn.Draft,subject:a.defaults.subject??"Stamp",flags:a.defaults.flags??["print"],pageIndex:o.pageIndex,id:ge(),created:new Date};n(k,{imageData:m})};v?e.processImage({source:v,maxWidth:s.width,maxHeight:s.height,onComplete:m=>h(m.imageData,d?.width??m.width,d?.height??m.height)}):e.requestFile({accept:"image/png,image/jpeg",onFile:m=>{e.processImage({source:m,maxWidth:s.width,maxHeight:s.height,onComplete:u=>h(u.imageData,u.width,u.height)})}})}}}},Li={annotationType:P.CIRCLE,create(o){const{pageIndex:e,onCommit:n,onPreview:i,getTool:s,pageSize:r}=o,[a,v]=xe(null),d=l=>({x:Z(l.x,0,r.width),y:Z(l.y,0,r.height)}),h=()=>{const l=s();return l?{...l.defaults,strokeWidth:l.defaults.strokeWidth??2,strokeColor:l.defaults.strokeColor??"#000000",strokeStyle:l.defaults.strokeStyle??le.SOLID,strokeDashArray:l.defaults.strokeDashArray??[],color:l.defaults.color??"#000000",opacity:l.defaults.opacity??1,flags:l.defaults.flags??["print"]}:null},m=mt({threshold:5,getTool:s,onClickDetected:(l,c)=>{const y=h();if(!y)return;const g=c.clickBehavior;if(!g?.enabled)return;const{width:x,height:f}=g.defaultSize,k=x/2,w=f/2,p=Z(l.x-k,0,r.width-x),C=Z(l.y-w,0,r.height-f),S=y.strokeWidth,I=S/2,E={origin:{x:p-I,y:C-I},size:{width:x+S,height:f+S}},D={...y,type:P.CIRCLE,created:new Date,id:ge(),pageIndex:e,rect:E};n(D)}}),u=l=>{const c=a();if(!c)return null;const y=Math.min(c.x,l.x),g=Math.min(c.y,l.y),x=Math.abs(c.x-l.x),f=Math.abs(c.y-l.y),k=h();if(!k)return null;const w=k.strokeWidth,p=w/2,C={origin:{x:y-p,y:g-p},size:{width:x+w,height:f+w}};return{type:P.CIRCLE,bounds:C,data:{rect:C,...k}}};return{onPointerDown:(l,c)=>{const y=d(l);v(y),m.onStart(y),i(u(y)),c.setPointerCapture?.()},onPointerMove:l=>{const c=d(l);m.onMove(c),a()&&m.hasMoved()&&i(u(c))},onPointerUp:(l,c)=>{if(!a()||!h())return;const x=d(l);if(!m.hasMoved())m.onEnd(x);else{const f=h();if(!f)return;const k=u(x);if(k){const w={...f,type:P.CIRCLE,flags:["print"],created:new Date,id:ge(),pageIndex:e,rect:k.data.rect};n(w)}}v(null),i(null),m.reset(),c.releasePointerCapture?.()},onPointerLeave:(l,c)=>{v(null),i(null),m.reset(),c.releasePointerCapture?.()},onPointerCancel:(l,c)=>{v(null),i(null),m.reset(),c.releasePointerCapture?.()}}}},Ni=(o,e)=>{switch(e.type){case"vertex-edit":return e.changes;case"move":if(e.changes.rect){const n=e.changes.rect.origin.x-o.rect.origin.x,i=e.changes.rect.origin.y-o.rect.origin.y,s=o.inkList.map(r=>({points:r.points.map(a=>({x:a.x+n,y:a.y+i}))}));return{rect:e.changes.rect,inkList:s}}return e.changes;case"resize":if(e.changes.rect){const n=o.rect,i=e.changes.rect;let s=i.size.width/n.size.width,r=i.size.height/n.size.height;const a=10;if((i.size.width<a||i.size.height<a)&&(s=Math.max(s,a/n.size.width),r=Math.max(r,a/n.size.height),e.changes.rect={origin:i.origin,size:{width:n.size.width*s,height:n.size.height*r}}),e.metadata?.maintainAspectRatio){const g=Math.min(s,r);s=g,r=g,e.changes.rect.size={width:n.size.width*g,height:n.size.height*g}}const v=(g,x)=>({origin:{x:g.origin.x+x,y:g.origin.y+x},size:{width:Math.max(1,g.size.width-x*2),height:Math.max(1,g.size.height-x*2)}}),d=Math.min(e.changes.rect.size.width/n.size.width,e.changes.rect.size.height/n.size.height),h=Math.max(1,Math.round(o.strokeWidth*d)),m=v(n,o.strokeWidth/2),u=v(e.changes.rect,h/2),l=u.size.width/Math.max(m.size.width,1e-6),c=u.size.height/Math.max(m.size.height,1e-6),y=o.inkList.map(g=>({points:g.points.map(x=>({x:u.origin.x+(x.x-m.origin.x)*l,y:u.origin.y+(x.y-m.origin.y)*c}))}));return{rect:e.changes.rect,inkList:y,strokeWidth:h}}return e.changes;case"property-update":if(e.changes.strokeWidth!==void 0){const n={...o,...e.changes},i=n.inkList.flatMap(r=>r.points),s=Ue(je(i),n.strokeWidth/2);return{...e.changes,rect:s}}return e.changes;default:return e.changes}},Hi=(o,e)=>{switch(e.type){case"vertex-edit":if(e.changes.linePoints){const{start:n,end:i}=e.changes.linePoints;return{rect:ke([n,i],o.strokeWidth,o.lineEndings),linePoints:{start:n,end:i}}}return e.changes;case"move":if(e.changes.rect){const n=e.changes.rect.origin.x-o.rect.origin.x,i=e.changes.rect.origin.y-o.rect.origin.y;return{rect:e.changes.rect,linePoints:{start:{x:o.linePoints.start.x+n,y:o.linePoints.start.y+i},end:{x:o.linePoints.end.x+n,y:o.linePoints.end.y+i}}}}return e.changes;case"resize":if(e.changes.rect){const n=o.rect,i=e.changes.rect;let s=i.size.width/n.size.width,r=i.size.height/n.size.height;const a=10;if((i.size.width<a||i.size.height<a)&&(s=Math.max(s,a/n.size.width),r=Math.max(r,a/n.size.height),e.changes.rect={origin:i.origin,size:{width:n.size.width*s,height:n.size.height*r}}),e.metadata?.maintainAspectRatio){const d=Math.min(s,r);s=d,r=d,e.changes.rect.size={width:n.size.width*d,height:n.size.height*d}}const v={start:{x:e.changes.rect.origin.x+(o.linePoints.start.x-n.origin.x)*s,y:e.changes.rect.origin.y+(o.linePoints.start.y-n.origin.y)*r},end:{x:e.changes.rect.origin.x+(o.linePoints.end.x-n.origin.x)*s,y:e.changes.rect.origin.y+(o.linePoints.end.y-n.origin.y)*r}};return{rect:e.changes.rect,linePoints:v}}return e.changes;case"property-update":if(e.changes.strokeWidth||e.changes.lineEndings){const n={...o,...e.changes},i=ke([n.linePoints.start,n.linePoints.end],n.strokeWidth,n.lineEndings);return{...e.changes,rect:i}}return e.changes;default:return e.changes}},Ui=(o,e)=>{switch(e.type){case"vertex-edit":return e.changes.vertices&&e.changes.vertices.length?{rect:ke(e.changes.vertices,o.strokeWidth,o.lineEndings),vertices:e.changes.vertices}:e.changes;case"move":if(e.changes.rect){const n=e.changes.rect.origin.x-o.rect.origin.x,i=e.changes.rect.origin.y-o.rect.origin.y,s=o.vertices.map(r=>({x:r.x+n,y:r.y+i}));return{rect:e.changes.rect,vertices:s}}return e.changes;case"resize":if(e.changes.rect){const n=o.rect,i=e.changes.rect;let s=i.size.width/n.size.width,r=i.size.height/n.size.height;const a=10;if((i.size.width<a||i.size.height<a)&&(s=Math.max(s,a/n.size.width),r=Math.max(r,a/n.size.height),e.changes.rect={origin:i.origin,size:{width:n.size.width*s,height:n.size.height*r}}),e.metadata?.maintainAspectRatio){const d=Math.min(s,r);s=d,r=d,e.changes.rect.size={width:n.size.width*d,height:n.size.height*d}}const v=o.vertices.map(d=>({x:e.changes.rect.origin.x+(d.x-n.origin.x)*s,y:e.changes.rect.origin.y+(d.y-n.origin.y)*r}));return{rect:e.changes.rect,vertices:v}}return e.changes;case"property-update":if(e.changes.strokeWidth!==void 0||e.changes.lineEndings!==void 0){const n={...o,...e.changes},i=ke(n.vertices,n.strokeWidth,n.lineEndings);return{...e.changes,rect:i}}return e.changes;default:return e.changes}},ji=(o,e)=>{switch(e.type){case"vertex-edit":if(e.changes.vertices&&e.changes.vertices.length){const n=o.strokeWidth/2;return{rect:Ue(je(e.changes.vertices),n),vertices:e.changes.vertices}}return e.changes;case"move":if(e.changes.rect){const n=e.changes.rect.origin.x-o.rect.origin.x,i=e.changes.rect.origin.y-o.rect.origin.y,s=o.vertices.map(r=>({x:r.x+n,y:r.y+i}));return{rect:e.changes.rect,vertices:s}}return e.changes;case"resize":if(e.changes.rect){const n=o.rect,i=e.changes.rect;let s=i.size.width/n.size.width,r=i.size.height/n.size.height;const a=10;if((i.size.width<a||i.size.height<a)&&(s=Math.max(s,a/n.size.width),r=Math.max(r,a/n.size.height),e.changes.rect={origin:i.origin,size:{width:n.size.width*s,height:n.size.height*r}}),e.metadata?.maintainAspectRatio){const d=Math.min(s,r);s=d,r=d,e.changes.rect.size={width:n.size.width*d,height:n.size.height*d}}const v=o.vertices.map(d=>({x:e.changes.rect.origin.x+(d.x-n.origin.x)*s,y:e.changes.rect.origin.y+(d.y-n.origin.y)*r}));return{rect:e.changes.rect,vertices:v}}return e.changes;case"property-update":if(e.changes.strokeWidth!==void 0){const n={...o,...e.changes},i=n.strokeWidth/2,s=Ue(je(n.vertices),i);return{...e.changes,rect:s}}return e.changes;default:return e.changes}},hn=class extends Xt{constructor(e,n,i){super(e,n),this.ANNOTATION_HISTORY_TOPIC="annotations",this.state$=Tt(),this.pendingContexts=new Map,this.handlerFactories=new Map,this.activeTool$=Tt(null),this.events$=Tt(),this.patchRegistry=new Ot,this.isInitialLoadComplete=!1,this.importQueue=[],this.config=i,this.selection=n.getPlugin("selection")?.provides()??null,this.history=n.getPlugin("history")?.provides()??null,this.interactionManager=n.getPlugin("interaction-manager")?.provides()??null,this.coreStore.onAction(Rn,(s,r)=>{const a=r.core.document;this.isInitialLoadComplete=!1,a&&this.getAllAnnotations(a)}),this.registerHandlerFactories(),this.registerBuiltInPatches()}registerHandlerFactories(){this.handlerFactories.set(P.CIRCLE,Li),this.handlerFactories.set(P.SQUARE,Mi),this.handlerFactories.set(P.STAMP,Oi),this.handlerFactories.set(P.POLYGON,Di),this.handlerFactories.set(P.POLYLINE,Ei),this.handlerFactories.set(P.LINE,zi),this.handlerFactories.set(P.INK,Si),this.handlerFactories.set(P.FREETEXT,Ci)}registerBuiltInPatches(){this.patchRegistry.register(P.INK,Ni),this.patchRegistry.register(P.LINE,Hi),this.patchRegistry.register(P.POLYLINE,Ui),this.patchRegistry.register(P.POLYGON,ji)}async initialize(){this.state.tools.forEach(e=>this.registerInteractionForTool(e)),this.history?.onHistoryChange(e=>{e===this.ANNOTATION_HISTORY_TOPIC&&this.config.autoCommit!==!1&&this.commit()}),this.interactionManager?.onModeChange(e=>{const n=this.state.tools.find(i=>(i.interaction.mode??i.id)===e.activeMode)?.id??null;n!==this.state.activeToolId&&this.dispatch(ai(n))}),this.selection?.onEndSelection(()=>{const e=this.getActiveTool();if(!e||!e.interaction.textSelection)return;const n=this.selection?.getFormattedSelection(),i=this.selection?.getSelectedText();if(!(!n||!i)){for(const s of n)i.wait(r=>{const a=ge();this.createAnnotation(s.pageIndex,{...e.defaults,rect:s.rect,segmentRects:s.segmentRects,pageIndex:s.pageIndex,created:new Date,id:a,custom:{text:r.join(`
`)}}),this.getToolBehavior(e,"deactivateToolAfterCreate")&&this.setActiveTool(null),this.getToolBehavior(e,"selectAfterCreate")&&this.selectAnnotation(s.pageIndex,a)},lt);this.selection?.clear()}})}registerInteractionForTool(e){this.interactionManager?.registerMode({id:e.interaction.mode??e.id,scope:"page",exclusive:e.interaction.exclusive,cursor:e.interaction.cursor}),e.interaction.textSelection&&this.selection?.enableForMode(e.interaction.mode??e.id)}buildCapability(){return{getPageAnnotations:e=>this.getPageAnnotations(e),getSelectedAnnotation:()=>Pi(this.state),selectAnnotation:(e,n)=>this.selectAnnotation(e,n),deselectAnnotation:()=>this.dispatch(Et()),getActiveTool:()=>this.getActiveTool(),setActiveTool:e=>this.setActiveTool(e),getTools:()=>this.state.tools,getTool:e=>this.getTool(e),addTool:e=>{this.dispatch(li(e)),this.registerInteractionForTool(e)},transformAnnotation:(e,n)=>this.transformAnnotation(e,n),registerPatchFunction:(e,n)=>this.registerPatchFunction(e,n),findToolForAnnotation:e=>this.findToolForAnnotation(e),setToolDefaults:(e,n)=>this.dispatch(ci(e,n)),getColorPresets:()=>[...this.state.colorPresets],addColorPreset:e=>this.dispatch(si(e)),importAnnotations:e=>this.importAnnotations(e),createAnnotation:(e,n,i)=>this.createAnnotation(e,n,i),updateAnnotation:(e,n,i)=>this.updateAnnotation(e,n,i),deleteAnnotation:(e,n)=>this.deleteAnnotation(e,n),renderAnnotation:e=>this.renderAnnotation(e),onStateChange:this.state$.on,onActiveToolChange:this.activeTool$.on,onAnnotationEvent:this.events$.on,commit:()=>this.commit()}}onStoreUpdated(e,n){this.state$.emit(n),(e.activeToolId!==n.activeToolId||e.tools!==n.tools)&&this.activeTool$.emit(this.getActiveTool())}registerPatchFunction(e,n){this.patchRegistry.register(e,n)}transformAnnotation(e,n){const i={type:n.type,changes:n.changes,metadata:n.metadata};return this.patchRegistry.transform(e,i)}registerPageHandlers(e,n,i){const s=this.coreState.core.document?.pages[e];if(!s)return()=>{};if(!this.interactionManager)return()=>{};const r=[];for(const a of this.state.tools){if(!a.defaults.type)continue;const v=this.handlerFactories.get(a.defaults.type);if(!v)continue;const d={pageIndex:e,pageSize:s.size,scale:n,services:i.services,onPreview:m=>i.onPreview(a.id,m),onCommit:(m,u)=>{this.createAnnotation(e,m,u),this.getToolBehavior(a,"deactivateToolAfterCreate")&&this.setActiveTool(null),this.getToolBehavior(a,"selectAfterCreate")&&this.selectAnnotation(e,m.id)},getTool:()=>this.state.tools.find(m=>m.id===a.id)},h=this.interactionManager.registerHandlers({modeId:a.interaction.mode??a.id,handlers:v.create(d),pageIndex:e});r.push(h)}return()=>r.forEach(a=>a())}getAllAnnotations(e){this.engine.getAllAnnotations(e).wait(i=>{this.dispatch(ii(i)),this.isInitialLoadComplete=!0,this.importQueue.length>0&&this.processImportQueue(),this.events$.emit({type:"loaded",total:Object.values(i).reduce((s,r)=>s+r.length,0)})},lt)}getPageAnnotations(e){const{pageIndex:n}=e,i=this.coreState.core.document;if(!i)return Ge.reject({code:Xe.NotFound,message:"Document not found"});const s=i.pages.find(r=>r.index===n);return s?this.engine.getPageAnnotations(i,s):Ge.reject({code:Xe.NotFound,message:"Page not found"})}renderAnnotation({pageIndex:e,annotation:n,options:i}){const s=this.coreState.core;if(!s.document)return Ge.reject({code:Xe.NotFound,message:"Document not found"});const r=s.document.pages.find(a=>a.index===e);return r?this.engine.renderPageAnnotation(s.document,r,n,i):Ge.reject({code:Xe.NotFound,message:"Page not found"})}importAnnotations(e){if(!this.isInitialLoadComplete){this.importQueue.push(...e);return}this.processImportItems(e)}processImportQueue(){if(this.importQueue.length===0)return;const e=[...this.importQueue];this.importQueue=[],this.processImportItems(e)}processImportItems(e){for(const n of e){const{annotation:i,ctx:s}=n,r=i.pageIndex,a=i.id;this.dispatch(Rt(r,i)),s&&this.pendingContexts.set(a,s)}this.config.autoCommit!==!1&&this.commit()}createAnnotation(e,n,i){const s=n.id,r={...n,author:n.author??this.config.annotationAuthor},a=()=>{this.dispatch(Rt(e,r)),i&&this.pendingContexts.set(s,i),this.events$.emit({type:"create",annotation:r,pageIndex:e,ctx:i,committed:!1})};if(!this.history){a(),this.config.autoCommit&&this.commit();return}const v={execute:a,undo:()=>{this.pendingContexts.delete(s),this.dispatch(Et()),this.dispatch(jt(e,s)),this.events$.emit({type:"delete",annotation:r,pageIndex:e,committed:!1})}};this.history.register(v,this.ANNOTATION_HISTORY_TOPIC)}buildPatch(e,n){return"rect"in n?n:this.transformAnnotation(e,{type:"property-update",changes:n})}updateAnnotation(e,n,i){const s=this.state.byUid[n].object,r=this.buildPatch(s,{...i,author:i.author??this.config.annotationAuthor}),a=()=>{this.dispatch(Ut(e,n,r)),this.events$.emit({type:"update",annotation:s,pageIndex:e,patch:r,committed:!1})};if(!this.history){a(),this.config.autoCommit!==!1&&this.commit();return}const v=Object.fromEntries(Object.keys(i).map(h=>[h,s[h]])),d={execute:a,undo:()=>{this.dispatch(Ut(e,n,v)),this.events$.emit({type:"update",annotation:s,pageIndex:e,patch:v,committed:!1})}};this.history.register(d,this.ANNOTATION_HISTORY_TOPIC)}deleteAnnotation(e,n){const i=this.state.byUid[n]?.object;if(!i)return;const s=()=>{this.dispatch(Et()),this.dispatch(jt(e,n)),this.events$.emit({type:"delete",annotation:i,pageIndex:e,committed:!1})};if(!this.history){s(),this.config.autoCommit!==!1&&this.commit();return}const r={execute:s,undo:()=>{this.dispatch(Rt(e,i)),this.events$.emit({type:"create",annotation:i,pageIndex:e,committed:!1})}};this.history.register(r,this.ANNOTATION_HISTORY_TOPIC)}selectAnnotation(e,n){this.dispatch(oi(e,n))}getActiveTool(){return this.state.activeToolId?this.state.tools.find(e=>e.id===this.state.activeToolId)??null:null}setActiveTool(e){if(e===this.state.activeToolId)return;const n=this.state.tools.find(i=>i.id===e);n?this.interactionManager?.activate(n.interaction.mode??n.id):this.interactionManager?.activateDefaultMode()}getTool(e){return this.state.tools.find(n=>n.id===e)}findToolForAnnotation(e){let n=null,i=0;for(const s of this.state.tools){const r=s.matchScore(e);r>i&&(i=r,n=s)}return n}commit(){const e=new zt;if(!this.state.hasPendingChanges)return Ge.resolve(!0);const n=this.coreState.core.document;if(!n)return Ge.reject({code:Xe.NotFound,message:"Document not found"});const i=[],s=[],r=[];for(const[d,h]of Object.entries(this.state.byUid)){if(h.commitState==="synced")continue;const m=n.pages.find(u=>u.index===h.object.pageIndex);if(m)switch(h.commitState){case"new":const u=this.pendingContexts.get(h.object.id),l=this.engine.createPageAnnotation(n,m,h.object,u);l.wait(()=>{this.events$.emit({type:"create",annotation:h.object,pageIndex:h.object.pageIndex,ctx:u,committed:!0}),this.pendingContexts.delete(h.object.id)},lt),i.push(l);break;case"dirty":const c=this.engine.updatePageAnnotation(n,m,h.object);c.wait(()=>{this.events$.emit({type:"update",annotation:h.object,pageIndex:h.object.pageIndex,patch:h.object,committed:!0})},lt),s.push(c);break;case"deleted":r.push({ta:h,uid:d});break}}const a=[];for(const{ta:d,uid:h}of r){const m=n.pages.find(u=>u.index===d.object.pageIndex);if(d.commitState==="deleted"&&d.object.id){const u=new zt;this.engine.removePageAnnotation(n,m,d.object).wait(()=>{this.dispatch(Ft(h)),this.events$.emit({type:"delete",annotation:d.object,pageIndex:d.object.pageIndex,committed:!0}),u.resolve(!0)},u.fail),a.push(u)}else this.dispatch(Ft(h))}const v=[...i,...s,...a];return zt.allSettled(v).wait(()=>{this.dispatch(ri()),e.resolve(!0)},e.fail),e}getToolBehavior(e,n){return e.behavior?.[n]!==void 0?e.behavior[n]:this.config[n]!==!1}};hn.id="annotation";let Lt=hn;const Fi=[{id:"highlight",name:"Highlight",matchScore:o=>o.type===P.HIGHLIGHT?1:0,interaction:{exclusive:!1,textSelection:!0,isDraggable:!1,isResizable:!1},defaults:{type:P.HIGHLIGHT,color:"#FFCD45",opacity:1,blendMode:Ye.Multiply}},{id:"underline",name:"Underline",matchScore:o=>o.type===P.UNDERLINE?1:0,interaction:{exclusive:!1,textSelection:!0,isDraggable:!1,isResizable:!1},defaults:{type:P.UNDERLINE,color:"#E44234",opacity:1}},{id:"strikeout",name:"Strikeout",matchScore:o=>o.type===P.STRIKEOUT?1:0,interaction:{exclusive:!1,textSelection:!0},defaults:{type:P.STRIKEOUT,color:"#E44234",opacity:1}},{id:"squiggly",name:"Squiggly",matchScore:o=>o.type===P.SQUIGGLY?1:0,interaction:{exclusive:!1,textSelection:!0,isDraggable:!1,isResizable:!1},defaults:{type:P.SQUIGGLY,color:"#E44234",opacity:1}},{id:"ink",name:"Pen",matchScore:o=>o.type===P.INK&&o.intent!=="InkHighlight"?5:0,interaction:{exclusive:!1,cursor:"crosshair",isDraggable:!0,isResizable:!0,lockAspectRatio:!1},defaults:{type:P.INK,color:"#E44234",opacity:1,strokeWidth:6}},{id:"inkHighlighter",name:"Ink Highlighter",matchScore:o=>o.type===P.INK&&o.intent==="InkHighlight"?10:0,interaction:{exclusive:!1,cursor:"crosshair",isDraggable:!0,isResizable:!0,lockAspectRatio:!1},defaults:{type:P.INK,intent:"InkHighlight",color:"#FFCD45",opacity:1,strokeWidth:14,blendMode:Ye.Multiply}},{id:"circle",name:"Circle",matchScore:o=>o.type===P.CIRCLE?1:0,interaction:{exclusive:!1,cursor:"crosshair",isDraggable:!0,isResizable:!0,lockAspectRatio:!1},defaults:{type:P.CIRCLE,color:"transparent",opacity:1,strokeWidth:6,strokeColor:"#E44234",strokeStyle:le.SOLID},clickBehavior:{enabled:!0,defaultSize:{width:100,height:100}}},{id:"square",name:"Square",matchScore:o=>o.type===P.SQUARE?1:0,interaction:{exclusive:!1,cursor:"crosshair",isDraggable:!0,isResizable:!0,lockAspectRatio:!1},defaults:{type:P.SQUARE,color:"transparent",opacity:1,strokeWidth:6,strokeColor:"#E44234",strokeStyle:le.SOLID},clickBehavior:{enabled:!0,defaultSize:{width:100,height:100}}},{id:"line",name:"Line",matchScore:o=>o.type===P.LINE&&o.intent!=="LineArrow"?5:0,interaction:{exclusive:!1,cursor:"crosshair",isDraggable:!0,isResizable:!1,lockAspectRatio:!1},defaults:{type:P.LINE,color:"transparent",opacity:1,strokeWidth:6,strokeColor:"#E44234"},clickBehavior:{enabled:!0,defaultLength:100,defaultAngle:0}},{id:"lineArrow",name:"Arrow",matchScore:o=>o.type===P.LINE&&o.intent==="LineArrow"?10:0,interaction:{exclusive:!1,cursor:"crosshair",isDraggable:!0,isResizable:!1,lockAspectRatio:!1},defaults:{type:P.LINE,intent:"LineArrow",color:"transparent",opacity:1,strokeWidth:6,strokeColor:"#E44234",lineEndings:{start:ce.None,end:ce.OpenArrow}},clickBehavior:{enabled:!0,defaultLength:100,defaultAngle:0}},{id:"polyline",name:"Polyline",matchScore:o=>o.type===P.POLYLINE?1:0,interaction:{exclusive:!1,cursor:"crosshair",isDraggable:!0,isResizable:!1,lockAspectRatio:!1},defaults:{type:P.POLYLINE,color:"transparent",opacity:1,strokeWidth:6,strokeColor:"#E44234"}},{id:"polygon",name:"Polygon",matchScore:o=>o.type===P.POLYGON?1:0,interaction:{exclusive:!1,cursor:"crosshair",isDraggable:!0,isResizable:!1,lockAspectRatio:!1},defaults:{type:P.POLYGON,color:"transparent",opacity:1,strokeWidth:6,strokeColor:"#E44234"}},{id:"freeText",name:"Free Text",matchScore:o=>o.type===P.FREETEXT?1:0,interaction:{exclusive:!1,cursor:"crosshair",isDraggable:!0,isResizable:!0,lockAspectRatio:!1},defaults:{type:P.FREETEXT,contents:"Insert text",fontSize:14,fontColor:"#E44234",fontFamily:Gt.Helvetica,textAlign:Yt.Left,verticalAlign:ut.Top,backgroundColor:"transparent",opacity:1},clickBehavior:{enabled:!0,defaultSize:{width:100,height:20},defaultContent:"Insert text"}},{id:"stamp",name:"Image",matchScore:o=>o.type===P.STAMP?1:0,interaction:{exclusive:!1,cursor:"copy",isDraggable:!0,isResizable:!0,lockAspectRatio:!0},defaults:{type:P.STAMP}}],Wi=["#E44234","#FF8D00","#FFCD45","#5CC96E","#25D2D1","#597CE2","#C544CE","#7D2E25","#000000","#FFFFFF"],Vi=(o,e,n)=>{const i=o.byUid[e];return i?{...o,byUid:{...o.byUid,[e]:{...i,commitState:i.commitState==="synced"?"dirty":i.commitState,object:{...i.object,...n}}},hasPendingChanges:!0}:o},Bi=o=>{const e=new Map;return Fi.forEach(n=>e.set(n.id,n)),(o.tools||[]).forEach(n=>e.set(n.id,n)),{pages:{},byUid:{},selectedUid:null,activeToolId:null,tools:Array.from(e.values()),colorPresets:o.colorPresets??Wi,hasPendingChanges:!1}},Yi=(o,e)=>{switch(e.type){case Zt:{const n={...o.pages},i={...o.byUid};for(const[s,r]of Object.entries(e.payload)){const a=Number(s),v=o.pages[a]||[];for(const h of v)delete i[h];const d=r.map(h=>{const m=h.id;return i[m]={commitState:"synced",object:h},m});n[a]=d}return{...o,pages:n,byUid:i}}case an:return{...o,activeToolId:e.payload};case ln:{const n=new Map(o.tools.map(i=>[i.id,i]));return n.set(e.payload.id,e.payload),{...o,tools:Array.from(n.values())}}case cn:{const{toolId:n,patch:i}=e.payload;return{...o,tools:o.tools.map(s=>s.id===n?{...s,defaults:{...s.defaults,...i}}:s)}}case Jt:return{...o,selectedUid:e.payload.id};case $t:return{...o,selectedUid:null};case en:return o.colorPresets.includes(e.payload)?o:{...o,colorPresets:[...o.colorPresets,e.payload]};case tn:{const{pageIndex:n,annotation:i}=e.payload,s=i.id;return{...o,pages:{...o.pages,[n]:[...o.pages[n]??[],s]},byUid:{...o.byUid,[s]:{commitState:"new",object:i}},hasPendingChanges:!0}}case on:{const{pageIndex:n,id:i}=e.payload;return o.byUid[i]?{...o,pages:{...o.pages,[n]:(o.pages[n]??[]).filter(s=>s!==i)},byUid:{...o.byUid,[i]:{...o.byUid[i],commitState:"deleted"}},hasPendingChanges:!0}:o}case nn:return Vi(o,e.payload.id,e.payload.patch);case sn:{const n={};for(const[i,s]of Object.entries(o.byUid))n[i]={...s,commitState:s.commitState==="dirty"||s.commitState==="new"?"synced":s.commitState};return{...o,byUid:n,hasPendingChanges:!1}}case rn:{const{uid:n}=e.payload,{[n]:i,...s}=o.byUid;return{...o,byUid:s}}default:return o}},Gi={manifest:ni,create:(o,e)=>new Lt(Kt,o,e),reducer:Yi,initialState:(o,e)=>Bi(e)};function Xi(o,e){const{width:n,height:i}=o.size;switch(e%4){case 1:return{matrix:`matrix(0, -1, 1, 0, 0, ${i})`,width:i,height:n};case 2:return{matrix:`matrix(-1, 0, 0, -1, ${n}, ${i})`,width:n,height:i};case 3:return{matrix:`matrix(0, 1, -1, 0, ${n}, 0)`,width:i,height:n};default:return{matrix:"matrix(1, 0, 0, 1, 0, 0)",width:n,height:i}}}class Qi{constructor(e,n){this.config=e,this.onUpdate=n,this.state="idle",this.startPoint=null,this.startElement=null,this.activeHandle=null,this.currentPosition=null,this.activeVertexIndex=null,this.startVertices=[],this.currentVertices=[],this.currentVertices=e.vertices||[]}updateConfig(e){this.config={...this.config,...e},this.currentVertices=e.vertices||[]}startDrag(e,n){this.state="dragging",this.startPoint={x:e,y:n},this.startElement={...this.config.element},this.currentPosition={...this.config.element},this.onUpdate({state:"start",transformData:{type:"move",changes:{rect:this.startElement}}})}startResize(e,n,i){this.state="resizing",this.activeHandle=e,this.startPoint={x:n,y:i},this.startElement={...this.config.element},this.currentPosition={...this.config.element},this.onUpdate({state:"start",transformData:{type:"resize",changes:{rect:this.startElement},metadata:{handle:this.activeHandle,maintainAspectRatio:this.config.maintainAspectRatio}}})}startVertexEdit(e,n,i){this.currentVertices=[...this.config.vertices??this.currentVertices],!(e<0||e>=this.currentVertices.length)&&(this.state="vertex-editing",this.activeVertexIndex=e,this.startPoint={x:n,y:i},this.startVertices=[...this.currentVertices],this.onUpdate({state:"start",transformData:{type:"vertex-edit",changes:{vertices:this.startVertices},metadata:{vertexIndex:e}}}))}move(e,n){if(!(this.state==="idle"||!this.startPoint)){if(this.state==="dragging"&&this.startElement){const i=this.calculateDelta(e,n),s=this.calculateDragPosition(i);this.currentPosition=s,this.onUpdate({state:"move",transformData:{type:"move",changes:{rect:s}}})}else if(this.state==="resizing"&&this.activeHandle&&this.startElement){const i=this.calculateDelta(e,n),s=this.calculateResizePosition(i,this.activeHandle);this.currentPosition=s,this.onUpdate({state:"move",transformData:{type:"resize",changes:{rect:s},metadata:{handle:this.activeHandle,maintainAspectRatio:this.config.maintainAspectRatio}}})}else if(this.state==="vertex-editing"&&this.activeVertexIndex!==null){const i=this.calculateVertexPosition(e,n);this.currentVertices=i,this.onUpdate({state:"move",transformData:{type:"vertex-edit",changes:{vertices:i},metadata:{vertexIndex:this.activeVertexIndex}}})}}}end(){if(this.state==="idle")return;const e=this.state,n=this.activeHandle,i=this.activeVertexIndex;if(e==="vertex-editing")this.onUpdate({state:"end",transformData:{type:"vertex-edit",changes:{vertices:this.currentVertices},metadata:{vertexIndex:i||void 0}}});else{const s=this.getCurrentPosition();this.onUpdate({state:"end",transformData:{type:e==="dragging"?"move":"resize",changes:{rect:s},metadata:e==="dragging"?void 0:{handle:n||void 0,maintainAspectRatio:this.config.maintainAspectRatio}}})}this.reset()}cancel(){this.state!=="idle"&&(this.state==="vertex-editing"?this.onUpdate({state:"end",transformData:{type:"vertex-edit",changes:{vertices:this.startVertices},metadata:{vertexIndex:this.activeVertexIndex||void 0}}}):this.startElement&&this.onUpdate({state:"end",transformData:{type:this.state==="dragging"?"move":"resize",changes:{rect:this.startElement},metadata:this.state==="dragging"?void 0:{handle:this.activeHandle||void 0,maintainAspectRatio:this.config.maintainAspectRatio}}}),this.reset())}reset(){this.state="idle",this.startPoint=null,this.startElement=null,this.activeHandle=null,this.currentPosition=null,this.activeVertexIndex=null,this.startVertices=[]}getCurrentPosition(){return this.currentPosition||this.config.element}calculateDelta(e,n){if(!this.startPoint)return{x:0,y:0};const i={x:e-this.startPoint.x,y:n-this.startPoint.y};return this.transformDelta(i)}transformDelta(e){const{pageRotation:n=0,scale:i=1}=this.config,s=n*Math.PI/2,r=Math.cos(s),a=Math.sin(s),v=e.x/i,d=e.y/i;return{x:r*v+a*d,y:-a*v+r*d}}clampPoint(e){const n=this.config.constraints?.boundingBox;return n?{x:Math.max(0,Math.min(e.x,n.width)),y:Math.max(0,Math.min(e.y,n.height))}:e}calculateVertexPosition(e,n){if(this.activeVertexIndex===null)return this.startVertices;const i=this.calculateDelta(e,n),s=[...this.startVertices],r=s[this.activeVertexIndex],a={x:r.x+i.x,y:r.y+i.y};return s[this.activeVertexIndex]=this.clampPoint(a),s}calculateDragPosition(e){if(!this.startElement)return this.config.element;const n={origin:{x:this.startElement.origin.x+e.x,y:this.startElement.origin.y+e.y},size:{width:this.startElement.size.width,height:this.startElement.size.height}};return this.applyConstraints(n)}calculateResizePosition(e,n){if(!this.startElement)return this.config.element;let{origin:{x:i,y:s},size:{width:r,height:a}}=this.startElement;switch(n){case"se":r+=e.x,a+=e.y;break;case"sw":i+=e.x,r-=e.x,a+=e.y;break;case"ne":r+=e.x,s+=e.y,a-=e.y;break;case"nw":i+=e.x,r-=e.x,s+=e.y,a-=e.y;break;case"n":s+=e.y,a-=e.y;break;case"s":a+=e.y;break;case"e":r+=e.x;break;case"w":i+=e.x,r-=e.x;break}if(this.config.maintainAspectRatio&&this.startElement){const d=this.startElement.size.width/this.startElement.size.height;if(["n","s","e","w"].includes(n))if(n==="n"||n==="s"){const h=a*d,m=h-r;r=h,i-=m/2}else{const h=r/d,m=h-a;a=h,n==="w"&&(i=this.startElement.origin.x+this.startElement.size.width-r),s-=m/2}else{const h=Math.abs(r-this.startElement.size.width),m=Math.abs(a-this.startElement.size.height);h>m?a=r/d:r=a*d,n.includes("w")&&(i=this.startElement.origin.x+this.startElement.size.width-r),n.includes("n")&&(s=this.startElement.origin.y+this.startElement.size.height-a)}}const v=this.config.constraints?.boundingBox;if(v)switch(n){case"e":r=Math.min(r,v.width-i);break;case"s":a=Math.min(a,v.height-s);break;case"se":r=Math.min(r,v.width-i),a=Math.min(a,v.height-s);break;case"w":i<0&&(r+=i,i=0);break;case"n":s<0&&(a+=s,s=0);break;case"sw":i<0&&(r+=i,i=0),a=Math.min(a,v.height-s);break;case"nw":i<0&&(r+=i,i=0),s<0&&(a+=s,s=0);break;case"ne":r=Math.min(r,v.width-i),s<0&&(a+=s,s=0);break}return this.applyConstraints({origin:{x:i,y:s},size:{width:r,height:a}})}applyConstraints(e){const{constraints:n}=this.config;if(!n)return e;let{origin:{x:i,y:s},size:{width:r,height:a}}=e;return r=Math.max(n.minWidth||1,r),a=Math.max(n.minHeight||1,a),n.maxWidth&&(r=Math.min(n.maxWidth,r)),n.maxHeight&&(a=Math.min(n.maxHeight,a)),n.boundingBox&&(i=Math.max(0,Math.min(i,n.boundingBox.width-r)),s=Math.max(0,Math.min(s,n.boundingBox.height-a))),{origin:{x:i,y:s},size:{width:r,height:a}}}}function qi(o,e){const n={nw:"nwse-resize",ne:"nesw-resize",sw:"nesw-resize",se:"nwse-resize"};return o==="n"||o==="s"?"ns-resize":o==="e"||o==="w"?"ew-resize":e%2===0?n[o]:{nw:"nesw-resize",ne:"nwse-resize",sw:"nwse-resize",se:"nesw-resize"}[o]}function Ki(o,e,n){const i=-o/2;return n==="center"?i:n==="outside"?i-e:i+e}function Zi(o,e={}){const{handleSize:n=8,spacing:i=1,offsetMode:s="outside",includeSides:r=!1,zIndex:a=3,rotationAwareCursor:v=!0}=e,d=(o.pageRotation??0)%4,h=c=>({[c]:Ki(n,i,s)+"px"}),m=[["nw",{...h("top"),...h("left")}],["ne",{...h("top"),...h("right")}],["sw",{...h("bottom"),...h("left")}],["se",{...h("bottom"),...h("right")}]],u=r?[["n",{...h("top"),left:`calc(50% - ${n/2}px)`}],["s",{...h("bottom"),left:`calc(50% - ${n/2}px)`}],["w",{...h("left"),top:`calc(50% - ${n/2}px)`}],["e",{...h("right"),top:`calc(50% - ${n/2}px)`}]]:[];return[...m,...u].map(([c,y])=>({handle:c,style:{position:"absolute",width:n+"px",height:n+"px",borderRadius:"50%",zIndex:a,cursor:v?qi(c,d):"default",touchAction:"none",...y},attrs:{"data-epdf-handle":c}}))}function Ji(o,e={},n){const{vertexSize:i=12,zIndex:s=4}=e,r=o.element,a=o.scale??1;return(n??o.vertices??[]).map((d,h)=>{const m=(d.x-r.origin.x)*a-i/2,u=(d.y-r.origin.y)*a-i/2;return{handle:"nw",style:{position:"absolute",left:m+"px",top:u+"px",width:i+"px",height:i+"px",borderRadius:"50%",cursor:"pointer",zIndex:s,touchAction:"none"},attrs:{"data-epdf-vertex":h}}})}function $i(o){const{onUpdate:e,enabled:n=!0,...i}=o;let s=oe(null);be(()=>{t(s)?t(s).updateConfig(i):te(s,new Qi(i,u=>e?.(u)),!0)});const r=u=>{n&&(u.preventDefault(),u.stopPropagation(),t(s)?.startDrag(u.clientX,u.clientY),u.currentTarget.setPointerCapture(u.pointerId))},a=u=>{u.preventDefault(),u.stopPropagation(),t(s)?.move(u.clientX,u.clientY)},v=u=>{u.preventDefault(),u.stopPropagation(),t(s)?.end(),u.currentTarget.releasePointerCapture?.(u.pointerId)},d=u=>({onpointerdown:l=>{n&&(l.preventDefault(),l.stopPropagation(),t(s)?.startResize(u,l.clientX,l.clientY),l.currentTarget.setPointerCapture(l.pointerId))},onpointermove:a,onpointerup:v,onpointercancel:v}),h=u=>({onpointerdown:l=>{n&&(l.preventDefault(),l.stopPropagation(),t(s)?.startVertexEdit(u,l.clientX,l.clientY),l.currentTarget.setPointerCapture(l.pointerId))},onpointermove:a,onpointerup:v,onpointercancel:v}),m=b(()=>n?{onpointerdown:r,onpointermove:a,onpointerup:v,onpointercancel:v}:{});return{get dragProps(){return t(m)},createResizeProps:d,createVertexProps:h}}function eo(o){const{controller:e,resizeUI:n,vertexUI:i,includeVertices:s=!1,handleAttrs:r,vertexAttrs:a}=o,v=$i(e),d=b(()=>Zi(e,n).map(u=>({key:u.attrs?.["data-epdf-handle"],style:u.style,...v.createResizeProps(u.handle),...u.attrs??{},...r?.(u.handle)??{}}))),h=b(()=>s?Ji(e,i,e.vertices).map((u,l)=>({key:l,style:u.style,...v.createVertexProps(l),...u.attrs??{},...a?.(l)??{}})):[]);return{get dragProps(){return v.dragProps},get resize(){return t(d)},get vertices(){return t(h)}}}function to(o,e={}){let{onDouble:n,delay:i=300,tolerancePx:s=18}=e;const r={t:0,x:0,y:0},a=d=>{const h=d;if(!n||h.pointerType==="mouse"||h.isPrimary===!1)return;const m=performance.now(),u=h.clientX,l=h.clientY,c=m-r.t<=i,y=u-r.x,g=l-r.y,x=y*y+g*g<=s*s;c&&x&&n?.(h),r.t=m,r.x=u,r.y=l},v=d=>{n?.(d)};return o.addEventListener("pointerup",a,{capture:!0}),o.addEventListener("dblclick",v),{update(d){d&&(n=d.onDouble,i=d.delay??i,s=d.tolerancePx??s)},destroy(){o.removeEventListener("pointerup",a,{capture:!0}),o.removeEventListener("dblclick",v)}}}function no(o,e){J(e,!0);const n=b(()=>Xi(e.rect,e.rotation));let i=oe(null);be(()=>{const d=t(i);if(!d)return;const h=u=>{u.stopPropagation()},m=u=>{u.stopPropagation()};return d.addEventListener("pointerdown",h,{capture:!0}),d.addEventListener("touchstart",m,{capture:!0}),()=>{d.removeEventListener("pointerdown",h,{capture:!0}),d.removeEventListener("touchstart",m,{capture:!0})}});const s=b(()=>({position:"absolute",left:e.rect.origin.x,top:e.rect.origin.y,transform:t(n).matrix,transformOrigin:"0 0",width:t(n).width,height:t(n).height,pointerEvents:"none",zIndex:3})),r=b(()=>({style:t(s),ref:d=>{te(i,d,!0)}}));var a=R(),v=z(a);ht(v,()=>e.children,()=>({menuWrapperProps:t(r),matrix:t(n).matrix,rect:{origin:{x:e.rect.origin.x,y:e.rect.origin.y},size:{width:t(n).width,height:t(n).height}}})),A(o,a),$()}const qe=()=>On(Lt.id),io=()=>Nn(Lt.id);var oo=G("<div></div>"),so=G("<div></div>"),ro=G('<div data-no-interaction=""><div><!> <!> <!></div> <!></div>');function ye(o,e){J(e,!0);let n=L(e,"lockAspectRatio",3,!1),i=L(e,"class",3,""),s=L(e,"outlineOffset",3,1),r=L(e,"zIndex",3,1),a=L(e,"selectionOutlineColor",3,"#007ACC"),v=vt(e,["$$slots","$$events","$$legacy","scale","pageIndex","rotation","pageWidth","pageHeight","trackedAnnotation","children","isSelected","isDraggable","isResizable","lockAspectRatio","class","vertexConfig","selectionMenu","outlineOffset","onDoubleClick","onSelect","zIndex","resizeUI","vertexUI","selectionOutlineColor","customAnnotationRenderer"]),d=oe(ft(e.trackedAnnotation.object)),h=qe(),m=oe(null);const u=b(()=>t(d)?{...e.trackedAnnotation.object,...t(d)}:e.trackedAnnotation.object),l=b(()=>e.resizeUI?.color??"#007ACC"),c=b(()=>e.vertexUI?.color??"#007ACC"),y=b(()=>e.resizeUI?.size??12),g=b(()=>e.vertexUI?.size??12),x=b(()=>eo({controller:{element:t(u).rect,vertices:e.vertexConfig?.extractVertices(t(u)),constraints:{minWidth:10,minHeight:10,boundingBox:{width:e.pageWidth/e.scale,height:e.pageHeight/e.scale}},maintainAspectRatio:n(),pageRotation:e.rotation,scale:e.scale,enabled:e.isSelected,onUpdate:T=>{if(!T.transformData?.type)return;T.state==="start"&&te(m,t(u),!0);const N=T.transformData.type,Y=t(m)??t(u),V=T.transformData.changes.vertices?e.vertexConfig?.transformAnnotation(Y,T.transformData.changes.vertices):{rect:T.transformData.changes.rect},H=h.provides.transformAnnotation(Y,{type:N,changes:V,metadata:T.transformData.metadata});H&&te(d,{...t(d),...H},!0),T.state==="end"&&H&&(te(m,null),h.provides.updateAnnotation(e.pageIndex,e.trackedAnnotation.object.id,H))}},resizeUI:{handleSize:t(y),spacing:s(),offsetMode:"outside",includeSides:!n(),zIndex:r()+1},vertexUI:{vertexSize:t(g),zIndex:r()+2},includeVertices:!!e.vertexConfig}));var f=ro(),k=B(f);Pe(k,T=>({...e.isDraggable&&e.isSelected?t(x).dragProps:{},class:i(),...v,[He]:T}),[()=>({position:"absolute",left:`${t(u).rect.origin.x*e.scale}px`,top:`${t(u).rect.origin.y*e.scale}px`,width:`${t(u).rect.size.width*e.scale}px`,height:`${t(u).rect.size.height*e.scale}px`,outline:e.isSelected?`1px solid ${a()}`:"none","outline-offset":e.isSelected?`${s()}px`:"0px","pointer-events":e.isSelected?"auto":"none","touch-action":"none",cursor:e.isSelected&&e.isDraggable?"move":"default","z-index":r()})]);var w=B(k);{var p=T=>{var N=R(),Y=z(N);ht(Y,()=>e.customAnnotationRenderer??he,()=>({annotation:t(u),children:e.children,isSelected:e.isSelected,scale:e.scale,rotation:e.rotation,pageWidth:e.pageWidth,pageHeight:e.pageHeight,pageIndex:e.pageIndex,onSelect:e.onSelect})),A(T,N)},C=T=>{var N=R(),Y=z(N);ht(Y,()=>e.children,()=>t(u)),A(T,N)};M(w,T=>{e.customAnnotationRenderer?T(p):T(C,!1)})}var S=se(w,2);{var I=T=>{var N=R(),Y=z(N);pe(Y,17,()=>t(x).resize,({key:V,...H})=>V,(V,H)=>{let X=()=>Nt(t(H),["key"]);var Q=R(),q=z(Q);{var re=U=>{const K=b(()=>e.resizeUI.component);var ie=R(),we=z(ie);Ht(we,()=>t(K),(ae,de)=>{de(ae,F(X,{get backgroundColor(){return t(l)}}))}),A(U,ie)},ne=U=>{var K=oo();Pe(K,ie=>({...X(),[He]:ie}),[()=>({"background-color":t(l)})]),A(U,K)};M(q,U=>{e.resizeUI?.component?U(re):U(ne,!1)})}A(V,Q)}),A(T,N)};M(S,T=>{e.isSelected&&e.isResizable&&T(I)})}var E=se(S,2);{var D=T=>{var N=R(),Y=z(N);pe(Y,17,()=>t(x).vertices,({key:V,...H})=>V,(V,H)=>{let X=()=>Nt(t(H),["key"]);var Q=R(),q=z(Q);{var re=U=>{const K=b(()=>e.vertexUI.component);var ie=R(),we=z(ie);Ht(we,()=>t(K),(ae,de)=>{de(ae,F(X,{get backgroundColor(){return t(c)}}))}),A(U,ie)},ne=U=>{var K=so();Pe(K,ie=>({...X(),[He]:ie}),[()=>({"background-color":t(c)})]),A(U,K)};M(q,U=>{e.vertexUI?.component?U(re):U(ne,!1)})}A(V,Q)}),A(T,N)};M(E,T=>{e.isSelected&&T(D)})}W(k),Hn(k,(T,N)=>to?.(T,N),()=>({onDouble:e.onDoubleClick}));var ee=se(k,2);{const T=(Y,V)=>{let H=()=>V?.().rect,X=()=>V?.().menuWrapperProps;var Q=R(),q=z(Q);{var re=ne=>{var U=R(),K=z(U);ht(K,()=>e.selectionMenu,()=>({annotation:e.trackedAnnotation,selected:e.isSelected,rect:H(),menuWrapperProps:X()})),A(ne,U)};M(q,ne=>{e.selectionMenu&&ne(re)})}A(Y,Q)};let N=b(()=>({origin:{x:t(u).rect.origin.x*e.scale,y:t(u).rect.origin.y*e.scale},size:{width:t(u).rect.size.width*e.scale,height:t(u).rect.size.height*e.scale}}));no(ee,{get rect(){return t(N)},get rotation(){return e.rotation},children:T,$$slots:{default:!0}})}W(f),A(o,f),$()}var ao=G("<div></div>");function un(o,e){J(e,!0);let n=L(e,"color",3,"#FFFF00"),i=L(e,"opacity",3,.5);var s=R(),r=z(s);pe(r,17,()=>e.segmentRects,dt,(a,v)=>{var d=ao();Pe(d,(h,m)=>({role:"button",tabindex:e.onClick?0:-1,onpointerdown:e.onClick,ontouchstart:e.onClick,...h,[He]:m}),[()=>e.style?Object.fromEntries(Object.entries(e.style).map(([h,m])=>[`style:${h}`,m])):{},()=>({position:"absolute",left:`${(e.rect?t(v).origin.x-e.rect.origin.x:t(v).origin.x)*e.scale}px`,top:`${(e.rect?t(v).origin.y-e.rect.origin.y:t(v).origin.y)*e.scale}px`,width:`${t(v).size.width*e.scale}px`,height:`${t(v).size.height*e.scale}px`,background:n(),opacity:i(),"pointer-events":e.onClick?"auto":"none",cursor:e.onClick?"pointer":"default","z-index":e.onClick?1:void 0})]),A(a,d)}),A(o,s),$()}var co=G("<div><div></div></div>");function gn(o,e){J(e,!0);let n=L(e,"color",3,"#FFFF00"),i=L(e,"opacity",3,.5);const s=b(()=>2*e.scale);var r=R(),a=z(r);pe(a,17,()=>e.segmentRects,dt,(v,d)=>{var h=co();Pe(h,(l,c)=>({role:"button",tabindex:e.onClick?0:-1,onpointerdown:e.onClick,ontouchstart:e.onClick,...l,[He]:c}),[()=>e.style?Object.fromEntries(Object.entries(e.style).map(([l,c])=>[`style:${l}`,c])):{},()=>({position:"absolute",left:`${(e.rect?t(d).origin.x-e.rect.origin.x:t(d).origin.x)*e.scale}px`,top:`${(e.rect?t(d).origin.y-e.rect.origin.y:t(d).origin.y)*e.scale}px`,width:`${t(d).size.width*e.scale}px`,height:`${t(d).size.height*e.scale}px`,background:"transparent","pointer-events":e.onClick?"auto":"none",cursor:e.onClick?"pointer":"default","z-index":e.onClick?1:0})]);var m=B(h);let u;W(h),j(l=>u=O(m,"",u,l),[()=>({position:"absolute",left:"0",bottom:"0",width:"100%",height:`${t(s)??""}px`,background:n(),opacity:i(),"pointer-events":"none"})]),A(v,h)}),A(o,r),$()}var lo=G("<div><div></div></div>");function fn(o,e){J(e,!0);let n=L(e,"color",3,"#FFFF00"),i=L(e,"opacity",3,.5);const s=b(()=>2*e.scale);var r=R(),a=z(r);pe(a,17,()=>e.segmentRects,dt,(v,d)=>{var h=lo();Pe(h,(l,c)=>({role:"button",tabindex:e.onClick?0:-1,onpointerdown:e.onClick,ontouchstart:e.onClick,...l,[He]:c}),[()=>e.style?Object.fromEntries(Object.entries(e.style).map(([l,c])=>[`style:${l}`,c])):{},()=>({position:"absolute",left:`${(e.rect?t(d).origin.x-e.rect.origin.x:t(d).origin.x)*e.scale}px`,top:`${(e.rect?t(d).origin.y-e.rect.origin.y:t(d).origin.y)*e.scale}px`,width:`${t(d).size.width*e.scale}px`,height:`${t(d).size.height*e.scale}px`,background:"transparent","pointer-events":e.onClick?"auto":"none",cursor:e.onClick?"pointer":"default","z-index":e.onClick?1:0})]);var m=B(h);let u;W(h),j(l=>u=O(m,"",u,l),[()=>({position:"absolute",left:"0",top:"50%",width:"100%",height:`${t(s)??""}px`,background:n(),opacity:i(),transform:"translateY(-50%)","pointer-events":"none"})]),A(v,h)}),A(o,r),$()}var ho=G("<div><div></div></div>");function vn(o,e){J(e,!0);let n=L(e,"color",3,"#FFFF00"),i=L(e,"opacity",3,.5);const s=b(()=>2*e.scale),r=b(()=>6*e.scale),a=b(()=>`<svg xmlns="http://www.w3.org/2000/svg" width="${t(r)}" height="${t(s)*2}" viewBox="0 0 ${t(r)} ${t(s)*2}">
      <path d="M0 ${t(s)} Q ${t(r)/4} 0 ${t(r)/2} ${t(s)} T ${t(r)} ${t(s)}"
            fill="none" stroke="${n()}" stroke-width="${t(s)}" stroke-linecap="round"/>
    </svg>`),v=b(()=>`url("data:image/svg+xml;utf8,${encodeURIComponent(t(a))}")`);var d=R(),h=z(d);pe(h,17,()=>e.segmentRects,dt,(m,u)=>{var l=ho();Pe(l,(g,x)=>({role:"button",tabindex:e.onClick?0:-1,onpointerdown:e.onClick,ontouchstart:e.onClick,...g,[He]:x}),[()=>e.style?Object.fromEntries(Object.entries(e.style).map(([g,x])=>[`style:${g}`,x])):{},()=>({position:"absolute",left:`${(e.rect?t(u).origin.x-e.rect.origin.x:t(u).origin.x)*e.scale}px`,top:`${(e.rect?t(u).origin.y-e.rect.origin.y:t(u).origin.y)*e.scale}px`,width:`${t(u).size.width*e.scale}px`,height:`${t(u).size.height*e.scale}px`,background:"transparent","pointer-events":e.onClick?"auto":"none",cursor:e.onClick?"pointer":"default","z-index":e.onClick?1:0})]);var c=B(l);let y;W(l),j(g=>y=O(c,"",y,g),[()=>({position:"absolute",left:"0",bottom:"0",width:"100%",height:`${t(s)*2}px`,"background-image":t(v),"background-repeat":"repeat-x","background-size":`${t(r)??""}px ${t(s)*2}px`,opacity:i(),"pointer-events":"none"})]),A(m,l)}),A(o,d),$()}var uo=fe('<path fill="none"></path>'),go=fe("<svg></svg>");function mn(o,e){J(e,!0);let n=L(e,"color",3,"#000000"),i=L(e,"opacity",3,1);const s=b(()=>e.inkList.map(({points:h})=>{let m="";for(let u=0;u<h.length;u++){const{x:l,y:c}=h[u],y=l-e.rect.origin.x,g=c-e.rect.origin.y;m+=(u===0?"M":"L")+y+" "+g+" "}return m.trim()})),r=b(()=>e.rect.size.width*e.scale),a=b(()=>e.rect.size.height*e.scale);var v=go();let d;pe(v,21,()=>t(s),dt,(h,m)=>{var u=uo();u.__pointerdown=function(...c){e.onClick?.apply(this,c)},u.__touchstart=function(...c){e.onClick?.apply(this,c)};let l;j(c=>{_(u,"d",t(m)),_(u,"opacity",i()),l=O(u,"",l,c)},[()=>({cursor:e.isSelected?"move":"pointer","pointer-events":e.isSelected?"none":"visibleStroke",stroke:n(),"stroke-width":e.strokeWidth,"stroke-linecap":"round","stroke-linejoin":"round"})]),A(h,u)}),W(v),j(h=>{d=O(v,"position: absolute; z-index: 2; overflow: visible; pointer-events: none;",d,h),_(v,"width",t(r)),_(v,"height",t(a)),_(v,"viewBox",`0 0 ${e.rect.size.width} ${e.rect.size.height}`)},[()=>({width:`${t(r)}px`,height:`${t(a)}px`})]),A(o,v),$()}Ae(["pointerdown","touchstart"]);var fo=fe("<svg><rect></rect></svg>");function yn(o,e){J(e,!0);let n=L(e,"color",3,"#000000"),i=L(e,"opacity",3,1),s=L(e,"strokeStyle",19,()=>le.SOLID);const r=b(()=>{const f=e.rect.size.width,k=e.rect.size.height,w=Math.max(f-e.strokeWidth,0),p=Math.max(k-e.strokeWidth,0);return{width:w,height:p,x:e.strokeWidth/2,y:e.strokeWidth/2}}),a=b(()=>t(r).width),v=b(()=>t(r).height),d=b(()=>t(r).x),h=b(()=>t(r).y),m=b(()=>(t(a)+e.strokeWidth)*e.scale),u=b(()=>(t(v)+e.strokeWidth)*e.scale),l=b(()=>s()===le.DASHED?e.strokeDashArray?.join(","):void 0);var c=fo();let y;var g=B(c);g.__pointerdown=function(...f){e.onClick?.apply(this,f)},g.__touchstart=function(...f){e.onClick?.apply(this,f)};let x;W(c),j((f,k)=>{y=O(c,"position: absolute; pointer-events: none; z-index: 2;",y,f),_(c,"width",t(m)),_(c,"height",t(u)),_(c,"viewBox",`0 0 ${t(a)+e.strokeWidth} ${t(v)+e.strokeWidth}`),_(g,"x",t(d)),_(g,"y",t(h)),_(g,"width",t(a)),_(g,"height",t(v)),_(g,"fill",n()),_(g,"opacity",i()),x=O(g,"",x,k)},[()=>({width:`${t(m)}px`,height:`${t(u)}px`}),()=>({cursor:e.isSelected?"move":"pointer","pointer-events":e.isSelected?"none":n()==="transparent"?"visibleStroke":"visible",stroke:e.strokeColor??n(),"stroke-width":e.strokeWidth,"stroke-dasharray":t(l)})]),A(o,c),$()}Ae(["pointerdown","touchstart"]);var vo=(o,e)=>e.onClick?.(o),mo=(o,e)=>e.onClick?.(o),yo=fe("<svg><ellipse></ellipse></svg>");function xn(o,e){J(e,!0);let n=L(e,"color",3,"#000000"),i=L(e,"opacity",3,1),s=L(e,"strokeStyle",19,()=>le.SOLID);const r=b(()=>{const w=e.rect.size.width,p=e.rect.size.height,C=Math.max(w-e.strokeWidth,0),S=Math.max(p-e.strokeWidth,0);return{width:w,height:p,cx:e.strokeWidth/2+C/2,cy:e.strokeWidth/2+S/2,rx:C/2,ry:S/2}}),a=b(()=>t(r).width),v=b(()=>t(r).height),d=b(()=>t(r).cx),h=b(()=>t(r).cy),m=b(()=>t(r).rx),u=b(()=>t(r).ry);let l=b(()=>t(a)*e.scale),c=b(()=>t(v)*e.scale),y=b(()=>e.isSelected?"none":n()==="transparent"?"visibleStroke":"visible");var g=yo();let x;var f=B(g);f.__pointerdown=[vo,e],f.__touchstart=[mo,e];let k;W(g),j((w,p,C)=>{_(g,"svgWidth",t(l)),_(g,"svgHeight",t(c)),_(g,"viewBox",`0 0 ${t(a)} ${t(v)}`),x=O(g,"",x,w),_(f,"cx",t(d)),_(f,"cy",t(h)),_(f,"rx",t(m)),_(f,"ry",t(u)),_(f,"fill",n()),_(f,"opacity",i()),_(f,"pointer-events",t(y)),_(f,"stroke",e.strokeColor??n()),_(f,"stroke-width",e.strokeWidth),_(f,"stroke-dasharray",p),k=O(f,"",k,C)},[()=>({position:"absolute",width:`${t(l)}px`,height:`${t(c)}px`,"pointer-events":"none","z-index":"2"}),()=>s()===le.DASHED?e.strokeDashArray?.join(","):void 0,()=>({cursor:e.isSelected?"move":"pointer"})]),A(o,g),$()}Ae(["pointerdown","touchstart"]);var xo=fe("<path></path>"),bo=fe("<path></path>"),ko=fe("<svg><line></line><!><!></svg>");function bn(o,e){J(e,!0);let n=L(e,"color",3,"transparent"),i=L(e,"opacity",3,1),s=L(e,"strokeColor",3,"#000000"),r=L(e,"strokeStyle",19,()=>le.SOLID);const a=b(()=>e.linePoints.start.x-e.rect.origin.x),v=b(()=>e.linePoints.start.y-e.rect.origin.y),d=b(()=>e.linePoints.end.x-e.rect.origin.x),h=b(()=>e.linePoints.end.y-e.rect.origin.y),m=b(()=>{const S=Math.atan2(t(h)-t(v),t(d)-t(a));return{start:gt.createEnding(e.lineEndings?.start,e.strokeWidth,S+Math.PI,t(a),t(v)),end:gt.createEnding(e.lineEndings?.end,e.strokeWidth,S,t(d),t(h))}}),u=b(()=>e.rect.size.width*e.scale),l=b(()=>e.rect.size.height*e.scale),c=b(()=>r()===le.DASHED?e.strokeDashArray?.join(","):void 0);var y=ko();let g;var x=B(y);x.__pointerdown=function(...S){e.onClick?.apply(this,S)},x.__touchstart=function(...S){e.onClick?.apply(this,S)};let f;var k=se(x);{var w=S=>{var I=xo();I.__pointerdown=function(...D){e.onClick?.apply(this,D)},I.__touchstart=function(...D){e.onClick?.apply(this,D)};let E;j(D=>{_(I,"d",t(m).start.d),_(I,"transform",t(m).start.transform),_(I,"stroke",s()),_(I,"fill",t(m).start.filled?n():"none"),E=O(I,"",E,D)},[()=>({cursor:e.isSelected?"move":"pointer","stroke-width":e.strokeWidth,"stroke-linecap":"butt","pointer-events":e.isSelected?"none":t(m).start.filled?"visible":"visibleStroke","stroke-dasharray":t(c)})]),A(S,I)};M(k,S=>{t(m).start&&S(w)})}var p=se(k);{var C=S=>{var I=bo();I.__pointerdown=function(...D){e.onClick?.apply(this,D)},I.__touchstart=function(...D){e.onClick?.apply(this,D)};let E;j(D=>{_(I,"d",t(m).end.d),_(I,"transform",t(m).end.transform),_(I,"stroke",s()),_(I,"fill",t(m).end.filled?n():"none"),E=O(I,"",E,D)},[()=>({cursor:e.isSelected?"move":"pointer","stroke-width":e.strokeWidth,"stroke-linecap":"butt","pointer-events":e.isSelected?"none":t(m).end.filled?"visible":"visibleStroke","stroke-dasharray":t(c)})]),A(S,I)};M(p,S=>{t(m).end&&S(C)})}W(y),j((S,I)=>{g=O(y,"position: absolute; z-index: 2; overflow: visible; pointer-events: none;",g,S),_(y,"width",t(u)),_(y,"height",t(l)),_(y,"viewBox",`0 0 ${e.rect.size.width} ${e.rect.size.height}`),_(x,"x1",t(a)),_(x,"y1",t(v)),_(x,"x2",t(d)),_(x,"y2",t(h)),_(x,"opacity",i()),f=O(x,"",f,I)},[()=>({width:`${t(u)}px`,height:`${t(l)}px`}),()=>({cursor:e.isSelected?"move":"pointer","pointer-events":e.isSelected?"none":"visibleStroke",stroke:s(),"stroke-width":e.strokeWidth,"stroke-linecap":"butt","stroke-dasharray":t(c)})]),A(o,y),$()}Ae(["pointerdown","touchstart"]);var po=fe("<path></path>"),wo=fe("<path></path>"),Po=fe("<svg><path></path><!><!></svg>");function kn(o,e){J(e,!0);let n=L(e,"color",3,"transparent"),i=L(e,"strokeColor",3,"#000000"),s=L(e,"opacity",3,1);const r=b(()=>e.vertices.map(({x:k,y:w})=>({x:k-e.rect.origin.x,y:w-e.rect.origin.y}))),a=b(()=>{if(!t(r).length)return"";const[k,...w]=t(r);return`M ${k.x} ${k.y} `+w.map(p=>`L ${p.x} ${p.y} `).join("").trim()}),v=b(()=>{if(t(r).length<2)return{start:null,end:null};const k=(I,E)=>Math.atan2(E.y-I.y,E.x-I.x),w=k(t(r)[0],t(r)[1]),p=k(t(r)[t(r).length-2],t(r)[t(r).length-1]),C=gt.createEnding(e.lineEndings?.start,e.strokeWidth,w+Math.PI,t(r)[0].x,t(r)[0].y),S=gt.createEnding(e.lineEndings?.end,e.strokeWidth,p,t(r)[t(r).length-1].x,t(r)[t(r).length-1].y);return{start:C,end:S}}),d=b(()=>e.rect.size.width*e.scale),h=b(()=>e.rect.size.height*e.scale);var m=Po();let u;var l=B(m);l.__pointerdown=function(...k){e.onClick?.apply(this,k)},l.__touchstart=function(...k){e.onClick?.apply(this,k)};let c;var y=se(l);{var g=k=>{var w=po();w.__pointerdown=function(...C){e.onClick?.apply(this,C)},w.__touchstart=function(...C){e.onClick?.apply(this,C)};let p;j(C=>{_(w,"d",t(v).start.d),_(w,"transform",t(v).start.transform),_(w,"stroke",i()),_(w,"fill",t(v).start.filled?n():"none"),p=O(w,"",p,C)},[()=>({cursor:e.isSelected?"move":"pointer","stroke-width":e.strokeWidth,"pointer-events":e.isSelected?"none":t(v).start.filled?"visible":"visibleStroke","stroke-linecap":"butt"})]),A(k,w)};M(y,k=>{t(v).start&&k(g)})}var x=se(y);{var f=k=>{var w=wo();w.__pointerdown=function(...C){e.onClick?.apply(this,C)},w.__touchstart=function(...C){e.onClick?.apply(this,C)};let p;j(C=>{_(w,"d",t(v).end.d),_(w,"transform",t(v).end.transform),_(w,"stroke",i()),_(w,"fill",t(v).end.filled?n():"none"),p=O(w,"",p,C)},[()=>({cursor:e.isSelected?"move":"pointer","stroke-width":e.strokeWidth,"pointer-events":e.isSelected?"none":t(v).end.filled?"visible":"visibleStroke","stroke-linecap":"butt"})]),A(k,w)};M(x,k=>{t(v).end&&k(f)})}W(m),j((k,w)=>{u=O(m,"position: absolute; width: var(--w); height: var(--h); pointer-events: none; z-index: 2; overflow: visible;",u,k),_(m,"width",t(d)),_(m,"height",t(h)),_(m,"viewBox",`0 0 ${e.rect.size.width} ${e.rect.size.height}`),_(l,"d",t(a)),_(l,"opacity",s()),c=O(l,"",c,w)},[()=>({"--w":`${t(d)}px`,"--h":`${t(h)}px`}),()=>({fill:"none",stroke:i()??n(),"stroke-width":e.strokeWidth,cursor:e.isSelected?"move":"pointer","pointer-events":e.isSelected?"none":"visibleStroke","stroke-linecap":"butt","stroke-linejoin":"miter"})]),A(o,m),$()}Ae(["pointerdown","touchstart"]);var Ao=fe('<path fill="none"></path>'),So=fe("<rect></rect>"),Co=fe("<svg><path></path><!><!></svg>");function pn(o,e){J(e,!0);let n=L(e,"color",3,"transparent"),i=L(e,"strokeColor",3,"#000000"),s=L(e,"opacity",3,1),r=L(e,"strokeStyle",19,()=>le.SOLID),a=L(e,"handleSize",3,14);const v=b(()=>e.currentVertex?[...e.vertices,e.currentVertex]:e.vertices),d=b(()=>t(v).map(({x:S,y:I})=>({x:S-e.rect.origin.x,y:I-e.rect.origin.y}))),h=b(()=>{if(!t(d).length)return"";const[S,...I]=t(d),E=!!e.currentVertex;return(`M ${S.x} ${S.y} `+I.map(D=>`L ${D.x} ${D.y}`).join(" ")+(E?"":" Z")).trim()}),m=b(()=>!!e.currentVertex&&e.vertices.length>0),u=b(()=>e.rect.size.width*e.scale),l=b(()=>e.rect.size.height*e.scale),c=b(()=>r()===le.DASHED?e.strokeDashArray?.join(","):void 0);var y=Co();let g;var x=B(y);x.__pointerdown=function(...S){e.onClick?.apply(this,S)},x.__touchstart=function(...S){e.onClick?.apply(this,S)};let f;var k=se(x);{var w=S=>{var I=Ao();let E;j(D=>{_(I,"d",`M ${t(d)[t(d).length-1].x} ${t(d)[t(d).length-1].y} L ${t(d)[0].x} ${t(d)[0].y}`),E=O(I,"",E,D)},[()=>({stroke:i(),"stroke-width":e.strokeWidth,"stroke-dasharray":"4,4",opacity:.7})]),A(S,I)};M(k,S=>{t(m)&&e.vertices.length>1&&S(w)})}var p=se(k);{var C=S=>{var I=So();_(I,"opacity",.4),j(()=>{_(I,"x",t(d)[0].x-a()/e.scale/2),_(I,"y",t(d)[0].y-a()/e.scale/2),_(I,"width",a()/e.scale),_(I,"height",a()/e.scale),_(I,"fill",i()),_(I,"stroke",i()),_(I,"stroke-width",e.strokeWidth/2)}),A(S,I)};M(p,S=>{t(m)&&e.vertices.length>=2&&S(C)})}W(y),j((S,I)=>{g=O(y,"position: absolute; z-index: 2; overflow: visible; pointer-events: none;",g,S),_(y,"width",t(u)),_(y,"height",t(l)),_(y,"viewBox",`0 0 ${e.rect.size.width} ${e.rect.size.height}`),_(x,"d",t(h)),_(x,"opacity",s()),f=O(x,"",f,I)},[()=>({width:`${t(u)}px`,height:`${t(l)}px`}),()=>({fill:e.currentVertex?"none":n(),stroke:i()??n(),"stroke-width":e.strokeWidth,cursor:e.isSelected?"move":"pointer","pointer-events":e.isSelected?"none":n()==="transparent"?"visibleStroke":"visible","stroke-linecap":"butt","stroke-linejoin":"miter","stroke-dasharray":t(c)})]),A(o,y),$()}Ae(["pointerdown","touchstart"]);var Io=G('<div><span tabindex="-1"> </span></div>');function _o(o,e){J(e,!0);const n=qe();let i=null,s=oe(!1);be(()=>{if(!e.isEditing||!i)return;i.focus();const p=window.getSelection?.();if(!p)return;const C=document.createRange();C.selectNodeContents(i),C.collapse(!1),p.removeAllRanges(),p.addRange(C)}),Tn(()=>{try{const p=navigator,C=/iPad|iPhone|iPod/.test(navigator.userAgent)||navigator.platform==="MacIntel"&&p?.maxTouchPoints>1;te(s,C,!0)}catch{te(s,!1)}});function r(){!n.provides||!i||n.provides.updateAnnotation(e.pageIndex,e.annotation.object.id,{contents:i.innerText})}const a=b(()=>e.annotation.object.fontSize*e.scale),v=16,d=b(()=>t(s)&&e.isEditing&&t(a)>0&&t(a)<v),h=b(()=>t(d)?v:t(a)),m=b(()=>t(d)?t(a)/v:1),u=b(()=>t(d)?100/t(m):100),l=b(()=>e.annotation.object.rect.size.width*e.scale),c=b(()=>e.annotation.object.rect.size.height*e.scale),y=b(()=>e.annotation.object.verticalAlign===ut.Top?"flex-start":e.annotation.object.verticalAlign===ut.Middle?"center":"flex-end");var g=Io();g.__pointerdown=function(...p){e.onClick?.apply(this,p)},g.__touchstart=function(...p){e.onClick?.apply(this,p)};let x;var f=B(g);let k;var w=B(f,!0);W(f),Dt(f,p=>i=p,()=>i),W(g),j((p,C)=>{x=O(g,"",x,p),_(f,"contenteditable",e.isEditing),k=O(f,"",k,C),qt(w,e.annotation.object.contents)},[()=>({position:"absolute",width:`${t(l)}px`,height:`${t(c)}px`,"z-index":2,cursor:e.isSelected&&!e.isEditing?"move":"default","pointer-events":e.isSelected&&!e.isEditing?"none":"auto"}),()=>({display:"flex","flex-direction":"column","justify-content":t(y),color:e.annotation.object.fontColor,"font-size":`${t(h)}px`,"font-family":jn(e.annotation.object.fontFamily),"text-align":Un(e.annotation.object.textAlign),"background-color":e.annotation.object.backgroundColor,opacity:e.annotation.object.opacity,width:t(d)?`${t(u)}%`:"100%",height:t(d)?`${t(u)}%`:"100%","line-height":"1.18",overflow:"hidden",cursor:e.isEditing?"text":"pointer",outline:"none",transform:t(d)?`scale(${t(m)})`:void 0,"transform-origin":"top left"})]),zn("blur",f,r),A(o,g),$()}Ae(["pointerdown","touchstart"]);var To=G("<img/>");function zo(o,e){J(e,!0);let n=L(e,"scaleFactor",3,1),i=vt(e,["$$slots","$$events","$$legacy","pageIndex","annotation","scaleFactor","style"]);const s=qe();let r=oe(null),a=null;const v=l=>JSON.parse(JSON.stringify(l));be(()=>{if(s.provides){const l=v(e.annotation),c=s.provides.renderAnnotation({pageIndex:e.pageIndex,annotation:l,options:{scaleFactor:n(),dpr:window.devicePixelRatio}});return c.wait(y=>{const g=URL.createObjectURL(y);te(r,g,!0),a=g},lt),()=>{a?(URL.revokeObjectURL(a),a=null):c.abort({code:Xe.Cancelled,message:"canceled render task"})}}});function d(){a&&(URL.revokeObjectURL(a),a=null)}var h=R(),m=z(h);{var u=l=>{var c=To();Pe(c,()=>({alt:"",src:t(r),onload:d,...i,style:e.style,[He]:{width:"100%",height:"100%",display:"block"}})),En(c),A(l,c)};M(m,l=>{t(r)&&l(u)})}A(o,h),$()}var Eo=G("<div><!></div>");function Ro(o,e){J(e,!0);let n=b(()=>({...e.annotation.object,id:e.annotation.object.id}));var i=Eo();let s;i.__pointerdown=function(...a){e.onClick?.apply(this,a)},i.__touchstart=function(...a){e.onClick?.apply(this,a)};var r=B(i);zo(r,{get pageIndex(){return e.pageIndex},get annotation(){return t(n)},get scaleFactor(){return e.scale}}),W(i),j(a=>s=O(i,"position: absolute; width: 100%; height: 100%; z-index: 2;",s,a),[()=>({"pointer-events":e.isSelected?"none":"auto",cursor:"pointer"})]),A(o,i),$()}Ae(["pointerdown","touchstart"]);function Do(o,e){J(e,!0);let n=vt(e,["$$slots","$$events","$$legacy"]);const{pageIndex:i,scale:s,selectionMenu:r}=n,a=qe(),v=Qt(),d=Ln({pageIndex:i});let h=oe(ft([])),m=oe(null),u=oe(null);be(()=>{if(!a.provides)return;const x=a.provides.onStateChange(f=>{te(h,wi(f,i),!0),te(m,Ai(f,i),!0)});return()=>x?.()});const l={onPointerDown:(x,f)=>{f.target===f.currentTarget&&a.provides&&(a.provides.deselectAnnotation(),te(u,null))}};be(()=>d.register(l));function c(x,f){x.stopPropagation(),a.provides&&v.provides&&(a.provides.selectAnnotation(i,f.object.id),v.provides.clear(),f.object.id!==t(u)&&te(u,null))}var y=R(),g=z(y);pe(g,17,()=>t(h),x=>x.object.id,(x,f)=>{const k=b(()=>t(m)?.object.id===t(f).object.id),w=b(()=>t(u)===t(f).object.id),p=b(()=>a.provides?.findToolForAnnotation(t(f).object)),C=b(()=>Qe(t(f).object.blendMode??Ye.Normal));var S=R(),I=z(S);{var E=ee=>{{const T=(X,Q=he)=>{mn(X,F(Q,{get isSelected(){return t(k)},get scale(){return s},onClick:q=>c(q,t(f))}))};let N=b(()=>t(p)?.interaction.isDraggable??!0),Y=b(()=>t(p)?.interaction.isResizable??!0),V=b(()=>t(p)?.interaction.lockAspectRatio??!1),H=b(()=>({mixBlendMode:t(C)}));ye(ee,F({get trackedAnnotation(){return t(f)},get isSelected(){return t(k)},get isDraggable(){return t(N)},get isResizable(){return t(Y)},get lockAspectRatio(){return t(V)},get selectionMenu(){return r},onSelect:X=>c(X,t(f)),get style(){return t(H)}},()=>n,{children:T,$$slots:{default:!0}}))}},D=ee=>{var T=R(),N=z(T);{var Y=H=>{{const X=(U,K=he)=>{yn(U,F(K,{get isSelected(){return t(k)},get scale(){return s},onClick:ie=>c(ie,t(f))}))};let Q=b(()=>t(p)?.interaction.isDraggable??!0),q=b(()=>t(p)?.interaction.isResizable??!0),re=b(()=>t(p)?.interaction.lockAspectRatio??!1),ne=b(()=>({mixBlendMode:t(C)}));ye(H,F({get trackedAnnotation(){return t(f)},get isSelected(){return t(k)},get isDraggable(){return t(Q)},get isResizable(){return t(q)},get lockAspectRatio(){return t(re)},get selectionMenu(){return r},onSelect:U=>c(U,t(f)),get style(){return t(ne)}},()=>n,{children:X,$$slots:{default:!0}}))}},V=H=>{var X=R(),Q=z(X);{var q=ne=>{{const U=(de,Fe=he)=>{xn(de,F(Fe,{get isSelected(){return t(k)},get scale(){return s},onClick:Ke=>c(Ke,t(f))}))};let K=b(()=>t(p)?.interaction.isDraggable??!0),ie=b(()=>t(p)?.interaction.isResizable??!0),we=b(()=>t(p)?.interaction.lockAspectRatio??!1),ae=b(()=>({mixBlendMode:t(C)}));ye(ne,F({get trackedAnnotation(){return t(f)},get isSelected(){return t(k)},get isDraggable(){return t(K)},get isResizable(){return t(ie)},get lockAspectRatio(){return t(we)},get selectionMenu(){return r},onSelect:de=>c(de,t(f)),get style(){return t(ae)}},()=>n,{children:U,$$slots:{default:!0}}))}},re=ne=>{var U=R(),K=z(U);{var ie=ae=>{{const de=(Ce,Ze=he)=>{gn(Ce,F(Ze,{get scale(){return s},onClick:Je=>c(Je,t(f))}))};let Fe=b(()=>t(p)?.interaction.isDraggable??!1),Ke=b(()=>t(p)?.interaction.isResizable??!1),yt=b(()=>t(p)?.interaction.lockAspectRatio??!1),Se=b(()=>({mixBlendMode:t(C)}));ye(ae,F({get trackedAnnotation(){return t(f)},get isSelected(){return t(k)},get isDraggable(){return t(Fe)},get isResizable(){return t(Ke)},get lockAspectRatio(){return t(yt)},get selectionMenu(){return r},onSelect:Ce=>c(Ce,t(f)),zIndex:0,get style(){return t(Se)}},()=>n,{children:de,$$slots:{default:!0}}))}},we=ae=>{var de=R(),Fe=z(de);{var Ke=Se=>{{const Ce=(_e,$e=he)=>{fn(_e,F($e,{get scale(){return s},onClick:et=>c(et,t(f))}))};let Ze=b(()=>t(p)?.interaction.isDraggable??!1),Je=b(()=>t(p)?.interaction.isResizable??!1),xt=b(()=>t(p)?.interaction.lockAspectRatio??!1),Ie=b(()=>({mixBlendMode:t(C)}));ye(Se,F({get trackedAnnotation(){return t(f)},get isSelected(){return t(k)},get isDraggable(){return t(Ze)},get isResizable(){return t(Je)},get lockAspectRatio(){return t(xt)},get selectionMenu(){return r},onSelect:_e=>c(_e,t(f)),zIndex:0,get style(){return t(Ie)}},()=>n,{children:Ce,$$slots:{default:!0}}))}},yt=Se=>{var Ce=R(),Ze=z(Ce);{var Je=Ie=>{{const _e=(ze,tt=he)=>{vn(ze,F(tt,{get scale(){return s},onClick:nt=>c(nt,t(f))}))};let $e=b(()=>t(p)?.interaction.isDraggable??!1),et=b(()=>t(p)?.interaction.isResizable??!1),bt=b(()=>t(p)?.interaction.lockAspectRatio??!1),Te=b(()=>({mixBlendMode:t(C)}));ye(Ie,F({get trackedAnnotation(){return t(f)},get isSelected(){return t(k)},get isDraggable(){return t($e)},get isResizable(){return t(et)},get lockAspectRatio(){return t(bt)},get selectionMenu(){return r},onSelect:ze=>c(ze,t(f)),zIndex:0,get style(){return t(Te)}},()=>n,{children:_e,$$slots:{default:!0}}))}},xt=Ie=>{var _e=R(),$e=z(_e);{var et=Te=>{{const ze=(Re,it=he)=>{un(Re,F(it,{get scale(){return s},onClick:ot=>c(ot,t(f))}))};let tt=b(()=>t(p)?.interaction.isDraggable??!1),nt=b(()=>t(p)?.interaction.isResizable??!1),kt=b(()=>t(p)?.interaction.lockAspectRatio??!1),Ee=b(()=>({mixBlendMode:Qe(t(f).object.blendMode??Ye.Multiply)}));ye(Te,F({get trackedAnnotation(){return t(f)},get isSelected(){return t(k)},get isDraggable(){return t(tt)},get isResizable(){return t(nt)},get lockAspectRatio(){return t(kt)},onSelect:Re=>c(Re,t(f)),zIndex:0,get selectionMenu(){return r},get style(){return t(Ee)}},()=>n,{children:ze,$$slots:{default:!0}}))}},bt=Te=>{var ze=R(),tt=z(ze);{var nt=Ee=>{{const Re=(ue,Me=he)=>{bn(ue,F(Me,{get isSelected(){return t(k)},get scale(){return s},onClick:st=>c(st,t(f))}))};let it=b(()=>t(p)?.interaction.isDraggable??!0),ot=b(()=>t(p)?.interaction.isResizable??!1),pt=b(()=>t(p)?.interaction.lockAspectRatio??!1),De=b(()=>({mixBlendMode:t(C)}));ye(Ee,F({get trackedAnnotation(){return t(f)},get isSelected(){return t(k)},get isDraggable(){return t(it)},get isResizable(){return t(ot)},get lockAspectRatio(){return t(pt)},get selectionMenu(){return r},onSelect:ue=>c(ue,t(f)),vertexConfig:{extractVertices:ue=>[ue.linePoints.start,ue.linePoints.end],transformAnnotation:(ue,Me)=>({...ue,linePoints:{start:Me[0],end:Me[1]}})},get style(){return t(De)}},()=>n,{children:Re,$$slots:{default:!0}}))}},kt=Ee=>{var Re=R(),it=z(Re);{var ot=De=>{{const ue=(ve,We=he)=>{kn(ve,F(We,{get isSelected(){return t(k)},get scale(){return s},onClick:rt=>c(rt,t(f))}))};let Me=b(()=>t(p)?.interaction.isDraggable??!0),st=b(()=>t(p)?.interaction.isResizable??!1),wt=b(()=>t(p)?.interaction.lockAspectRatio??!1),Oe=b(()=>({mixBlendMode:t(C)}));ye(De,F({get trackedAnnotation(){return t(f)},get selectionMenu(){return r},get isDraggable(){return t(Me)},get isResizable(){return t(st)},get lockAspectRatio(){return t(wt)},get isSelected(){return t(k)},onSelect:ve=>c(ve,t(f)),vertexConfig:{extractVertices:ve=>ve.vertices,transformAnnotation:(ve,We)=>({...ve,vertices:We})},get style(){return t(Oe)}},()=>n,{children:ue,$$slots:{default:!0}}))}},pt=De=>{var ue=R(),Me=z(ue);{var st=Oe=>{{const ve=(me,Ve=he)=>{pn(me,F(Ve,{get isSelected(){return t(k)},get scale(){return s},onClick:at=>c(at,t(f))}))};let We=b(()=>t(p)?.interaction.isDraggable??!0),rt=b(()=>t(p)?.interaction.isResizable??!1),Pt=b(()=>t(p)?.interaction.lockAspectRatio??!1),Le=b(()=>({mixBlendMode:t(C)}));ye(Oe,F({get trackedAnnotation(){return t(f)},get isSelected(){return t(k)},get isDraggable(){return t(We)},get isResizable(){return t(rt)},get lockAspectRatio(){return t(Pt)},get selectionMenu(){return r},onSelect:me=>c(me,t(f)),vertexConfig:{extractVertices:me=>me.vertices,transformAnnotation:(me,Ve)=>({...me,vertices:Ve})},get style(){return t(Le)}},()=>n,{children:ve,$$slots:{default:!0}}))}},wt=Oe=>{var ve=R(),We=z(ve);{var rt=Le=>{{const me=(Be,St=he)=>{{let Ct=b(()=>({...t(f),object:St()}));_o(Be,{get isSelected(){return t(k)},get isEditing(){return t(w)},get annotation(){return t(Ct)},get pageIndex(){return i},get scale(){return s},onClick:It=>c(It,t(f))})}};let Ve=b(()=>(t(p)?.interaction.isDraggable??!0)&&!t(w)),at=b(()=>t(p)?.interaction.isResizable??!0),ct=b(()=>t(p)?.interaction.lockAspectRatio??!1),At=b(()=>({mixBlendMode:Qe(t(f).object.blendMode??Ye.Normal)}));ye(Le,F({get trackedAnnotation(){return t(f)},get isSelected(){return t(k)},get isDraggable(){return t(Ve)},get isResizable(){return t(at)},get lockAspectRatio(){return t(ct)},get selectionMenu(){return r},onSelect:Be=>c(Be,t(f)),get style(){return t(At)},onDoubleClick:Be=>{Be.stopPropagation(),te(u,t(f).object.id,!0)}},()=>n,{children:me,$$slots:{default:!0}}))}},Pt=Le=>{var me=R(),Ve=z(me);{var at=ct=>{{const At=(_t,ds=he)=>{Ro(_t,{get isSelected(){return t(k)},get annotation(){return t(f)},get pageIndex(){return i},get scale(){return s},onClick:Cn=>c(Cn,t(f))})};let Be=b(()=>t(p)?.interaction.isDraggable??!0),St=b(()=>t(p)?.interaction.isResizable??!0),Ct=b(()=>t(p)?.interaction.lockAspectRatio??!1),It=b(()=>({mixBlendMode:t(C)}));ye(ct,F({get trackedAnnotation(){return t(f)},get isSelected(){return t(k)},get isDraggable(){return t(Be)},get isResizable(){return t(St)},get lockAspectRatio(){return t(Ct)},get selectionMenu(){return r},onSelect:_t=>c(_t,t(f)),get style(){return t(It)}},()=>n,{children:At,$$slots:{default:!0}}))}};M(Ve,ct=>{pi(t(f))&&ct(at)},!0)}A(Le,me)};M(We,Le=>{ki(t(f))?Le(rt):Le(Pt,!1)},!0)}A(Oe,ve)};M(Me,Oe=>{ui(t(f))?Oe(st):Oe(wt,!1)},!0)}A(De,ue)};M(it,De=>{vi(t(f))?De(ot):De(pt,!1)},!0)}A(Ee,Re)};M(tt,Ee=>{fi(t(f))?Ee(nt):Ee(kt,!1)},!0)}A(Te,ze)};M($e,Te=>{mi(t(f))?Te(et):Te(bt,!1)},!0)}A(Ie,_e)};M(Ze,Ie=>{bi(t(f))?Ie(Je):Ie(xt,!1)},!0)}A(Se,Ce)};M(Fe,Se=>{xi(t(f))?Se(Ke):Se(yt,!1)},!0)}A(ae,de)};M(K,ae=>{yi(t(f))?ae(ie):ae(we,!1)},!0)}A(ne,U)};M(Q,ne=>{hi(t(f))?ne(q):ne(re,!1)},!0)}A(H,X)};M(N,H=>{gi(t(f))?H(Y):H(V,!1)},!0)}A(ee,T)};M(I,ee=>{di(t(f))?ee(E):ee(D,!1)})}A(x,S)}),A(o,y),$()}var Mo=G("<div><!></div>"),Oo=G("<div><!></div>"),Lo=G("<div><!></div>"),No=G("<div><!></div>");function Ho(o,e){J(e,!0);const n=Qt(),i=qe();let s=oe(ft([])),r=oe(null),a=oe(null);be(()=>n.provides?n.provides.onSelectionChange(()=>{te(s,n.provides.getHighlightRectsForPage(e.pageIndex),!0),te(r,n.provides.getBoundingRectForPage(e.pageIndex),!0)}):void 0),be(()=>i.provides?i.provides.onActiveToolChange(l=>{te(a,l,!0)}):void 0);const v=b(()=>t(a)?.defaults?.blendMode?Qe(t(a).defaults.blendMode):t(a)?.defaults?.type===P.HIGHLIGHT?Qe(Ye.Multiply):Qe(Ye.Normal));var d=R(),h=z(d);{var m=u=>{var l=R(),c=z(l);{var y=x=>{var f=Mo();let k;var w=B(f);{let p=b(()=>t(a).defaults?.color),C=b(()=>t(a).defaults?.opacity);gn(w,{get color(){return t(p)},get opacity(){return t(C)},get segmentRects(){return t(s)},get scale(){return e.scale}})}W(f),j(p=>k=O(f,"",k,p),[()=>({"mix-blend-mode":t(v),"pointer-events":"none",position:"absolute",inset:"0"})]),A(x,f)},g=x=>{var f=R(),k=z(f);{var w=C=>{var S=Oo();let I;var E=B(S);{let D=b(()=>t(a).defaults?.color),ee=b(()=>t(a).defaults?.opacity);un(E,{get color(){return t(D)},get opacity(){return t(ee)},get segmentRects(){return t(s)},get scale(){return e.scale}})}W(S),j(D=>I=O(S,"",I,D),[()=>({"mix-blend-mode":t(v),"pointer-events":"none",position:"absolute",inset:"0"})]),A(C,S)},p=C=>{var S=R(),I=z(S);{var E=ee=>{var T=Lo();let N;var Y=B(T);{let V=b(()=>t(a).defaults?.color),H=b(()=>t(a).defaults?.opacity);fn(Y,{get color(){return t(V)},get opacity(){return t(H)},get segmentRects(){return t(s)},get scale(){return e.scale}})}W(T),j(V=>N=O(T,"",N,V),[()=>({"mix-blend-mode":t(v),"pointer-events":"none",position:"absolute",inset:"0"})]),A(ee,T)},D=ee=>{var T=R(),N=z(T);{var Y=V=>{var H=No();let X;var Q=B(H);{let q=b(()=>t(a).defaults?.color),re=b(()=>t(a).defaults?.opacity);vn(Q,{get color(){return t(q)},get opacity(){return t(re)},get segmentRects(){return t(s)},get scale(){return e.scale}})}W(H),j(q=>X=O(H,"",X,q),[()=>({"mix-blend-mode":t(v),"pointer-events":"none",position:"absolute",inset:"0"})]),A(V,H)};M(N,V=>{t(a).defaults.type===P.SQUIGGLY&&V(Y)},!0)}A(ee,T)};M(I,ee=>{t(a).defaults.type===P.STRIKEOUT?ee(E):ee(D,!1)},!0)}A(C,S)};M(k,C=>{t(a).defaults.type===P.HIGHLIGHT?C(w):C(p,!1)},!0)}A(x,f)};M(c,x=>{t(a).defaults.type===P.UNDERLINE?x(y):x(g,!1)})}A(u,l)};M(h,u=>{t(r)&&t(a)&&t(a).defaults&&u(m)})}A(o,d),$()}var Uo=G("<div><!></div>"),jo=G("<div><!></div>"),Fo=G("<div><!></div>"),Wo=G("<div><!></div>"),Vo=G("<div><!></div>"),Bo=G("<div><!></div>"),Yo=G("<div><div></div></div>");function Go(o,e){J(e,!0);const n=b(()=>e.preview.bounds),i=b(()=>({left:t(n).origin.x*e.scale,top:t(n).origin.y*e.scale,width:t(n).size.width*e.scale,height:t(n).size.height*e.scale}));var s=R(),r=z(s);{var a=d=>{var h=Uo();let m;var u=B(h);xn(u,F({isSelected:!1,get scale(){return e.scale}},()=>e.preview.data)),W(h),j(l=>m=O(h,"",m,l),[()=>({position:"absolute",left:`${t(i).left??""}px`,top:`${t(i).top??""}px`,width:`${t(i).width??""}px`,height:`${t(i).height??""}px`,"pointer-events":"none","z-index":"10"})]),A(d,h)},v=d=>{var h=R(),m=z(h);{var u=c=>{var y=jo();let g;var x=B(y);yn(x,F({isSelected:!1,get scale(){return e.scale}},()=>e.preview.data)),W(y),j(f=>g=O(y,"",g,f),[()=>({position:"absolute",left:`${t(i).left??""}px`,top:`${t(i).top??""}px`,width:`${t(i).width??""}px`,height:`${t(i).height??""}px`,"pointer-events":"none","z-index":"10"})]),A(c,y)},l=c=>{var y=R(),g=z(y);{var x=k=>{var w=Fo();let p;var C=B(w);pn(C,F({isSelected:!1,get scale(){return e.scale}},()=>e.preview.data)),W(w),j(S=>p=O(w,"",p,S),[()=>({position:"absolute",left:`${t(i).left??""}px`,top:`${t(i).top??""}px`,width:`${t(i).width??""}px`,height:`${t(i).height??""}px`,"pointer-events":"none","z-index":"10"})]),A(k,w)},f=k=>{var w=R(),p=z(w);{var C=I=>{var E=Wo();let D;var ee=B(E);kn(ee,F({isSelected:!1,get scale(){return e.scale}},()=>e.preview.data)),W(E),j(T=>D=O(E,"",D,T),[()=>({position:"absolute",left:`${t(i).left??""}px`,top:`${t(i).top??""}px`,width:`${t(i).width??""}px`,height:`${t(i).height??""}px`,"pointer-events":"none","z-index":"10"})]),A(I,E)},S=I=>{var E=R(),D=z(E);{var ee=N=>{var Y=Vo();let V;var H=B(Y);bn(H,F({isSelected:!1,get scale(){return e.scale}},()=>e.preview.data)),W(Y),j(X=>V=O(Y,"",V,X),[()=>({position:"absolute",left:`${t(i).left??""}px`,top:`${t(i).top??""}px`,width:`${t(i).width??""}px`,height:`${t(i).height??""}px`,"pointer-events":"none","z-index":"10"})]),A(N,Y)},T=N=>{var Y=R(),V=z(Y);{var H=Q=>{var q=Bo();let re;var ne=B(q);mn(ne,F({isSelected:!1,get scale(){return e.scale}},()=>e.preview.data)),W(q),j(U=>re=O(q,"",re,U),[()=>({position:"absolute",left:`${t(i).left??""}px`,top:`${t(i).top??""}px`,width:`${t(i).width??""}px`,height:`${t(i).height??""}px`,"pointer-events":"none","z-index":"10"})]),A(Q,q)},X=Q=>{var q=R(),re=z(q);{var ne=U=>{var K=Yo();let ie;var we=B(K);let ae;W(K),j((de,Fe)=>{ie=O(K,"",ie,de),ae=O(we,"",ae,Fe)},[()=>({position:"absolute",left:`${t(i).left??""}px`,top:`${t(i).top??""}px`,width:`${t(i).width??""}px`,height:`${t(i).height??""}px`,"pointer-events":"none","z-index":"10"}),()=>({width:"100%",height:"100%",border:`1px dashed ${(e.preview.data.fontColor||"#000000")??""}`,"background-color":"transparent"})]),A(U,K)};M(re,U=>{e.preview.type===P.FREETEXT&&U(ne)},!0)}A(Q,q)};M(V,Q=>{e.preview.type===P.INK?Q(H):Q(X,!1)},!0)}A(N,Y)};M(D,N=>{e.preview.type===P.LINE?N(ee):N(T,!1)},!0)}A(I,E)};M(p,I=>{e.preview.type===P.POLYLINE?I(C):I(S,!1)},!0)}A(k,w)};M(g,k=>{e.preview.type===P.POLYGON?k(x):k(f,!1)},!0)}A(c,y)};M(m,c=>{e.preview.type===P.SQUARE?c(u):c(l,!1)},!0)}A(d,h)};M(r,d=>{e.preview.type===P.CIRCLE?d(a):d(v,!1)})}A(o,s),$()}var Xo=G('<input type="file"/> <canvas></canvas> <!>',1);function Qo(o,e){J(e,!0);const n=io();let i=oe(ft(new Map)),s=oe(null),r=oe(null);const a={requestFile:({accept:u,onFile:l})=>{if(!t(s))return;const c=t(s);c.accept=u,c.onchange=y=>{const g=y.target.files?.[0];g&&(l(g),c.value="")},c.click()},processImage:({source:u,maxWidth:l,maxHeight:c,onComplete:y})=>{const g=t(r);if(!g||!g.getContext)return;const x=g.getContext("2d");if(!x)return;const f=new Image;f.crossOrigin="Anonymous",f.onload=()=>{let{naturalWidth:k,naturalHeight:w}=f;const p=l?l/k:1,C=c?c/w:1,S=Math.min(p,C,1),I=k*S,E=w*S;g.width=I,g.height=E,x.drawImage(f,0,0,I,E);const D=x.getImageData(0,0,I,E);typeof u!="string"&&URL.revokeObjectURL(f.src),y({imageData:D,width:I,height:E})},f.src=typeof u=="string"?u:URL.createObjectURL(u)}};be(()=>{if(n.plugin)return n.plugin.registerPageHandlers(e.pageIndex,e.scale,{services:a,onPreview:(u,l)=>{te(i,new Map(t(i)),!0),l?t(i).set(u,l):t(i).delete(u)}})});var v=Xo(),d=z(v);O(d,"",{},{display:"none"}),Dt(d,u=>te(s,u),()=>t(s));var h=se(d,2);O(h,"",{},{display:"none"}),Dt(h,u=>te(r,u),()=>t(r));var m=se(h,2);pe(m,17,()=>Array.from(t(i).entries()),([u,l])=>u,(u,l)=>{var c=b(()=>_n(t(l),2));let y=()=>t(c)[1];Go(u,{get preview(){return y()},get scale(){return e.scale}})}),A(o,v),$()}var qo=G("<div><!> <!> <!></div>");function Ko(o,e){J(e,!0);let n=vt(e,["$$slots","$$events","$$legacy","style","pageIndex","scale","selectionMenu","resizeUI","vertexUI","pageWidth","pageHeight","rotation","selectionOutlineColor","customAnnotationRenderer"]);var i=qo();Pe(i,v=>({...v,...n}),[()=>e.style?Object.fromEntries(Object.entries(e.style).map(([v,d])=>[`style:${v}`,d])):{}]);var s=B(i);Do(s,{get selectionMenu(){return e.selectionMenu},get pageIndex(){return e.pageIndex},get scale(){return e.scale},get rotation(){return e.rotation},get pageWidth(){return e.pageWidth},get pageHeight(){return e.pageHeight},get resizeUI(){return e.resizeUI},get vertexUI(){return e.vertexUI},get selectionOutlineColor(){return e.selectionOutlineColor},get customAnnotationRenderer(){return e.customAnnotationRenderer}});var r=se(s,2);Ho(r,{get pageIndex(){return e.pageIndex},get scale(){return e.scale}});var a=se(r,2);Qo(a,{get pageIndex(){return e.pageIndex},get scale(){return e.scale}}),W(i),A(o,i),$()}const wn="history",Zo={id:wn,name:"History Plugin",version:"1.0.0",provides:["history"],requires:[],optional:[],defaultConfig:{enabled:!0}},Pn="HISTORY/SET_STATE",Jo=o=>({type:Pn,payload:o}),An=class extends Xt{constructor(e,n){super(e,n),this.topicHistories=new Map,this.globalTimeline=[],this.globalIndex=-1,this.historyChange$=Fn()}async initialize(e){}getHistoryState(){const e={};return Array.from(this.topicHistories.entries()).forEach(([n,i])=>{e[n]={canUndo:i.currentIndex>-1,canRedo:i.currentIndex<i.commands.length-1}}),{global:{canUndo:this.globalIndex>-1,canRedo:this.globalIndex<this.globalTimeline.length-1},topics:e}}emitHistoryChange(e){this.dispatch(Jo(this.getHistoryState())),this.historyChange$.emit(e)}buildCapability(){return{getHistoryState:()=>this.state,onHistoryChange:this.historyChange$.on,register:(e,n)=>{this.topicHistories.has(n)||this.topicHistories.set(n,{commands:[],currentIndex:-1});const i=this.topicHistories.get(n);i.commands.splice(i.currentIndex+1),i.commands.push(e),i.currentIndex++;const s={command:e,topic:n};this.globalTimeline.splice(this.globalIndex+1),this.globalTimeline.push(s),this.globalIndex++,e.execute(),this.emitHistoryChange(n)},undo:e=>{let n;if(e){const i=this.topicHistories.get(e);i&&i.currentIndex>-1&&(i.commands[i.currentIndex].undo(),i.currentIndex--,n=e)}else if(this.globalIndex>-1){const i=this.globalTimeline[this.globalIndex];i.command.undo(),this.topicHistories.get(i.topic).currentIndex--,this.globalIndex--,n=i.topic}n&&this.emitHistoryChange(n)},redo:e=>{let n;if(e){const i=this.topicHistories.get(e);i&&i.currentIndex<i.commands.length-1&&(i.currentIndex++,i.commands[i.currentIndex].execute(),n=e)}else if(this.globalIndex<this.globalTimeline.length-1){this.globalIndex++;const i=this.globalTimeline[this.globalIndex];i.command.execute(),this.topicHistories.get(i.topic).currentIndex++,n=i.topic}n&&this.emitHistoryChange(n)},canUndo:e=>{if(e){const n=this.topicHistories.get(e);return!!n&&n.currentIndex>-1}return this.globalIndex>-1},canRedo:e=>{if(e){const n=this.topicHistories.get(e);return!!n&&n.currentIndex<n.commands.length-1}return this.globalIndex<this.globalTimeline.length-1}}}};An.id="history";let $o=An;const Sn={global:{canUndo:!1,canRedo:!1},topics:{}},es=(o=Sn,e)=>{switch(e.type){case Pn:return{...o,...e.payload};default:return o}},ts={manifest:Zo,create:o=>new $o(wn,o),reducer:es,initialState:Sn},ns=(o,e=he)=>{Bn(o,{get pageIndex(){return e().pageIndex},get pageWidth(){return e().width},get pageHeight(){return e().height},get rotation(){return e().rotation},get scale(){return e().scale},children:(n,i)=>{var s=os(),r=z(s);Yn(r,{get pageIndex(){return e().pageIndex},style:"pointer-events: none"});var a=se(r,2);Gn(a,{get pageIndex(){return e().pageIndex},get scale(){return e().scale}});var v=se(a,2);Ko(v,{get pageIndex(){return e().pageIndex},get scale(){return e().scale},get pageWidth(){return e().width},get pageHeight(){return e().height},get rotation(){return e().rotation}}),A(n,s)},$$slots:{default:!0}})},is=(o,e)=>{const n=e.provides?.getSelectedAnnotation();n&&e.provides?.deleteAnnotation(n.object.pageIndex,n.object.id)};var os=G("<!> <!> <!>",1),ss=(o,e,n)=>e(t(n).id),rs=G("<button> </button>"),as=G('<div style="height: 600px; display: flex; flex-direction: column; user-select: none"><div class="mb-4 mt-4 flex flex-wrap items-center gap-2 rounded-lg border border-gray-200 bg-white p-2 shadow-sm"><!> <div class="h-6 w-px bg-gray-200"></div> <button class="rounded-md bg-red-500 px-3 py-1 text-sm font-medium text-white transition-colors hover:bg-red-600 disabled:cursor-not-allowed disabled:bg-red-300">Delete Selected</button></div> <div class="flex-grow" style="position: relative"><!></div></div>');function cs(o,e){J(e,!0);let n=oe(null),i=oe(!1);const s=qe(),r=[{id:"stampCheckmark",name:"Checkmark (stamp)"},{id:"stampCross",name:"Cross (stamp)"},{id:"ink",name:"Pen"},{id:"square",name:"Square"},{id:"highlight",name:"Highlight"}];be(()=>{if(s.provides)return s.provides.onActiveToolChange(c=>{te(n,c?.id??null,!0)})}),be(()=>{if(s.provides)return s.provides.onStateChange(c=>{te(i,!!c.selectedUid)})});const a=c=>{s.provides?.setActiveTool(t(n)===c?null:c)};var v=as(),d=B(v),h=B(d);pe(h,17,()=>r,c=>c.id,(c,y)=>{var g=rs();g.__click=[ss,a,y];var x=B(g,!0);W(g),j(()=>{ti(g,1,`rounded-md px-3 py-1 text-sm font-medium transition-colors ${t(n)===t(y).id?"bg-blue-500 text-white":"bg-gray-100 hover:bg-gray-200"}`),qt(x,t(y).name)}),A(c,g)});var m=se(h,4);m.__click=[is,s],W(d);var u=se(d,2),l=B(u);Wn(l,{style:"width: 100%; height: 100%; position: absolute; background-color: #f1f3f5",children:(c,y)=>{Vn(c,{get RenderPageSnippet(){return ns}})},$$slots:{default:!0}}),W(u),W(v),j(()=>m.disabled=!t(i)),A(o,v),$()}Ae(["click"]);var ls=G("<div>Loading PDF Engine...</div>");function ks(o,e){J(e,!1);const n=Xn(),i=[Ne(qn,{loadingOptions:{type:"url",pdfFile:{id:"example-pdf",url:"https://snippet.embedpdf.com/ebook.pdf"}}}),Ne(Kn),Ne(Zn),Ne(Jn),Ne($n),Ne(ei),Ne(ts),Ne(Gi,{annotationAuthor:"EmbedPDF User"})],s=async h=>{const m=h.getPlugin("annotation")?.provides();m?.addTool({id:"stampCheckmark",name:"Checkmark",interaction:{exclusive:!1,cursor:"crosshair"},matchScore:()=>0,defaults:{type:P.STAMP,imageSrc:"/circle-checkmark.png",imageSize:{width:30,height:30}}}),m?.addTool({id:"stampCross",name:"Cross",interaction:{exclusive:!1,cursor:"crosshair"},matchScore:()=>0,defaults:{type:P.STAMP,imageSrc:"/circle-cross.png",imageSize:{width:30,height:30}}})};In();var r=R(),a=z(r);{var v=h=>{var m=ls();A(h,m)},d=h=>{Qn(h,{get engine(){return n.engine},get plugins(){return i},onInitialized:s,children:(m,u)=>{cs(m,{})},$$slots:{default:!0}})};M(a,h=>{n.isLoading||!n.engine?h(v):h(d,!1)})}A(o,r),$()}export{ks as component};
