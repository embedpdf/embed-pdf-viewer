<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EmbedPDF</title>
  <style>
    html, body {
      overscroll-behavior: none;
    }

    body {
      margin: 0;
      padding: 0;
    }
  </style>
</head>
<body>
  <div id="pdf-viewer" style="height: 100dvh"></div>
  <script async type="module">
    import EmbedPDF from './embedpdf.js';

    const viewer = EmbedPDF.init({
      type: 'container',
      target: document.getElementById('pdf-viewer'),
      src: 'https://snippet.embedpdf.com/ebook.pdf',
      worker: true,
      annotations: {annotationAuthor: '匿名用户'},
      tabBar: 'always',
      theme: {
        preference: 'light',
        light: {
          accent: {
            primary: '#F5222D',        // Main brand color
            primaryHover: '#cf1322',   // Hover state
            primaryActive: '#a8071a',  // Click state
            primaryLight: '#f3e8ff',   // Subtle backgrounds (e.g., selection)
            primaryForeground: '#fff'  // Text on top of primary color
          }
        },
      },
      i18n: {
        defaultLocale: 'zh-CN'
      },
      icons: {
        ai: {
          viewBox: '0 0 1024 1024',
          paths: [
            {
              d: 'M374.36328125 204.980469L139.58984375 819.019531h107.52539037l55.89843775-153.93164063h257.13281276l55.89843699 153.98437526h107.578125L488.79687525 204.92773437H374.36328125z m-41.238281 377.57812475L430.261719 313.296875h3.42773412l96.2929685 269.15625025H333.12500025z m450.6679685-377.57812475v614.039062h100.6171875V204.980469h-100.6171875z',
              stroke: 'currentColor',
              fill: 'currentColor'
            }
          ]
        },
        trans: {
          viewBox: '0 0 1024 1024',
          paths: [
            {
              d: 'M213.333333 682.666667v42.666666a85.333333 85.333333 0 0 0 78.933334 85.12L298.666667 810.666667h85.333333a42.666667 42.666667 0 0 1 0 85.333333H298.666667a170.666667 170.666667 0 0 1-170.666667-170.666667v-42.666666a42.666667 42.666667 0 0 1 85.333333 0z m560.042667-242.602667l170.666667 426.666667a21.333333 21.333333 0 0 1-19.84 29.269333h-45.994667a21.333333 21.333333 0 0 1-19.797333-13.397333L812.544 768h-174.506667l-45.781333 114.602667a21.333333 21.333333 0 0 1-19.84 13.397333H526.506667a21.333333 21.333333 0 0 1-19.797334-29.269333l170.666667-426.666667a21.333333 21.333333 0 0 1 19.797333-13.397333h56.405334a21.333333 21.333333 0 0 1 19.84 13.397333zM725.333333 549.76L672.128 682.666667h106.325333L725.333333 549.76zM341.333333 106.666667V170.666667h149.333334a21.333333 21.333333 0 0 1 21.333333 21.333333v256a21.333333 21.333333 0 0 1-21.333333 21.333333H341.333333v106.666667a21.333333 21.333333 0 0 1-21.333333 21.333333h-42.666667a21.333333 21.333333 0 0 1-21.333333-21.333333V469.333333H106.666667a21.333333 21.333333 0 0 1-21.333334-21.333333v-256a21.333333 21.333333 0 0 1 21.333334-21.333333H256V106.666667a21.333333 21.333333 0 0 1 21.333333-21.333334h42.666667a21.333333 21.333333 0 0 1 21.333333 21.333334z m384 21.333333a170.666667 170.666667 0 0 1 170.666667 170.666667v42.666666a42.666667 42.666667 0 0 1-85.333333 0V298.666667a85.333333 85.333333 0 0 0-85.333334-85.333334h-85.333333a42.666667 42.666667 0 0 1 0-85.333333h85.333333zM256 256H170.666667v128h85.333333V256z m170.666667 0H341.333333v128h85.333334V256z',
              stroke: 'currentColor',
              fill: 'currentColor'
            }
          ]
        },
      },
    });

    const registry = await viewer.registry;
    const commands = registry.getPlugin('commands').provides();
    const ui = registry.getPlugin('ui').provides();
    commands.registerCommand({
      id: 'custom.selection.ai',
      label: 'AI解读',
      icon: 'ai',
      action: async ({registry, documentId}) => {
        const plugin = registry.getPlugin('selection');
        const scope = plugin?.provides().forDocument(documentId);
        const text = (await scope?.getSelectedText().toPromise()) || [];
        console.log('AI解读', text);
        scope?.clear();
      },
      categories: ['selection'],
    })
    commands.registerCommand({
      id: 'custom.selection.trans',
      label: '翻译',
      icon: 'trans',
      action: async ({registry, documentId}) => {
        const plugin = registry.getPlugin('selection');
        const scope = plugin?.provides().forDocument(documentId);
        const text = (await scope?.getSelectedText().toPromise()) || [];
        console.log('翻译', text);
        scope?.clear();
      },
      categories: ['selection'],
    })
    const schema = ui.getSchema();
    const selectionItems = schema.selectionMenus['selection'].items;
    ui.mergeSchema({
      selectionMenus: {
        ...schema.selectionMenus,
        selection: {
          ...schema.selectionMenus['selection'],
          items: [
            {
              type: 'command-button',
              id: 'custom-selection-ai',
              commandId: 'custom.selection.ai',
              variant: 'icon',
              categories: ['selection'],
            },
            {
              type: 'command-button',
              id: 'custom-selection-trans',
              commandId: 'custom.selection.trans',
              variant: 'icon',
              categories: ['selection'],
            },
            ...selectionItems
          ]
        }
      }
    })
  </script>
</body>
</html>
